(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{1614:function(e,t,a){e.exports={container:"container-1eh","element-botton":"element-botton-1g8",elementBotton:"element-botton-1g8",buttons:"buttons-oft",merges:"merges-36Q",squash:"squash-OZM",merge:"merge-36M",dropdown:"dropdown-UUi","merge-selector":"merge-selector-1Ha",mergeSelector:"merge-selector-1Ha","merge-item":"merge-item-3Vw",mergeItem:"merge-item-3Vw",check:"check-2fh",header:"header-2tp",description:"description-14G",empty:"empty-2r2",element:"element-25h","reference-container":"reference-container-1v-",referenceContainer:"reference-container-1v-",icon:"icon-1Hd",img:"img-3Bu",content:"content-2yn",title:"title-xVz",desc:"desc-1lX",author:"author-36J",branch:"branch-2Ga",actions:"actions-1Ps",action:"action-25f",text:"text-1bf",reviewers:"reviewers-1fp",reviewer:"reviewer-2vp",avatar:"avatar-29h",info:"info-2sV",form:"form-1IO",checks:"checks-3s4",list:"list-1Me",item:"item-1zh",close:"close-DwD",link:"link-1eL","item-icon":"item-icon-2v1",itemIcon:"item-icon-2v1",input:"input-1oZ","check-icon":"check-icon-2MN",checkIcon:"check-icon-2MN",good:"good-Vsi",bad:"bad-1Kj",normal:"normal-c_f",name:"name-3ZD",line:"line-1nA","header-title":"header-title-1Jw",headerTitle:"header-title-1Jw"}},1648:function(e,t,a){e.exports={container:"container-bWD",header:"header-2qV",title:"title-1Dl",create:"create-3ON",empty:"empty-pMx","new-release":"new-release-1RA",newRelease:"new-release-1RA",form:"form-3Di",name:"name-3FD",at:"at-2MD",dropdown:"dropdown-3U9",edit:"edit-3jD",commitish:"commitish-t-p","body-editor":"body-editor-3wY",bodyEditor:"body-editor-3wY",pre:"pre-28v","file-uploader":"file-uploader-2MI",fileUploader:"file-uploader-2MI","file-list":"file-list-Y14",fileList:"file-list-Y14","file-item":"file-item-1eC",fileItem:"file-item-1eC","loading-icon":"loading-icon-IcZ",loadingIcon:"loading-icon-IcZ",icon:"icon-3OE",btn:"btn-3P9",success:"success-aza",error:"error-2xF",resources:"resources-28d",actions:"actions-6Jb",action:"action-1pu",text:"text-34L",desc:"desc-h5J",list:"list-35F",item:"item-2Va",close:"close-1XG",link:"link-1ZJ","cuk-icon":"cuk-icon-2y2",cukIcon:"cuk-icon-2y2",avatar:"avatar-2xN",input:"input-3FN",infos:"infos-11-",releases:"releases-2Ab",release:"release-23s","release-body":"release-body-3FS",releaseBody:"release-body-3FS","release-header":"release-header-6rl",releaseHeader:"release-header-6rl","edit-btn":"edit-btn-1-i",editBtn:"edit-btn-1-i","release-meta":"release-meta-1yv",releaseMeta:"release-meta-1yv","release-label":"release-label-1oC",releaseLabel:"release-label-1oC",tag:"tag-2g0",download:"download-2jt","download-title":"download-title-2Vg",downloadTitle:"download-title-2Vg","download-body":"download-body-1r_",downloadBody:"download-body-1r_","action-container":"action-container-2D0",actionContainer:"action-container-2D0","init-container":"init-container-3_z",initContainer:"init-container-3_z",intro:"intro-3p6"}},1713:function(e,t,a){e.exports={"merge-request-container":"merge-request-container-S6o",mergeRequestContainer:"merge-request-container-S6o",title:"title--z4","merge-status":"merge-status-30J",mergeStatus:"merge-status-30J",desc:"desc-2yi",branch:"branch-22Q","tab-selector":"tab-selector-Twm",tabSelector:"tab-selector-Twm",tab:"tab-3o6",main:"main-roM",show:"show-2aj",content:"content-3TN",editor:"editor-uaF",edit:"edit-fEs","desc-content":"desc-content-3Ng",descContent:"desc-content-3Ng",pencil:"pencil-3gk",empty:"empty-2BO","comment-container":"comment-container-2dx",commentContainer:"comment-container-2dx",comment:"comment-14s"}},1808:function(e,t,a){e.exports={"time-line":"time-line-1ec",timeLine:"time-line-1ec",toggle:"toggle-Q5B",items:"items-3tA",item:"item-2At",details:"details-1qs",container:"container-2LE",content:"content-1an",desc:"desc-S9d","action-resource":"action-resource-3Nf",actionResource:"action-resource-3Nf",time:"time-2qq",author:"author-3Gy",avatar:"avatar-3uX","comment-box":"comment-box-16i",commentBox:"comment-box-16i","current-comment":"current-comment-2mo",currentComment:"current-comment-2mo","comment-content":"comment-content-D-p",commentContent:"comment-content-D-p","comment-button":"comment-button-2gj",commentButton:"comment-button-2gj","comment-stat":"comment-stat-6jx",commentStat:"comment-stat-6jx","comment-user":"comment-user-J_G",commentUser:"comment-user-J_G","comment-toggle":"comment-toggle-qwJ",commentToggle:"comment-toggle-qwJ","with-arrow":"with-arrow-3kU",withArrow:"with-arrow-3kU","comment-input-container":"comment-input-container-1Hf",commentInputContainer:"comment-input-container-1Hf","comment-input":"comment-input-okm",commentInput:"comment-input-okm",child:"child-1Xt","child-avatar":"child-avatar--X1",childAvatar:"child-avatar--X1","child-content":"child-content-3KX",childContent:"child-content-3KX",smileo:"smileo-3nl","arrow-right":"arrow-right-jdF",arrowRight:"arrow-right-jdF","line-note":"line-note-zd8",lineNote:"line-note-zd8",header:"header-3la","toggle-diff":"toggle-diff-3lV",toggleDiff:"toggle-diff-3lV",file:"file-JlP","file-header":"file-header-2Mw",fileHeader:"file-header-2Mw",path:"path-1ak","file-body":"file-body-2hX",fileBody:"file-body-2hX","inline-comments":"inline-comments-2Qe",inlineComments:"inline-comments-2Qe","line-comments":"line-comments-1q5",lineComments:"line-comments-1q5",comment:"comment-1yd","comment-action":"comment-action-2o3",commentAction:"comment-action-2o3","avatar-link":"avatar-link-3os",avatarLink:"avatar-link-3os","comment-content-body":"comment-content-body-KI1",commentContentBody:"comment-content-body-KI1",reply:"reply-2kO","reply-avatar":"reply-avatar-3Lr",replyAvatar:"reply-avatar-3Lr","reply-content":"reply-content-3GZ",replyContent:"reply-content-3GZ","comment-form":"comment-form-Ywn",commentForm:"comment-form-Ywn"}},1809:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ACTION={FETCH_MERGE_REQUEST:"DEPOT.FETCH_MERGE_REQUEST",FETCH_MERGE_REQUEST_ACTIVITIES:"DEPOT.FETCH_MERGE_REQUEST_ACTIVITIES",FETCH_MERGE_REQUEST_COMMENTS:"DEPOT.FETCH_MERGE_REQUEST_COMMENTS",FETCH_MERGE_REQUEST_REVIEWERS:"DEPOT.FETCH_MERGE_REQUEST_REVIEWERS",FETCH_MERGE_REQUEST_WATCHERS:"DEPOT.FETCH_MERGE_REQUEST_WATCHERS",UPDATE_MERGE_REQUEST_TITLE:"DEPOT.UPDATE_MERGE_REQUEST_TITLE",UPDATE_MERGE_REQUEST_CONTENT:"DEPOT.UPDATE_MERGE_REQUEST_CONTENT",UPDATE_MERGE_REQUEST_ACTIVITIES:"DEPOT.UPDATE_MERGE_REQUEST_ACTIVITIES",MERGE_REQUEST_ADD_REVIEWER:"DEPOT.MERGE_REQUEST_ADD_REVIEWER",MERGE_REQUEST_DEL_REVIEWER:"DEPOT.MERGE_REQUEST_DEL_REVIEWER",MERGE_REQUEST_ADD_WATCHER:"DEPOT.MERGE_REQUEST_ADD_WATCHER",MERGE_REQUEST_DEL_WATCHER:"DEPOT.MERGE_REQUEST_DEL_WATCHER",MERGE_REQUEST_ADD_LABEL:"DEPOT.MERGE_REQUEST_ADD_LABEL",MERGE_REQUEST_DEL_LABEL:"DEPOT.MERGE_REQUEST_DEL_LABEL",MERGE_REQUEST_GET_REFERENCES:"DEPOT.MERGE_REQUEST_GET_REFERENCES",MERGE_REQUEST_GET_REFERENCE_RESUTLS:"DEPOT.MERGE_REQUEST_GET_REFERENCE_RESUTLS",MERGE_REQUEST_REVIEW_GOOD:"DEPOT.MERGE_REQUEST_REVIEW_GOOD",MERGE_REQUEST_CANCEL_REVIEW_GOOD:"DEPOT.MERGE_REQUEST_CANCEL_REVIEW_GOOD",MERGE_REQUEST_GRANT:"DEPOT.MERGE_REQUEST_GRANT",MERGE_REQUEST_CANCEL_GRANT:"DEPOT.MERGE_REQUEST_CANCEL_GRANT",MERGE_REQUEST_MERGE:"DEPOT.MERGE_REQUEST_MERGE",MERGE_REQUEST_REFUSE:"DEPOT.MERGE_REQUEST_REFUSE",MERGE_REQUEST_CANCEL:"DEPOT.MERGE_REQUEST_CANCEL",MERGE_REQUEST_SAY_GOOD:"DEPOT.MERGE_REQUEST_SAY_GOOD",MERGE_REQUEST_SAY_BAD:"DEPOT.MERGE_REQUEST_SAY_BAD",CLEAR_MERGE_REQUEST:"DEPOT.CLEAR_MERGE_REQUEST"},t.MERGE_STATUS={CANMERGE:{color:"green",text:"\u53ef\u5408\u5e76"},CANNOTMERGE:{color:"#A78CD3",text:"\u4e0d\u53ef\u81ea\u52a8\u5408\u5e76"},ACCEPTED:{color:"#D19D6B",text:"\u5df2\u5408\u5e76"},REFUSED:{color:"#DDD",text:"\u5df2\u5173\u95ed"},CANCEL:{color:"#DDD",text:"\u5df2\u53d6\u6d88"},"":{color:"#DDD",text:""}},t.REF_TYPE={SELF:"self",OTHER:"other",LINKS:"links"},t.LINK_SYMBOL="ExternalLink"},1810:function(e,t,a){e.exports={element:"element-3yv",icon:"icon-3Fj",img:"img-L9n",content:"content-2NX",resloving:"resloving-21_",title:"title-122",desc:"desc-3s1",tips:"tips-1ET","conflict-container":"conflict-container-2bY",conflictContainer:"conflict-container-2bY",conflicts:"conflicts-qoo",conflict:"conflict-1Uv",resloved:"resloved-3Gv",check:"check-3DI",actions:"actions-1Mi","conflict-editor":"conflict-editor-hnm",conflictEditor:"conflict-editor-hnm",header:"header-1cK","angle-right":"angle-right-xbw",angleRight:"angle-right-xbw",right:"right-3iu","file-count":"file-count-SEn",fileCount:"file-count-SEn",page:"page-3di",done:"done-30q",close:"close-1xM","merge-title":"merge-title-4Ad",mergeTitle:"merge-title-4Ad","gutter-title":"gutter-title-3S6",gutterTitle:"gutter-title-3S6",dropdown:"dropdown-2Og",trigger:"trigger-2Nh","check-icon":"check-icon-2KL",checkIcon:"check-icon-2KL",checked:"checked-CcB","dropdown-check-icon":"dropdown-check-icon-TMb",dropdownCheckIcon:"dropdown-check-icon-TMb","merge-editor":"merge-editor-3vX",mergeEditor:"merge-editor-3vX"}},1811:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchReleases=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(0,n.dispatchWithProjectAPIPrefix)(function(a,o){return(0,n.autoDispatch)((0,r.get)(a+"/git/releases?page="+e+"&pageSize="+t),o,l.ACTION.FETCH_RELEASES)})},t.fetchRelease=function(e){return(0,n.dispatchWithProjectAPIPrefix)(function(t,a){return(0,n.autoDispatch)((0,r.get)(t+"/git/releases/tag/"+e),a,l.ACTION.FETCH_RELEASE)})},t.fetchReleasesDescription=function(e){return(0,n.dispatchWithProjectAPIPrefix)(function(t){return(0,r.get)(t+"/git/releases/generated_description?milestone_iid="+e)})},t.fetchResource=function(e){return(0,n.dispatchWithProjectAPIPrefix)(function(t){return(0,r.get)(t+"/resource/"+e)})},t.createRelease=function(e){return(0,n.dispatchWithProjectAPIPrefix)(function(t,a){return(0,n.autoDispatch)((0,r.post)(t+"/git/releases/create",e),a,l.ACTION.CREATE_RELEASE)})},t.updateRelease=function(e,t){return(0,n.dispatchWithProjectAPIPrefix)(function(a,o){return(0,n.autoDispatch)((0,r.post)(a+"/git/releases/update/"+t,e),o,l.ACTION.UPDATE_RELEASE)})},t.deleteRelease=function(e){return(0,n.dispatchWithProjectAPIPrefix)(function(t,a){return(0,n.autoDispatch)((0,r.post)(t+"/git/releases/delete/"+e),a,l.ACTION.DELETE_RELEASE,function(){return e})})},t.uploadReleaseFile=function(e){var t=new FormData;return t.append(e.name,e),(0,n.dispatchWithProjectAPIPrefix)(function(e){return(0,r.upload)(e+"/git/releases/attachments/upload",t)})},t.resourceSearch=function(e){var t=void 0;t=e?"#"===e.charAt(0)?encodeURIComponent(e.slice(1)):encodeURIComponent(e):"";return(0,n.dispatchWithProjectAPIPrefix)(function(e,a){return(0,n.autoDispatch)((0,r.get)(e+"/resource/search?q="+t+"&pageSize=6"),a,l.ACTION.FETCH_REFERENCE_RESULTS,function(e){return e.data.list})})},t.referenceSelectorConfirm=function(e,t){return(0,n.dispatchWithProjectAPIPrefix)(function(){return Promise.all([].concat(o(e.filter(function(e){return-1===t.indexOf(e)})),o(t.filter(function(t){return-1===e.indexOf(t)}))))})},t.createReferencedTask=function(e,t,a,l){return(0,n.dispatchWithProjectAPIPrefix)(function(n){return(0,r.post)(n+"/task",{owner_id:e,priority:t,deadline:a,content:l})})},t.onAddExternalLink=function(e){return(0,n.dispatchWithProjectAPIPrefix)(function(t){return(0,r.post)(t+"/external_link",e)})};var n=a(548),r=a(84),l=a(2e3);function o(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}},2000:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ACTION={FETCH_RELEASES:"RELEASE.FETCH_RELEASES",CREATE_RELEASE:"RELEASE.CREATE_RELEASE",FETCH_RELEASE:"RELEASE.FETCH_RELEASE",UPDATE_RELEASE:"RELEASE.UPDATE_RELEASE",DELETE_RELEASE:"RELEASE.DELETE_RELEASE",FETCH_REFERENCE_RESULTS:"RELEASE.FETCH_REFERENCE_RESULTS"},t.REF_TYPE={SELF:"self",OTHER:"other",LINKS:"links"},t.LINK_SYMBOL="ExternalLink"},2287:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InlineCommentForm=void 0;var n,r,l,o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=E(a(0)),i=a(2),s=E(i),c=E(a(545)),d=E(a(544)),f=a(266),m=E(a(8)),p=a(112),h=E(a(1587));function E(e){return e&&e.__esModule?e:{default:e}}var g=(0,f.withAsyncMarkEditor)()((l=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.onEditorChange=a.onEditorChange.bind(a),a.onSubmit=a.onSubmit.bind(a),a.state={submitting:!1,editorState:e.defaultEditorState},a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"componentWillMount",value:function(){this.props.comment&&this.props.comment.length>0&&this.setState({editorState:this.props.createWithContent(this.props.comment)})}},{key:"onEditorChange",value:function(e,t){this.setState({editorState:e},t),this.props.onCommentChange(this.props.getPlainText(this.state.editorState))}},{key:"onSubmit",value:function(){var e=this,t=this.props,a=t.commitId,n=t.line,r=t.changeType,l=t.position,o=t.path,u=t.anchor,i=t.noteableType,s=t.noteableId,c=t.getPlainText;if(!this.state.submitting){var d=c(this.state.editorState);d.trim()?(this.setState({submitting:!0}),this.props.postComment(a,n,r,l,o,u,d,i,s,function(){return e.setState({submitting:!1})})):(0,p.danger)("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a")}}},{key:"render",value:function(){var e=this,t=this.props,a=t.currentProject,n=t.comments,r=t.InlineCommentMarkEditor;return s.default.createElement("div",{className:(0,m.default)(h.default.inlineCommentForm,n&&n.length>0?h.default.hasComments:"")},s.default.createElement(r,{className:h.default.commentForm,placeholder:"\u8bc4\u8bba",onChange:this.onEditorChange,editorState:this.state.editorState,projectId:a.id||0,autoSize:!1,onCommandEnter:this.onSubmit,mentionParams:{context_type:"task_description",item_id:a.id},hashSearchParams:{owner:a.owner_user_name,project:a.name},autoFocus:!0}),s.default.createElement("div",{className:"clearfix"}),s.default.createElement(d.default,{className:"mr-20",disabled:this.state.submitting,onClick:this.onSubmit,loading:this.state.submitting},"\u8bc4\u8bba"),s.default.createElement(d.default,{empty:!0,onClick:function(){return e.props.cancel()}},"\u53d6\u6d88"))}}]),t}(),r.propTypes={currentProject:u.default.shape({owner_user_name:u.default.string,name:u.default.string}),cancel:u.default.func,postComment:u.default.func,commitId:u.default.string,line:u.default.number,changeType:u.default.number,position:u.default.number,path:u.default.string,anchor:u.default.string,noteableType:u.default.string,noteableId:u.default.number,comments:u.default.array,comment:u.default.string,onCommentChange:u.default.func,defaultEditorState:u.default.object,InlineCommentMarkEditor:u.default.func,getPlainText:u.default.func,createWithContent:u.default.func},r.defaultProps={onCommentChange:function(){}},n=l))||n;t.InlineCommentForm=g;t.default=(0,c.default)(function(e){return{currentProject:e.APP.currentProject}},{})(g)},2288:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=g(a(0)),u=a(2),i=g(u),s=g(a(8)),c=g(a(560)),d=g(a(552)),f=a(78),m=a(724),p=g(a(76)),h=g(a(169)),E=g(a(1797));function g(e){return e&&e.__esModule?e:{default:e}}var v=(r=n=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={items:[],values:[]},e.onSelect=e.onSelect.bind(e),e.trigger=e.trigger.bind(e),e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"generateItems",value:function(e){this.setState({items:e.projectLabels.map(function(e){return{media:e.color,text:e.name,value:e.id}})})}},{key:"generateValues",value:function(e){this.setState({values:e.labels.map(function(e){return e.id})})}},{key:"componentDidMount",value:function(){(0,p.default)(this.props.projectLabels)||this.generateItems(this.props),(0,p.default)(this.props.labels)||this.generateValues(this.props)}},{key:"componentWillReceiveProps",value:function(e){(0,h.default)(e.projectLabels,this.props.projectLabels)||this.generateItems(e),(0,h.default)(e.labels,this.props.labels)||this.generateValues(e)}},{key:"onSelect",value:function(e){if(e){var t=this.props.projectLabels.find(function(t){return t.id===e.value});this.props.labels.findIndex(function(t){return t.id===e.value})>-1?this.props.delLabel(t):this.props.addLabel(t)}}},{key:"renderLabel",value:function(e,t){var a=this;return i.default.createElement("li",{key:t},this.props.canEdit&&i.default.createElement(d.default,{bgColor:e.color,size:"small",className:E.default.label,onDismiss:function(){a.props.delLabel(e)}},i.default.createElement("span",{className:E.default.labelName},e.name)),!this.props.canEdit&&i.default.createElement(d.default,{bgColor:e.color,size:"small",className:E.default.label},i.default.createElement("span",{className:E.default.labelName},e.name)))}},{key:"trigger",value:function(){return i.default.createElement("div",{className:E.default.dropDownTitle},i.default.createElement("span",{className:"fs-12"},"\u6807\u7b7e"),this.props.canEdit&&i.default.createElement(c.default,{className:E.default.icon}))}},{key:"render",value:function(){var e=this.props,t=e.project,a=e.labels,n=(0,m.labelCreatorWrapper)((0,f.hocDropdown)(this.trigger,m.menuItem));return i.default.createElement("div",{className:(0,s.default)(E.default.section,E.default.deadline)},i.default.createElement(n,{enableCreator:!0,projectId:t.id,items:this.state.items,value:this.state.values,multiple:!0,disabled:!this.props.canEdit,onSelect:this.onSelect,searchable:!0,searchPlaceholder:"\u7b5b\u9009\u6807\u7b7e"}),0===a.length&&i.default.createElement("div",{className:E.default.empty},"\u5c1a\u672a\u6dfb\u52a0\u4efb\u4f55\u6807\u7b7e"),0!==a.length&&i.default.createElement("ul",{className:E.default.items},this.props.labels.map(this.renderLabel,this)))}}]),t}(),n.propTypes={labels:o.default.array,addLabel:o.default.func,delLabel:o.default.func,projectLabels:o.default.array,project:o.default.object,canEdit:o.default.bool},r);t.default=v},2289:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=p(a(0)),u=a(2),i=p(u),s=p(a(560)),c=p(a(547)),d=p(a(262)),f=a(78),m=p(a(1797));function p(e){return e&&e.__esModule?e:{default:e}}var h=(r=n=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.onSelect=e.onSelect.bind(e),e.trigger=e.trigger.bind(e),e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"onSelect",value:function(e){if(e){var t=this.props.members.find(function(t){return t.id===e.value}),a={avatar:t.media,id:t.id,name:t.name,username:t.globalKey};this.props.watchers.findIndex(function(t){return t.id===e.value})>-1?this.props.delWatcher(a):this.props.addWatcher(a)}}},{key:"onSearch",value:function(e,t){var a=e.toLowerCase();return t.filter(function(e){return e.text.toLowerCase().indexOf(a)>-1||e.globalKey.toLowerCase().indexOf(a)>-1||e.pinyin.toLowerCase().indexOf(a)>-1})}},{key:"renderWatcher",value:function(e,t){var a=this;return i.default.createElement("li",{key:t},i.default.createElement(d.default,{src:e.avatar,size:"tiny"}),i.default.createElement("span",{className:m.default.name},e.name),this.props.canEdit&&i.default.createElement(c.default,{className:m.default.removeIcon,onClick:function(){a.props.delWatcher(e)}}))}},{key:"trigger",value:function(){return i.default.createElement("div",{className:m.default.dropDownTitle},i.default.createElement("span",{className:"fs-12"},"\u5173\u6ce8\u8005"),this.props.canEdit&&i.default.createElement(s.default,{className:m.default.icon}))}},{key:"render",value:function(){var e=this.props.watchers,t=(0,f.hocDropdown)(this.trigger,f.MediaDropdown.MenuItem);return i.default.createElement("div",{className:m.default.section},i.default.createElement(t,{multiple:!0,items:this.props.members,value:e.map(function(e){return e.id}),onSelect:this.onSelect,disabled:!this.props.canEdit,searchable:!0,searchPlaceholder:"\u7b5b\u9009\u6210\u5458",onSearch:this.onSearch}),0===e.length&&i.default.createElement("div",{className:m.default.empty},"\u5c1a\u672a\u6dfb\u52a0\u4efb\u4f55\u5173\u6ce8\u8005"),0!==e.length&&i.default.createElement("ul",{className:m.default.items},e.map(this.renderWatcher,this)))}}]),t}(),n.propTypes={watchers:o.default.array,addWatcher:o.default.func,delWatcher:o.default.func,members:o.default.array,canEdit:o.default.bool},r);t.default=h},2290:function(e,t,a){e.exports=a.p+"static/media/connection.a8c7a4d6.svg"},2291:function(e,t,a){e.exports=a.p+"static/media/check.839cd9ef.svg"},2292:function(e,t,a){e.exports=a.p+"static/media/close.1ccc4407.svg"},2293:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchTags=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(0,n.dispatchWithProjectAPIPrefix)(function(a,l){return(0,n.autoDispatch)((0,r.get)(a+"/git/tags?page="+e+"&pageSize="+t),l,o.ACTION.FETCH_TAGS)})},t.createTag=function(e,t,a,u){return(0,n.dispatchWithProjectAPIPrefix)(function(i,s){return(0,n.autoDispatch)((0,r.post)(i+"/git/tags/create",{tag_name:e,tag_point:t,ref_name:a,message:u}),s,o.ACTION.CREATE_TAG,function(){return s(l.fetchTagsList),{tagName:e,tagPoint:t}})})},t.deleteTag=function(e){return(0,n.dispatchWithProjectAPIPrefix)(function(t,a){return(0,n.autoDispatch)((0,r.post)(t+"/git/tags/delete?tag_name="+e),a,o.ACTION.DELETE_TAG,function(){return a(l.fetchTagsList),e})})};var n=a(548),r=a(84),l=a(1484),o=a(2294)},2294:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ACTION={FETCH_TAGS:"TAG.FETCH_TAGS",CREATE_TAG:"RELEASE.CREATE_TAG",DELETE_TAG:"RELEASE.DELETE_TAG"}},2295:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a(2),u=C(o),i=C(a(0)),s=C(a(1549)),c=C(a(1558)),d=C(a(3885)),f=C(a(1550)),m=a(168),p=C(a(262)),h=C(a(544)),E=C(a(263)),g=C(a(1460)),v=C(a(1615)),b=C(a(1450)),y=a(106),_=a(718),R=C(a(1648));function C(e){return e&&e.__esModule?e:{default:e}}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var S=(r=n=function(e){function t(){var e,a,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,l=Array(r),o=0;o<r;o++)l[o]=arguments[o];return a=n=w(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),n.state={deleting:!1},n.delete=function(){n.state.deleting||(n.setState({deleting:!0}),n.props.delete(n.props.item,function(){n.unmounted||n.setState({deleting:!1})}))},w(n,a)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),l(t,[{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"render",value:function(){var e,t=this,a=this.props,n=a.item,r=a.project,l=a.user,o=r.project_path,i=o+"/git/archive/"+n.tag_name,C="/api/user/"+r.owner_user_name+"/project/"+r.name+"/git/releases/attachments/download/",w=o+"/git/releases/"+(0,b.default)(n.tag_name);return u.default.createElement("div",{className:R.default.release},u.default.createElement("div",{className:R.default.releaseMeta},n.draft&&u.default.createElement("span",{className:R.default.releaseLabel,style:{borderColor:"#F55E5F",color:"#F55E5F"}},"\u8349\u7a3f"),n.pre&&u.default.createElement("span",{className:R.default.releaseLabel,style:{borderColor:"#F68541",color:"#F68541"}},"\u9884\u53d1\u5e03"),u.default.createElement("ul",{className:R.default.tag},u.default.createElement("li",null,u.default.createElement("a",{href:o+"/git/tree/"+n.tag_name},u.default.createElement(s.default,null)," ",u.default.createElement("span",null,n.tag_name))),u.default.createElement("li",null,u.default.createElement("a",{href:o+"/git/commit/"+n.commit_sha},u.default.createElement(f.default,null)," ",u.default.createElement("span",null,n.commit_sha.substring(0,8)))))),u.default.createElement("div",{className:R.default.releaseBody},u.default.createElement("div",{className:R.default.releaseHeader},(r.current_user_role_id>=y.ROLE_AUTH.ADMIN||l.id===n.author.id)&&u.default.createElement(h.default,{type:"danger",empty:!0,className:R.default.editBtn,onClick:this.delete,loading:this.state.deleting},"\u5220\u9664"),u.default.createElement(m.Link,{className:R.default.editBtn,to:o+"/git/releases/edit/"+(0,b.default)(n.tag_name)},u.default.createElement(h.default,{empty:!0},"\u7f16\u8f91")),u.default.createElement("h1",null,u.default.createElement(m.Link,{to:w},n.title||n.tag_name)),u.default.createElement("p",null,u.default.createElement(p.default,{shape:"square",size:"tiny",className:R.default.avatar,src:n.author.avatar})," ",u.default.createElement("span",{className:R.default.name},n.author.name)," ",u.default.createElement("span",{className:R.default.edit},"\u53d1\u5e03\u4e8e ",(e=n.created_at,u.default.createElement("time",{title:(0,E.default)(new Date(e)).format("llll")},(0,E.default)(new Date(e)).fromNow()))))),u.default.createElement("div",{className:R.default.message},u.default.createElement(g.default,{html:n.markdownBody,className:R.default.body})),u.default.createElement("div",{className:R.default.download},u.default.createElement("div",{className:R.default.downloadTitle},"\u4e0b\u8f7d"),u.default.createElement("ul",{className:R.default.downloadBody},n.attachments.length>0&&n.attachments.map(function(e,t){return u.default.createElement("li",{key:t},u.default.createElement("a",{href:""+C+e.id},u.default.createElement(d.default,null)," ",u.default.createElement("span",null,e.name)),u.default.createElement("span",null,(0,v.default)(e.size,{symbols:{B:"Bytes"}})))}),u.default.createElement("li",null,u.default.createElement("a",{href:i+".zip"},u.default.createElement(c.default,null)," ",u.default.createElement("span",null,"\u6e90\u4ee3\u7801 (zip)"))),u.default.createElement("li",null,u.default.createElement("a",{href:i+".tar.gz"},u.default.createElement(c.default,null)," ",u.default.createElement("span",null,"\u6e90\u4ee3\u7801 (tar.gz)")))),n.resource_references.length>0&&u.default.createElement("div",{className:R.default.downloadTitle,style:{borderTop:"none"}},"\u5173\u8054\u8d44\u6e90"),n.resource_references.length>0&&u.default.createElement("ul",{className:R.default.downloadBody},n.resource_references.map(function(e,a){return u.default.createElement("li",{key:a},u.default.createElement("a",{href:""+(0,_.protocolPrefix)(e),target:"_blank"},u.default.createElement(c.default,null)," ",y.IS_ENTERPRISE&&t.props.project.id!==e.target_project_id?u.default.createElement("span",null,e.target_project_name," "):"",u.default.createElement("span",null,"#",e.code," ",e.title||"Release"===e.target_type&&e.link.split("/").pop())))})))))}}]),t}(),n.propTypes={item:i.default.object,project:i.default.object,user:i.default.object,delete:i.default.func},n.statusButtonConfig={draft:["#F55E5ReleaseItemF","\u8349\u7a3f"],newest:["#31BE77","\u6700\u65b0\u53d1\u5e03"],preRelease:["#F68541","\u9884\u53d1\u5e03"]},r);t.default=S},2296:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l,o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=N(a(0)),i=a(2),s=N(i),c=a(168),d=N(a(554)),f=N(a(1468)),m=N(a(1453)),p=N(a(547)),h=N(a(261)),E=N(a(710)),g=N(a(709)),v=a(112),b=a(106),y=a(718),_=a(266),R=N(a(1554)),C=N(a(1803)),w=N(a(1804)),S=a(2e3),T=a(1648),k=N(T);function N(e){return e&&e.__esModule?e:{default:e}}function j(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var P=m.default.Item,O=(0,_.withAsyncMarkEditor)()((l=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.getRefWithType=function(e){var t=a.props.currentProject.id,n=a.props.references;return{self:n.filter(function(e){return e.target_type!==S.LINK_SYMBOL&&e.target_project_id===t}),other:n.filter(function(e){return e.target_type!==S.LINK_SYMBOL&&e.target_project_id!==t}),links:n.filter(function(e){return e.target_type===S.LINK_SYMBOL})}[e]},a.doResourceSearch=function(e){a.setState({loading:!0}),a.props.onResourceSearch(e).finally(function(){a.unmounted||a.setState({loading:!1})})},a.onResourceToggle=function(e){e||a.doResourceSearch(a.state.searchKey)},a.onResourceSearch=(0,d.default)(function(e){(a.state.searchKey||e)&&a.doResourceSearch(e),a.setState({searchKey:e||""})},300),a.onAddReference=function(e){a.state.loading?(0,v.warning)("\u8bf7\u7b49\u5f85\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210\u518d\u6dfb\u52a0\u5f15\u7528"):a.props.onAddReference(e)},a.onRemoveReference=function(e){confirm("\u786e\u5b9a\u8981\u5220\u9664\u5173\u8054")&&a.props.onRemoveReference(e)},a.renderItemText=function(e){var t=e.target_project_id&&e.target_project_id===a.props.currentProject.id,n="#"+e.code+" "+(e.title||"Release"===e.target_type&&e.link.split("/").pop()),r="#"+e.code+" "+e.title,l=b.IS_ENTERPRISE&&!t?(e.target_project_name||"")+" ":"";return e.target_type===S.LINK_SYMBOL?r:""+l+n},a.renderItem=function(e){return s.default.createElement(P,{className:k.default.item,key:e.code},s.default.createElement(c.Link,{to:(0,y.protocolPrefix)(e),className:k.default.link,target:"_blank"},s.default.createElement("span",{className:T.itemIcon},a.props.generateIconByType(e.target_type)),a.renderItemText(e)),s.default.createElement("span",{className:k.default.close,onClick:function(){return a.onRemoveReference(e)}},s.default.createElement(p.default,null)))},a.state={searchKey:"",loading:!1,createTaskItems:[],showSelector:!1,searchResult:[]},a.onAddCreateTaskItem=a.onAddCreateTaskItem.bind(a),a.onRemoveCreateTaskItem=a.onRemoveCreateTaskItem.bind(a),a.onOwnerChange=a.onOwnerChange.bind(a),a.onPriorityChange=a.onPriorityChange.bind(a),a.onDeadlineChange=a.onDeadlineChange.bind(a),a.onValueChange=a.onValueChange.bind(a),a.onShowSelector=a.onShowSelector.bind(a),a.onHideSelector=a.onHideSelector.bind(a),a.onAddCreateTaskItem=a.onAddCreateTaskItem.bind(a),a.renderItem=a.renderItem.bind(a),a.renderCreateTaskItem=a.renderCreateTaskItem.bind(a),a.onReferenceSelectorConfirm=a.onReferenceSelectorConfirm.bind(a),a.onCreateReferencedTask=a.onCreateReferencedTask.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"onAddCreateTaskItem",value:function(){var e=this;this.setState({createTaskItems:[{owner:this.props.user.id,priority:1,deadline:"",value:""}].concat(j(this.state.createTaskItems))},function(){e.refs["input-0"].input.focus()})}},{key:"onRemoveCreateTaskItem",value:function(e){this.setState({createTaskItems:this.state.createTaskItems.filter(function(t,a){return a!==e})})}},{key:"onOwnerChange",value:function(e,t){var a=[].concat(j(this.state.createTaskItems));a[t].owner=e.value,this.setState({createTaskItems:a})}},{key:"onPriorityChange",value:function(e,t){var a=[].concat(j(this.state.createTaskItems));a[t].priority=e,this.setState({createTaskItems:a})}},{key:"onDeadlineChange",value:function(e,t){var a=[].concat(j(this.state.createTaskItems));a[t].deadline=e,this.setState({createTaskItems:a})}},{key:"onValueChange",value:function(e,t){var a=[].concat(j(this.state.createTaskItems));a[t].value=e,this.setState({createTaskItems:a})}},{key:"onShowSelector",value:function(){this.setState({showSelector:!0})}},{key:"onHideSelector",value:function(){this.setState({showSelector:!1})}},{key:"onReferenceSelectorConfirm",value:function(e){var t=this.props.references,a=e;return this.props.onReferenceSelectorConfirm(t,a)}},{key:"onCreateReferencedTask",value:function(e){var t=this,a=this.state.createTaskItems[e].owner,n=this.state.createTaskItems[e],r=n.priority,l=n.deadline,o=n.value;this.props.onCreateReferencedTask(a,r,l,o).then(function(){t.onRemoveCreateTaskItem(e)})}},{key:"renderCreateTaskItem",value:function(e,t){var a=this;return s.default.createElement(P,{className:k.default.item,key:"create.task-"+t},s.default.createElement(R.default,{items:this.props.members,value:e.owner,className:k.default.avatar,onSelect:function(e){return a.onOwnerChange(e,t)}}),s.default.createElement(E.default,{className:"ml-10",priority:e.priority,onChange:function(e){return a.onPriorityChange(e,t)}}),s.default.createElement(g.default,{className:"ml-10",date:e.deadline,onChange:function(e){return a.onDeadlineChange(e,t)}}),s.default.createElement(h.default,{className:k.default.input,value:e.value,onChange:function(e,n){return a.onValueChange(n,t)},onPressEnter:function(){return a.onCreateReferencedTask(t)},placeholder:"\u6dfb\u52a0\u4e00\u4e2a\u5173\u8054\u4efb\u52a1\uff08\u56de\u8f66\u5b8c\u6210\u6dfb\u52a0\uff09",ref:"input-"+t}),s.default.createElement("span",{className:k.default.close,onClick:function(){return a.onRemoveCreateTaskItem(t)}},s.default.createElement(p.default,null)))}},{key:"render",value:function(){var e=this;return s.default.createElement("div",{className:k.default.resources},s.default.createElement(w.default,{show:this.state.showSelector,onHide:this.onHideSelector,initialSelecteds:this.props.references,onConfirm:this.onReferenceSelectorConfirm,excludeds:[{code:this.props.excludeds||0,id:this.props.currentProject.id}],onAddLink:this.props.onAddExternalLink}),s.default.createElement("div",{className:k.default.content},s.default.createElement("div",null,s.default.createElement("div",{className:k.default.title},s.default.createElement("div",{className:k.default.titleText},"\u5173\u8054\u8d44\u6e90 (",this.props.references.length,")"),s.default.createElement("div",{className:k.default.actionContainer},!b.IS_ENTERPRISE&&s.default.createElement("span",{className:k.default.action,onClick:this.onAddCreateTaskItem},s.default.createElement(f.default,null),s.default.createElement("span",{className:k.default.text},"\u521b\u5efa\u4efb\u52a1")),s.default.createElement(C.default,{detail:{number:0},items:this.props.resourceResults.filter(function(t){return t.code!==e.props.excludeds}),references:this.props.references,onSearch:this.onResourceSearch,onSelect:this.onAddReference,onToggle:this.onResourceToggle,onShowSelector:this.onShowSelector,loading:this.state.loading}))),this.props.references.length>0||this.state.createTaskItems.length>0?s.default.createElement("div",null,s.default.createElement(m.default,{className:k.default.list,type:"block",empty:s.default.createElement("div",null),hover:!0,bordered:!0},!b.IS_ENTERPRISE&&this.state.createTaskItems.map(this.renderCreateTaskItem),this.getRefWithType(S.REF_TYPE.SELF).map(this.renderItem)),s.default.createElement(m.default,{className:k.default.list,type:"block",empty:s.default.createElement("div",null),hover:!0,bordered:!0},this.getRefWithType(S.REF_TYPE.OTHER).map(this.renderItem),this.getRefWithType(S.REF_TYPE.LINKS).map(this.renderItem))):s.default.createElement("div",{className:k.default.desc},"\u70b9\u51fb\u53f3\u4e0a\u89d2\u201c+\u201d\u5173\u8054\u9879\u76ee\u8d44\u6e90\uff08\u91cc\u7a0b\u7891\u3001\u4efb\u52a1\u3001\u5408\u5e76\u8bf7\u6c42\u7b49\uff09",b.IS_ENTERPRISE&&"\u53ca\u6dfb\u52a0\u5916\u90e8\u94fe\u63a5"))))}}]),t}(),r.defaultProps={resourceResults:[]},r.propTypes={user:u.default.object,references:u.default.array,resourceResults:u.default.array,members:u.default.array,onResourceSearch:u.default.func,onAddReference:u.default.func,onRemoveReference:u.default.func,onReferenceSelectorConfirm:u.default.func,onCreateReferencedTask:u.default.func,excludeds:u.default.number,onAddExternalLink:u.default.func,currentProject:u.default.shape({id:u.default.number.isRequired}).isRequired,generateIconByType:u.default.func},n=l))||n;t.default=O},3831:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"blame/**",documentTitle:(0,r.projectPage)(function(e){var t=e.BLAME.blame.data;return t&&t.ref&&t.file&&t.file.path?t.file.path+" - "+t.ref+" - \u6309\u884c\u67e5\u770b":"\u6309\u884c\u67e5\u770b"}),getComponent:function(e,t){Promise.all([a.e(20),a.e(163)]).then(function(){(0,n.injectAsyncReducer)("BLAME",a(3956).default),t(null,a(3957).default)}.bind(null,a)).catch(a.oe)}}},3832:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"blob/**",documentTitle:(0,r.projectPage)(function(e){var t=e.BLOB.blob.data;return t.ref&&t.file&&t.file.path?t.file.path+" - "+t.ref+" - \u4ee3\u7801\u6d4f\u89c8":"\u4ee3\u7801\u6d4f\u89c8"}),getComponent:function(e,t){Promise.all([a.e(20),a.e(164)]).then(function(){(0,n.injectAsyncReducer)("DEPOT",a(1704).default),(0,n.injectAsyncReducer)("BLOB",a(3961).default),t(null,a(3962).default)}.bind(null,a)).catch(a.oe)}}},3833:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"branches**",documentTitle:(0,r.projectPage)(function(){return"\u5206\u652f\u7ba1\u7406"}),getComponent:function(e,t){a.e(165).then(function(){(0,n.injectAsyncReducer)("DEPOT",a(1704).default),(0,n.injectAsyncReducer)("COMPARE",a(1577).default),(0,n.injectAsyncReducer)("BRANCH",a(3972).default),t(null,a(3973).default)}.bind(null,a)).catch(a.oe)}}},3834:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(1449);t.default={path:"commit/**",documentTitle:(0,n.projectPage)(function(){return"\u63d0\u4ea4\u8bb0\u5f55"}),getComponent:function(e,t){a.e(166).then(function(){t(null,a(3995).default)}.bind(null,a)).catch(a.oe)}}},3835:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"commits/**",documentTitle:(0,r.projectPage)(function(e){var t=e.COMMITS,a=t.refName,n=t.path;return a&&!n?a+" - \u63d0\u4ea4\u5386\u53f2":a&&n?n+" - "+a+" - \u63d0\u4ea4\u5386\u53f2":"\u63d0\u4ea4\u5386\u53f2"}),getComponent:function(e,t){a.e(167).then(function(){(0,n.injectAsyncReducer)("COMMITS",a(4002).default),t(null,a(4003).default)}.bind(null,a)).catch(a.oe)}}},3836:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449),l=a(51);t.default={path:"compare**",documentTitle:(0,r.projectPage)(function(){return"\u7248\u672c\u5bf9\u6bd4"}),getComponent:function(e,t){a.e(168).then(function(){(0,n.injectAsyncReducer)("COMPARE",a(1577).default),(0,n.injectAsyncReducer)("TASK_DETAIL",a(1699).default),(0,n.injectAsyncReducer)("REFERENCE_SELECTOR",a(1608).default),(0,l.injectAsyncI18n)("TASK_DETAIL",a(1802)),(0,l.injectAsyncI18n)("REFERENCE_SELECTOR",a(1609)),t(null,a(4007).default)}.bind(null,a)).catch(a.oe)}}},3837:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"edit/**",documentTitle:(0,r.projectPage)(function(e){var t=e.EDITFILE.editFile;return t.data&&t.data.ref&&!t.data.path?t.data.ref+" - \u7f16\u8f91\u6587\u4ef6":t.data&&t.data.ref&&t.data.file.path?t.data.file.path+" - "+t.data.ref+" - \u7f16\u8f91\u6587\u4ef6":"\u7f16\u8f91\u6587\u4ef6"}),getComponent:function(e,t){Promise.all([a.e(21),a.e(169)]).then(function(){(0,n.injectAsyncReducer)("COMPARE",a(1577).default),(0,n.injectAsyncReducer)("EDITFILE",a(4012).default),t(null,a(4013).default)}.bind(null,a)).catch(a.oe)}}},3838:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"find/**",documentTitle:(0,r.projectPage)(function(e){var t=e.FIND.files.branch;return t?t+" - \u67e5\u627e\u6587\u4ef6":"\u67e5\u627e\u6587\u4ef6"}),getComponent:function(e,t){a.e(170).then(function(){(0,n.injectAsyncReducer)("FIND",a(4019).default),t(null,a(4020).default)}.bind(null,a)).catch(a.oe)}}},3839:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(51),l=a(1449);t.default={path:"merge/:iid",documentTitle:(0,l.projectPage)(function(e){var t=e.MERGE_REQUEST.mergeRequest.data;if(t.merge_request){var a=t.merge_request,n=a.title;return"#"+a.iid+" - "+n+" - \u5408\u5e76\u8bf7\u6c42"}return"\u5408\u5e76\u8bf7\u6c42"}),getComponent:function(e,t){a.e(171).then(function(){(0,n.injectAsyncReducer)("MERGE_REQUEST",a(4027).default),(0,n.injectAsyncReducer)("REFERENCE_SELECTOR",a(1608).default),(0,r.injectAsyncI18n)("REFERENCE_SELECTOR",a(1609)),t(null,a(4028).default)}.bind(null,a)).catch(a.oe)},indexRoute:{component:a(3840).default},childRoutes:[{path:"commits",component:a(3874).default},{path:"diff",component:a(3875).default}]}},3840:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=E(a(0)),u=a(2),i=E(u),s=E(a(3841)),c=E(a(3843)),d=E(a(3854)),f=E(a(3855)),m=E(a(3856)),p=E(a(698)),h=E(a(1713));function E(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var v=(r=n=function(e){function t(){var e,a,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,l=Array(r),o=0;o<r;o++)l[o]=arguments[o];return a=n=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),n.updateContent=function(e){return n.props.updateMergeRequestContent(n.props.params.iid,e).then(function(){n.props.updateMergeRequestActivities({action:"update_content",created_at:Date.now(),author:n.props.user})})},g(n,a)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"render",value:function(){var e=this.props.mergeRequest.data.merge_request;return i.default.createElement("div",{className:h.default.show},i.default.createElement("div",{className:h.default.content},i.default.createElement(s.default,{updateContent:this.updateContent,mergeRequest:e,project:this.props.currentProject}),i.default.createElement(m.default,{mergeRequest:this.props.mergeRequest.data,references:this.props.references,resourceResults:this.props.resourceResults,members:this.props.memberItems,onResourceSearch:this.props.resourceSearch,onAddReference:this.props.addReference,onRemoveReference:this.props.removeReference,onReferenceSelectorConfirm:this.props.referenceSelectorConfirm,onCreateReferencedTask:this.props.createReferencedTask,user:this.props.user,reviewers:this.props.reviewers,reviewGood:this.props.reviewGood,cancelReviewGood:this.props.cancelReviewGood,grant:this.props.grant,cancelGrant:this.props.cancelGrant,sayGood:this.props.sayGood,sayBad:this.props.sayBad,mergeMergeRequest:this.props.mergeMergeRequest,refuseMergeRequest:this.props.refuseMergeRequest,cancelMergeRequest:this.props.cancelMergeRequest,updateActivities:this.props.updateMergeRequestActivities,getConflictContent:this.props.getConflictContent,resolvedConflicts:this.props.resolvedConflicts,revertMergeRequest:this.props.revertMergeRequest,deleteSourceBranch:this.props.deleteSourceBranch,restoreSourceBranch:this.props.restoreSourceBranch,push:this.props.push,project:this.props.currentProject,onAddExternalLink:this.props.onAddExternalLink}),(this.props.activities.activityLoading||this.props.activities.commentLoading)&&i.default.createElement(p.default,{show:!0}),!this.props.activities.activityLoading&&!this.props.activities.commentLoading&&i.default.createElement(c.default,{activities:this.props.activities.item,user:this.props.user,doComment:this.props.postLineNote,delComment:this.props.deleteLineNote}),i.default.createElement(d.default,{user:this.props.user,mergeRequest:e,project:this.props.currentProject,doComment:this.props.postLineNote})),i.default.createElement(f.default,{mergeRequest:e,reviewers:this.props.reviewers,watchers:this.props.watchers,labels:this.props.mergeRequest.data.labels,addReviewer:this.props.addReviewer,delReviewer:this.props.delReviewer,addLabel:this.props.addLabel,delLabel:this.props.delLabel,addWatcher:this.props.addWatcher,delWatcher:this.props.delWatcher,user:this.props.user,members:this.props.memberItems,projectLabels:this.props.labels,updateActivities:this.props.updateMergeRequestActivities,project:this.props.currentProject}))}}]),t}(),n.propTypes={updateMergeRequestContent:o.default.func,updateMergeRequestActivities:o.default.func,addReviewer:o.default.func,delReviewer:o.default.func,addLabel:o.default.func,delLabel:o.default.func,addWatcher:o.default.func,delWatcher:o.default.func,resourceSearch:o.default.func,addReference:o.default.func,removeReference:o.default.func,referenceSelectorConfirm:o.default.func,createReferencedTask:o.default.func,reviewGood:o.default.func,cancelReviewGood:o.default.func,grant:o.default.func,cancelGrant:o.default.func,sayGood:o.default.func,sayBad:o.default.func,mergeMergeRequest:o.default.func,refuseMergeRequest:o.default.func,cancelMergeRequest:o.default.func,getConflictContent:o.default.func,resolvedConflicts:o.default.func,revertMergeRequest:o.default.func,deleteSourceBranch:o.default.func,restoreSourceBranch:o.default.func,postLineNote:o.default.func,deleteLineNote:o.default.func,push:o.default.func,user:o.default.object,currentProject:o.default.object,mergeRequest:o.default.shape({loading:o.default.bool,data:o.default.object}),activities:o.default.shape({activityLoading:o.default.bool,commentLoading:o.default.bool,item:o.default.array}),reviewers:o.default.shape({loading:o.default.bool,item:o.default.object}),watchers:o.default.shape({loading:o.default.bool,item:o.default.array}),references:o.default.shape({loading:o.default.bool,item:o.default.object}),resourceResults:o.default.object,memberItems:o.default.array,labels:o.default.array,params:o.default.shape({iid:o.default.string}),onAddExternalLink:o.default.func,projects:o.default.shape({list:o.default.array.isRequired})},r);t.default=v},3841:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l,o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=g(a(0)),i=a(2),s=g(i),c=g(a(1460)),d=g(a(1505)),f=g(a(544)),m=a(51),p=g(a(2257)),h=a(266),E=g(a(1713));function g(e){return e&&e.__esModule?e:{default:e}}(0,m.injectAsyncI18n)("TASK_DETAIL",a(1802));var v=(0,h.withAsyncMarkEditor)()((l=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={edit:!1,editorState:e.defaultEditorState,submitting:!1},a.onSaveRef=a.onSaveRef.bind(a),a.onEdit=a.onEdit.bind(a),a.onCancelEdit=a.onCancelEdit.bind(a),a.onChange=a.onChange.bind(a),a.onUpdateDescription=a.onUpdateDescription.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"onSaveRef",value:function(e){this.editor=e}},{key:"onEdit",value:function(){var e=this;this.setState({edit:!0},function(){e.editor.onFetch(e.props.mergeRequest.body_plan)})}},{key:"onCancelEdit",value:function(){(this.props.getPlainText(this.state.editorState)===this.props.mergeRequest.body_plan||confirm(m.I18n.get("TASK_DETAIL","confirm.to.leave.without.saving")))&&(this.editor.onCancel(),this.setState({edit:!1}))}},{key:"onChange",value:function(e,t){this.setState({editorState:e},t)}},{key:"getData",value:function(){return this.props.getPlainText(this.state.editorState)}},{key:"onUpdateDescription",value:function(){var e=this;if(!this.state.submitting){this.setState({submitting:!0});var t=this.props.getPlainText(this.state.editorState);this.props.updateContent(t).then(function(){e.editor.onSave(),e.setState({edit:!1,submitting:!1})})}}},{key:"renderEditor",value:function(){var e=this.props,t=e.project,a=e.mergeRequest,n=e.MediumMarkEditor;return s.default.createElement("div",{className:E.default.content},s.default.createElement(n,{className:E.default.edit,onChange:this.onChange,editorState:this.state.editorState,projectId:t.id||0,autoSize:!1,onCommandEnter:this.onUpdateDescription,ref:this.onSaveRef,autoSaveKey:"MR_DETAIL_DESCRIPTION_"+a.iid,hashSearchParams:{owner:t.owner_user_name,project:t.name},mentionParams:{context_type:"merge_request_comment",item_id:a.iid,extra_id:t.id}}),s.default.createElement(f.default,{className:"mr-20",onClick:this.onUpdateDescription,loading:this.state.submitting},"\u63d0\u4ea4"),s.default.createElement(f.default,{empty:!0,onClick:this.onCancelEdit},s.default.createElement(m.I18n,{region:"TASK_DETAIL",i18n:"cancel"})))}},{key:"renderMarkdown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.default.createElement(p.default,{className:E.default.content},s.default.createElement(c.default,{html:this.props.mergeRequest.body,className:E.default.descContent}),!e&&s.default.createElement("span",{className:E.default.pencil,onClick:this.onEdit},s.default.createElement(d.default,null)))}},{key:"renderEmpty",value:function(){return s.default.createElement("div",{className:E.default.empty,onClick:this.onEdit},"\u6ca1\u6709\u5408\u5e76\u8bf7\u6c42\u63cf\u8ff0\uff0c\u70b9\u51fb\u6dfb\u52a0")}},{key:"render",value:function(){var e=this.props.mergeRequest;return""===e.body&&"CANMERGE"!==e.merge_status&&"CANNOTMERGE"!==e.merge_status?s.default.createElement("div",null):s.default.createElement("div",{className:E.default.editor},this.state.edit&&this.renderEditor(),!this.state.edit&&!e.body&&this.renderEmpty(),!this.state.edit&&e.body&&this.renderMarkdown("CANMERGE"!==e.merge_status&&"CANNOTMERGE"!==e.merge_status))}}]),t}(),r.propTypes={updateContent:u.default.func,mergeRequest:u.default.object,project:u.default.object,defaultEditorState:u.default.object,MediumMarkEditor:u.default.func,getPlainText:u.default.func},n=l))||n;t.default=v},3843:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=p(a(0)),u=a(2),i=p(u),s=p(a(701)),c=p(a(3844)),d=p(a(3849)),f=p(a(3850)),m=p(a(1808));function p(e){return e&&e.__esModule?e:{default:e}}var h=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={showCommentOnly:!1},a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"renderActivity",value:function(e,t){return e[0].action&&!this.state.showCommentOnly?i.default.createElement("div",{className:m.default.item,key:t},i.default.createElement("div",{className:m.default.details},i.default.createElement("i",null),i.default.createElement(c.default,{activity:e[0]}))):e[0].commitId&&!e[0].action?i.default.createElement("div",{className:m.default.item,key:t},i.default.createElement("div",{className:m.default.details},i.default.createElement("i",null),i.default.createElement(f.default,{comments:e,doComment:this.props.doComment,delComment:this.props.delComment,user:this.props.user}))):e[0].commitId||e[0].action?i.default.createElement("div",null):i.default.createElement("div",{className:m.default.item,key:t},i.default.createElement("div",{className:m.default.details},i.default.createElement("i",null),i.default.createElement(d.default,{comment:e[0],doComment:this.props.doComment,delComment:this.props.delComment,user:this.props.user})))}},{key:"renderActivities",value:function(){return i.default.createElement("div",{className:m.default.items},this.props.activities.map(this.renderActivity,this))}},{key:"render",value:function(){var e=this;return i.default.createElement("div",{className:m.default.timeLine},i.default.createElement("div",{className:m.default.toggle},i.default.createElement(s.default,{onChange:function(){e.setState({showCommentOnly:!e.state.showCommentOnly})},checked:this.state.showCommentOnly},"\u53ea\u770b\u8bc4\u8bba")),this.renderActivities(this))}}]),t}(),n.propTypes={activities:o.default.array,user:o.default.object,doComment:o.default.func,delComment:o.default.func},r);t.default=h},3844:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=p(a(263)),u=a(2),i=p(u),s=p(a(0)),c=p(a(8)),d=a(168),f=a(3845),m=p(a(1808));function p(e){return e&&e.__esModule?e:{default:e}}var h=(r=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"pathForTargetResource",value:function(e,t){return"add_extlink_ref"!==e&&"add_external_extlink_ref"!==e&&"del_extlink_ref"!==e&&"del_external_extlink_ref"!==e?t:new RegExp("^(http|https|mailto|ftp)","i").test(t)?t:"http://"+t}},{key:"renderDesc",value:function(e,t){if(e.reviewer)return i.default.createElement("span",null,e.reviewer.name);if(e.watcher)return i.default.createElement("span",null,e.watcher.name);if(e.label){var a=JSON.parse(e.label);return i.default.createElement("span",null,a.name)}return e.internal_resource?i.default.createElement(d.Link,{to:this.pathForTargetResource(t,e.internal_resource.path),title:e.internal_resource.name,target:"_blank"},i.default.createElement("span",null,e.internal_resource.name)):e.external_resource?i.default.createElement("div",{className:m.default.externalLink},i.default.createElement(d.Link,{to:""+e.external_resource.project_path,target:"_blank"},e.external_resource.project_name),i.default.createElement("span",{className:m.default.projDesc},e.external_resource.conj),i.default.createElement(d.Link,{to:this.pathForTargetResource(t,e.external_resource.path),target:"_blank",title:e.external_resource.name},e.external_resource.name)):null}},{key:"render",value:function(){var e,t=this.props.activity;return f.ACTIVITY_TYPE[t.action]?i.default.createElement("div",{key:t.idx,className:m.default.container},f.ACTIVITY_TYPE[t.action].icon,i.default.createElement("div",{className:m.default.content},i.default.createElement("div",{className:m.default.desc},i.default.createElement("span",{className:m.default.author},i.default.createElement(d.Link,{to:t.author.path},t.author.name)),i.default.createElement("span",null,f.ACTIVITY_TYPE[t.action].text),i.default.createElement("span",{className:(0,c.default)(m.default.actionResource,"ellipsis")},this.renderDesc(t.comment||{},t.action))),i.default.createElement("div",{className:m.default.time},(e=t.created_at,i.default.createElement("time",{title:(0,o.default)(new Date(e)).format("llll")},(0,o.default)(new Date(e)).format("YYYY-MM-DD HH:mm:ss")))))):null}}]),t}(),n.propTypes={activity:s.default.object},r);t.default=h},3845:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ACTIVITY_TYPE=void 0;var n=_(a(2)),r=_(a(1468)),l=_(a(1549)),o=_(a(1563)),u=_(a(1481)),i=_(a(3846)),s=_(a(1796)),c=_(a(3847)),d=_(a(1997)),f=_(a(1502)),m=_(a(1550)),p=_(a(720)),h=_(a(547)),E=_(a(711)),g=_(a(723)),v=_(a(729)),b=_(a(1976)),y=_(a(1830));function _(e){return e&&e.__esModule?e:{default:e}}t.ACTIVITY_TYPE={create:{text:"\u521b\u5efa\u4e86\u5408\u5e76\u8bf7\u6c42",icon:n.default.createElement(r.default,null)},update_content:{text:"\u66f4\u65b0\u4e86\u63cf\u8ff0",icon:n.default.createElement(u.default,null)},update_title:{text:"\u66f4\u65b0\u4e86\u6807\u9898",icon:n.default.createElement(u.default,null)},add_reviewer:{text:"\u589e\u52a0\u4e86\u8bc4\u5ba1\u8005",icon:n.default.createElement(i.default,null)},del_reviewer:{text:"\u79fb\u9664\u4e86\u8bc4\u5ba1\u8005",icon:n.default.createElement(i.default,null)},add_watcher:{text:"\u6dfb\u52a0\u5173\u6ce8\u8005",icon:n.default.createElement(o.default,null)},del_watcher:{text:"\u79fb\u9664\u5173\u6ce8\u8005",icon:n.default.createElement(o.default,null)},add_label:{text:"\u6dfb\u52a0\u6807\u7b7e",icon:n.default.createElement(l.default,null)},del_label:{text:"\u79fb\u9664\u6807\u7b7e",icon:n.default.createElement(l.default,null)},review:{text:"\u5bf9\u6b64\u5408\u5e76\u8bf7\u6c42\u8bc4\u5ba1 +1",icon:n.default.createElement(s.default,null)},review_undo:{text:"\u64a4\u9500\u4e86\u5bf9\u6b64\u5408\u5e76\u8bf7\u6c42\u8bc4\u5ba1 +1",icon:n.default.createElement(c.default,null)},merge:{text:"\u5408\u5e76\u4e86\u8fd9\u4e2a\u5408\u5e76\u8bf7\u6c42",icon:n.default.createElement(p.default,null)},refuse:{text:"\u5173\u95ed\u4e86\u8fd9\u4e2a\u5408\u5e76\u8bf7\u6c42",icon:n.default.createElement(h.default,null)},push:{text:"\u63a8\u9001\u4e86\u65b0\u7684\u63d0\u4ea4\uff0c\u66f4\u65b0\u4e86\u5408\u5e76\u8bf7\u6c42",icon:n.default.createElement(m.default,null)},grant:{text:"\u7ed9\u6b64\u5408\u5e76\u8bf7\u6c42\u6388\u6743\u4e86\u5408\u5e76\u6743\u9650",icon:n.default.createElement(f.default,null)},grant_undo:{text:"\u64a4\u9500\u4e86\u7ed9\u6b64\u5408\u5e76\u8bf7\u6c42\u7684\u5408\u5e76\u6743\u9650",icon:n.default.createElement(d.default,null)},say_good:{text:"\u5141\u8bb8\u4e86\u6b64\u5408\u5e76\u8bf7\u6c42",icon:n.default.createElement(s.default,null)},say_good_and_grant:{text:"\u5141\u8bb8\u4e86\u6b64\u5408\u5e76\u8bf7\u6c42\uff0c\u5e76\u6388\u6743\u4e86\u5408\u5e76\u6743\u9650",icon:n.default.createElement(f.default,null)},say_bad:{text:"\u53d6\u6d88\u4e86\u5bf9\u6b64\u5408\u5e76\u8bf7\u6c42\u7684\u5141\u8bb8",icon:n.default.createElement(c.default,null)},say_bad_and_grant_revoke:{text:"\u53d6\u6d88\u4e86\u5bf9\u6b64\u5408\u5e76\u8bf7\u6c42\u7684\u6743\u9650\u6388\u6743",icon:n.default.createElement(d.default,null)},add_resource_ref:{text:"\u6dfb\u52a0\u4e86\u8d44\u6e90\u5173\u8054",icon:n.default.createElement(r.default,null)},add_milestone_ref:{text:"\u5173\u8054\u4e86\u91cc\u7a0b\u7891",icon:n.default.createElement(b.default,null)},add_task_ref:{text:"\u5173\u8054\u4e86\u4efb\u52a1",icon:n.default.createElement(E.default,null)},add_file_ref:{text:"\u5173\u8054\u4e86\u6587\u4ef6",icon:n.default.createElement(g.default,null)},add_wiki_ref:{text:"\u5173\u8054\u4e86 Wiki",icon:n.default.createElement(v.default,null)},add_release_ref:{text:"\u5173\u8054\u4e86\u7248\u672c\u53d1\u5e03",icon:n.default.createElement(l.default,null)},add_mr_ref:{text:"\u5173\u8054\u4e86\u5408\u5e76\u8bf7\u6c42",icon:n.default.createElement(p.default,null)},add_extlink_ref:{text:"\u5173\u8054\u4e86\u5916\u90e8\u94fe\u63a5",icon:n.default.createElement(y.default,null)},del_milestone_ref:{text:"\u53d6\u6d88\u5173\u8054\u7684\u91cc\u7a0b\u7891",icon:n.default.createElement(b.default,null)},del_task_ref:{text:"\u53d6\u6d88\u5173\u8054\u7684\u4efb\u52a1",icon:n.default.createElement(E.default,null)},del_file_ref:{text:"\u53d6\u6d88\u5173\u8054\u7684\u6587\u4ef6",icon:n.default.createElement(g.default,null)},del_wiki_ref:{text:"\u53d6\u6d88\u5173\u8054\u7684 Wiki",icon:n.default.createElement(v.default,null)},del_release_ref:{text:"\u53d6\u6d88\u5173\u8054\u7684\u7248\u672c\u53d1\u5e03",icon:n.default.createElement(l.default,null)},del_mr_ref:{text:"\u53d6\u6d88\u5173\u8054\u7684\u5408\u5e76\u8bf7\u6c42",icon:n.default.createElement(p.default,null)},del_extlink_ref:{text:"\u53d6\u6d88\u5173\u8054\u7684\u5916\u90e8\u94fe\u63a5",icon:n.default.createElement(y.default,null)},add_external_milestone_ref:{text:"\u5173\u8054\u4e86",icon:n.default.createElement(b.default,null)},add_external_task_ref:{text:"\u5173\u8054\u4e86",icon:n.default.createElement(E.default,null)},add_external_file_ref:{text:"\u5173\u8054\u4e86",icon:n.default.createElement(g.default,null)},add_external_wiki_ref:{text:"\u5173\u8054\u4e86",icon:n.default.createElement(v.default,null)},add_external_release_ref:{text:"\u5173\u8054\u4e86",icon:n.default.createElement(l.default,null)},add_external_mr_ref:{text:"\u5173\u8054\u4e86",icon:n.default.createElement(p.default,null)},add_external_extlink_ref:{text:"\u5173\u8054\u4e86",icon:n.default.createElement(y.default,null)},del_external_milestone_ref:{text:"\u53d6\u6d88\u5173\u8054",icon:n.default.createElement(b.default,null)},del_external_task_ref:{text:"\u53d6\u6d88\u5173\u8054",icon:n.default.createElement(E.default,null)},del_external_file_ref:{text:"\u53d6\u6d88\u5173\u8054",icon:n.default.createElement(g.default,null)},del_external_wiki_ref:{text:"\u53d6\u6d88\u5173\u8054",icon:n.default.createElement(v.default,null)},del_external_release_ref:{text:"\u53d6\u6d88\u5173\u8054",icon:n.default.createElement(l.default,null)},del_external_mr_ref:{text:"\u53d6\u6d88\u5173\u8054",icon:n.default.createElement(p.default,null)},del_external_extlink_ref:{text:"\u53d6\u6d88\u5173\u8054",icon:n.default.createElement(y.default,null)}}},3849:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=j(a(0)),u=a(2),i=j(u),s=a(51),c=j(a(262)),d=j(a(1472)),f=j(a(1585)),m=j(a(1977)),p=j(a(1978)),h=j(a(547)),E=j(a(1481)),g=j(a(699)),v=j(a(1460)),b=j(a(261)),y=a(1451),_=j(a(76)),R=j(a(8)),C=a(168),w=j(a(751)),S=a(1503),T=a(1493),k=a(1495),N=j(a(1808));function j(e){return e&&e.__esModule?e:{default:e}}function P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var O=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={show:a.props.comment.childComments&&a.props.comment.childComments.length>0,value:"",showBlueBorder:!1,submitting:!1},a.getCommentAnchor=a.getCommentAnchor.bind(a),a.onToggle=a.onToggle.bind(a),a.onChange=a.onChange.bind(a),a.onEmojiPick=a.onEmojiPick.bind(a),a.onReply=a.onReply.bind(a),a.onPublishChildComment=a.onPublishChildComment.bind(a),a.onDeleteComment=a.onDeleteComment.bind(a),a.renderComment=a.renderComment.bind(a),a.renderChildComment=a.renderChildComment.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"componentDidMount",value:function(){if(this.isCurrentComment()){var e=this.props.location.hash.slice(1);this.onScroll(e)}}},{key:"getCommentAnchor",value:function(e){return e?"mr-comment-"+e:"mr-comment-"+this.props.comment.id}},{key:"isCurrentComment",value:function(){var e=this,t=this.props.location.hash;if(t==="#"+this.getCommentAnchor())return!0;var a=!1;return(this.props.comment.childComments||[]).forEach(function(n){t==="#"+e.getCommentAnchor(n.id)&&(a=!0)}),a}},{key:"onScroll",value:function(e){var t=this;(0,S.scrollRelatedToTopMenu)(e,10),clearTimeout(this.timer),this.setState({showBlueBorder:!0}),this.timer=setTimeout(function(){return t.setState({showBlueBorder:!1})},5e3)}},{key:"onToggle",value:function(){var e=this,t=!this.state.show;this.setState({show:t},function(){t&&e.refs.input.input.focus()})}},{key:"onChange",value:function(e){var t=e.target.value;this.setState({value:t})}},{key:"onEmojiPick",value:function(e){var t=this,a=this.state.value;a=a?a+" :"+e+": ":":"+e+": ",this.setState({value:a},function(){t.refs.input.input.focus()})}},{key:"onReply",value:function(e){var t=this;this.setState({show:!0,value:(0,T.atUser)(this.state.value,e)},function(){var e=t.refs.input.input,a=t.state.value;e&&(e.focus(),e.selectionStart=a.length,e.selectionEnd=a.length)})}},{key:"onPublishChildComment",value:function(e,t){var a=this;if(!this.state.submitting){var n=this.props.comment;this.setState({submitting:!0}),this.props.doComment("",0,0,0,"",n.anchor,t,"MergeRequestBean",n.noteable_id,n.id).then(function(){a.setState({value:"",submitting:!1}),a.refs.input.input.focus()})}}},{key:"onDeleteComment",value:function(e,t){confirm("\u8bf7\u95ee\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&this.props.delComment(e,t)}},{key:"isTaskOwnerOrCommentOwner",value:function(e){if((0,_.default)(this.props.user))return!1;var t=this.props.user.global_key;return t===this.props.comment.author.global_key||e&&t===e.author.global_key}},{key:"renderComment",value:function(){var e=this,t=this.props,a=t.comment,n=t.location.pathname,r=this.getCommentAnchor();return i.default.createElement("div",{className:N.default.commentContent},i.default.createElement(v.default,{html:a.content}),i.default.createElement("div",{className:N.default.commentStat},i.default.createElement("span",{className:N.default.commentUser},i.default.createElement(C.Link,{to:a.author.path},a.author.name)),i.default.createElement(C.Link,{to:n+"#"+r,className:N.default.time,onClick:function(){return e.onScroll(r)}},i.default.createElement(d.default,null),(0,y.timeFormat)(a.created_at,"YYYY-MM-DD HH:mm")),i.default.createElement("span",{onClick:this.onToggle,className:(0,R.default)(N.default.commentToggle,P({},N.default.withArrow,this.state.show))},i.default.createElement(f.default,null),this.state.show?i.default.createElement(s.I18n,{region:"TASK_DETAIL",i18n:"close.comment"}):i.default.createElement(s.I18n,{region:"TASK_DETAIL",i18n:"open.comment",params:{count:a.childComments&&a.childComments.length||0}})),i.default.createElement("span",{className:N.default.commentButton,onClick:function(){return e.onReply(a.author)}},i.default.createElement(E.default,null),i.default.createElement(s.I18n,{region:"TASK_DETAIL",i18n:"reply"})),this.isTaskOwnerOrCommentOwner()&&i.default.createElement("span",{className:N.default.commentButton,onClick:function(){return e.onDeleteComment(a.id,k.COMMENT_TYPE.COMMENT)}},i.default.createElement(h.default,null),i.default.createElement(s.I18n,{region:"TASK_DETAIL",i18n:"delete"}))))}},{key:"renderChildComment",value:function(){var e=this,t=this.props.comment.childComments||[],a=this.props.location;return t.map(function(t,n){var r=e.getCommentAnchor(t.id);return i.default.createElement("div",{className:N.default.child,key:n,id:r},i.default.createElement(c.default,{src:t.author.avatar,className:N.default.childAvatar,size:"tiny"}),i.default.createElement("div",{className:N.default.childContent},i.default.createElement(v.default,{html:t.content}),i.default.createElement("div",{className:N.default.commentStat},i.default.createElement("span",{className:N.default.commentUser},i.default.createElement(C.Link,{to:t.author.path},t.author.name)),i.default.createElement(C.Link,{className:N.default.time,to:a.pathname+"#"+r,onClick:function(){return e.onScroll(r)}},i.default.createElement(d.default,null),(0,y.timeFormat)(t.created_at,"YYYY-MM-DD HH:mm")),i.default.createElement("span",{className:N.default.commentButton,onClick:function(){return e.onReply(t.author)}},i.default.createElement(E.default,null),"\u56de\u590d"),e.isTaskOwnerOrCommentOwner(t)&&i.default.createElement("span",{className:N.default.commentButton,onClick:function(){return e.onDeleteComment(t.id,k.COMMENT_TYPE.CHILD_COMMENT)}},i.default.createElement(h.default,null),"\u5220\u9664"))))})}},{key:"renderInput",value:function(){var e=this;return i.default.createElement("div",{className:N.default.commentInputContainer},i.default.createElement(b.default,{block:!0,className:N.default.commentInput,value:this.state.value,onChange:this.onChange,onPressEnter:this.onPublishChildComment,ref:"input"}),i.default.createElement(w.default,{onPick:this.onEmojiPick},i.default.createElement(p.default,{className:N.default.smileo})),this.state.submitting&&i.default.createElement(g.default,{className:N.default.arrowRight}),!this.state.submitting&&i.default.createElement(m.default,{className:N.default.arrowRight,onClick:function(){e.onPublishChildComment(null,e.state.value)}}))}},{key:"render",value:function(){var e=this.props.comment;return i.default.createElement("div",{className:N.default.container},i.default.createElement(c.default,{src:e.author.avatar,className:N.default.avatar,size:"small"}),i.default.createElement("div",{id:this.getCommentAnchor(),className:(0,R.default)(N.default.commentBox,P({},N.default.currentComment,this.isCurrentComment()&&this.state.showBlueBorder))},this.renderComment(),this.state.show&&this.renderChildComment(),this.state.show&&this.renderInput()))}}]),t}(),n.propTypes={user:o.default.object,item:o.default.object,comment:o.default.object,onPublishChildComment:o.default.func,onDeleteComment:o.default.func,location:o.default.object,doComment:o.default.func,delComment:o.default.func},r);t.default=(0,C.withRouter)(O)},3850:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=w(a(0)),u=a(2),i=w(u),s=w(a(1585)),c=w(a(547)),d=w(a(3851)),f=w(a(3852)),m=w(a(1460)),p=w(a(263)),h=a(168),E=w(a(700)),g=w(a(1454)),v=w(a(2287)),b=w(a(3853)),y=a(1495),_=a(1503),R=w(a(8)),C=w(a(1808));function w(e){return e&&e.__esModule?e:{default:e}}function S(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var T=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.includeCurrentComment=function(){return a.props.comments.some(function(e){return a.isCurrentComment(e.id)})},a.isCurrentComment=function(e){return a.props.location.hash==="#"+a.getCommentAnchor(e)},a.scroll=function(e){(0,_.scrollRelatedToTopMenu)(e,10),clearTimeout(a.timer),a.setState({showBlueBorder:!0}),a.timer=setTimeout(function(){return a.setState({showBlueBorder:!1})},5e3)},a.state={showForm:!1,showDiff:a.includeCurrentComment()||!a.props.comments[0].outdated,showBlueBorder:!1},a.postComment=a.postComment.bind(a),a.deleteComment=a.deleteComment.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"componentDidMount",value:function(){if(this.includeCurrentComment()){var e=this.props.location.hash.slice(1);this.scroll(e)}}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer)}},{key:"getCommentAnchor",value:function(e){return e?"mr-comment-"+e:"mr-comment-"+this.props.comments[0].id}},{key:"deleteComment",value:function(e){confirm("\u8bf7\u95ee\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&this.props.delComment(e.id,y.COMMENT_TYPE.LINE_NOTE)}},{key:"postComment",value:function(e,t,a,n,r,l,o,u,i,s){var c=this;this.props.doComment(e,t,a,n,r,l,o,u,i).then(function(){s&&s(),c.setState({showForm:!1})})}},{key:"renderComment",value:function(e,t){var a,n=this,r=i.default.createElement(E.default,null,"\u5220\u9664\u8bc4\u8bba"),l=(0,R.default)((S(a={},C.default.comment,!0),S(a,C.default.currentComment,this.isCurrentComment(e.id)&&this.state.showBlueBorder),a));return i.default.createElement("div",{className:l,key:t,id:this.getCommentAnchor(e.id)},i.default.createElement("div",{className:C.default.commentAction},this.props.user.global_key===e.author.global_key&&i.default.createElement(g.default,{placement:"top",overlay:r},i.default.createElement(c.default,{onClick:function(){return n.deleteComment(e)}}))),i.default.createElement(h.Link,{to:e.author.path,className:C.default.avatarLink},i.default.createElement("img",{src:e.author.avatar,alt:e.author.name,height:"28",width:"28",className:C.default.avatar})),i.default.createElement("div",{className:C.default.commentContent},i.default.createElement("strong",null,i.default.createElement(h.Link,{className:C.default.author,to:e.author.path},e.author.name))," ",i.default.createElement("time",{title:(0,p.default)(new Date(e.created_at)).format("llll")},(0,p.default)(new Date(e.created_at)).fromNow()),i.default.createElement("div",{className:C.default.commentContentBody},i.default.createElement(m.default,{html:e.content}))))}},{key:"renderDiff",value:function(e){var t=this,a=e[0],n=a.diffFile;return n?i.default.createElement("div",{className:C.default.file},i.default.createElement("div",{className:C.default.fileHeader},i.default.createElement("span",{className:C.default.path,title:n.path},"RENAME"!==n.changeType&&n.path,"RENAME"===n.changeType&&n.name+" \u2192 "+n.path)),i.default.createElement("div",{className:C.default.fileBody},i.default.createElement(b.default,{split:!1,diff:n,comments:[],showComments:!1,anchor:a.anchor,path:n.path,canComment:!1,noHunk:!0})),i.default.createElement("div",{className:C.default.inlineComments},i.default.createElement("div",{className:C.default.lineComments},e.map(this.renderComment,this),!this.state.showForm&&i.default.createElement("div",{className:C.default.reply},i.default.createElement("div",{className:C.default.replyAvatar},i.default.createElement("img",{className:C.default.avatar,width:"28",height:"28",src:this.props.user.avatar,alt:this.props.user.name})),i.default.createElement("div",{className:C.default.replyContent},i.default.createElement("button",{onClick:function(){t.setState({showForm:!0})}},"\u56de\u590d..."))),this.state.showForm&&i.default.createElement("div",{className:C.default.commentForm},i.default.createElement(v.default,{commitId:a.commitId,line:a.line,changeType:a.change_type,position:a.position,path:n.path,anchor:"diff-"+n.pathMD5,noteableType:"MergeRequestBean",noteableId:a.noteable_id,postComment:this.postComment,cancel:function(){t.setState({showForm:!1})}}))))):i.default.createElement("div",null)}},{key:"render",value:function(){var e=this,t=this.state.showDiff,a=this.props.comments;return i.default.createElement("div",{className:C.default.lineNote},i.default.createElement("div",{className:C.default.header},i.default.createElement("div",null,i.default.createElement(s.default,null)),i.default.createElement("div",{className:C.default.content},i.default.createElement("div",{className:C.default.desc},i.default.createElement("span",{className:C.default.author},i.default.createElement(h.Link,{to:a[0].author.path},a[0].author.name)),i.default.createElement("span",null,!a[0].outdated&&"\u5bf9\u6587\u4ef6\u6539\u52a8\u53d1\u8d77\u4e86\u8ba8\u8bba",a[0].outdated&&"\u5bf9\u8fc7\u65f6\u7684\u6587\u4ef6\u6539\u52a8\u53d1\u8d77\u4e86\u8ba8\u8bba")),i.default.createElement("div",{className:C.default.time},i.default.createElement("time",{title:(0,p.default)(new Date(a[0].created_at)).format("llll")},(0,p.default)(new Date(a[0].created_at)).format("MM-DD HH:mm:ss")))),i.default.createElement("div",{className:C.default.toggleDiff,onClick:function(){e.setState({showDiff:!t})}},t&&i.default.createElement(f.default,null),t&&" \u6536\u8d77\u8be6\u60c5",!t&&i.default.createElement(d.default,null),!t&&" \u5c55\u5f00\u8be6\u60c5")),t&&this.renderDiff(a))}}]),t}(),n.propTypes={user:o.default.object,comments:o.default.array,doComment:o.default.func,delComment:o.default.func,location:o.default.object},r);t.default=(0,h.withRouter)(T)},3853:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DiffBody=void 0;var n,r,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=M(a(0)),i=a(2),s=M(i),c=M(a(2124)),d=M(a(545)),f=a(1742),m=M(a(1747)),p=M(a(2287)),h=M(a(8)),E=M(a(2127)),g=M(a(699)),v=M(a(547)),b=M(a(2129)),y=M(a(2123)),_=M(a(1460)),R=M(a(700)),C=M(a(1454)),w=M(a(263)),S=a(1503),T=M(a(1637)),k=a(1495),N=a(168),j=M(a(2122)),P=M(a(1450)),O=M(a(1867)),A=M(a(1587));function M(e){return e&&e.__esModule?e:{default:e}}function L(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var x=/^@@ \-(\d+),(\d+) \+(\d+),(\d+) @@.*$/,I=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(a.includeCurrentComment=function(){return a.props.comments.some(function(e){return a.isCurrentComment(e.id)})},a.isCurrentComment=function(e){return a.props.location.hash==="#"+a.getCommentAnchor(e)},a.scroll=function(e){(0,S.scrollRelatedToTopMenu)(e,10),clearTimeout(a.timer),a.setState({showBlueBorder:!0}),a.timer=setTimeout(function(){return a.setState({showBlueBorder:!1})},5e3)},a.postComment=a.postComment.bind(a),a.deleteComment=a.deleteComment.bind(a),a.renderTooLarge=a.renderTooLarge.bind(a),!a.props.tooLarge){var n={};e.comments.forEach(function(e){n[e.position]||(n[e.position]={show:!0,showForm:!1,position:e.position,line:e.line,changeType:e.change_type,comments:[],comment:""}),n[e.position].comments.push(e)}),a.state={diffLines:e.diff.diffLines,expandLoading:[],commentForms:n,showBlueBorder:!1},j.default.format(a.state.diffLines)}return a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"componentDidMount",value:function(){if(this.includeCurrentComment()){var e=this.props.location.hash.slice(1);this.scroll(e)}}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer)}},{key:"getCommentAnchor",value:function(e){return e?"mr-comment-"+e:"mr-comment-"+this.props.comments[0].id}},{key:"deleteComment",value:function(e){var t=this;if(confirm("\u8bf7\u95ee\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")){var a=this.state.commentForms;this.props.deleteLineNote(e.id,k.COMMENT_TYPE.LINE_NOTE).then(function(){(0,T.default)(a[e.position].comments,e),(0,T.default)(t.props.comments,e),0===a[e.position].comments.length&&(a[e.position].show=!1),t.setState({commentForms:a})})}}},{key:"postComment",value:function(e,t,a,n,r,l,o,u,i,s){var c=this,d=this.state.commentForms;this.props.postLineNote(e,t,a,n,r,l,o,u,i).then(function(e){c.props.comments.push(e),d[n].comments.push(e),d[n].showForm=!1,d[n].comment="",c.setState({commentForms:d}),s&&s()})}},{key:"renderImageDiff",value:function(e){var t=this.props,a=t.depotPath,n=t.ref1;return s.default.createElement("table",null,s.default.createElement("tbody",null,s.default.createElement("tr",null,"modify"===e.changeType&&s.default.createElement("td",null,s.default.createElement("div",{className:A.default.binAdd},s.default.createElement("img",{src:a+"/raw/"+e.linkRef+"/"+e.path,alt:e.path})),s.default.createElement("div",{className:A.default.binDel},s.default.createElement("img",{src:a+"/raw/"+n+"/"+e.path,alt:e.path}))),"add"===e.changeType&&s.default.createElement("td",null,s.default.createElement("div",{className:A.default.binAdd},s.default.createElement("img",{src:a+"/raw/"+e.linkRef+"/"+e.path,alt:e.path}))),"del"===e.changeType&&s.default.createElement("td",null,s.default.createElement("div",{className:A.default.binDel},s.default.createElement("img",{src:a+"/raw/"+n+"/"+e.path,alt:e.path}))))))}},{key:"renderTooLarge",value:function(){var e=this.props,t=e.depotPath,a=e.ref1,n=e.ref2,r=e.path,l=t+"/compare/"+a+"..."+n+".diff?path="+(0,P.default)(r);return s.default.createElement("table",null,s.default.createElement("tbody",null,s.default.createElement("tr",null,s.default.createElement("td",null,s.default.createElement("pre",{className:A.default.noPreview},"Diff \u5185\u5bb9\u8fc7\u5927\uff0c\u4e0d\u5b9c\u5728\u7f51\u9875\u5c55\u793a\u3002 \u8bf7"," ",s.default.createElement("a",{target:"_blank",href:l},"\u4e0b\u8f7d")," ","\u67e5\u770b\u3002")))))}},{key:"renderLFSPreview",value:function(){return s.default.createElement("table",null,s.default.createElement("tbody",null,s.default.createElement("tr",null,s.default.createElement("td",null,s.default.createElement("pre",{className:A.default.noPreview},"\u65e0\u6cd5\u663e\u793a Git LFS \u53d8\u5316")))))}},{key:"renderNoPreview",value:function(){return s.default.createElement("table",null,s.default.createElement("tbody",null,s.default.createElement("tr",null,s.default.createElement("td",null,s.default.createElement("pre",{className:A.default.noPreview},"\u4e0d\u652f\u6301\u9884\u89c8\u6b64\u6587\u4ef6")))))}},{key:"renderNoDiff",value:function(){return s.default.createElement("table",null,s.default.createElement("tbody",null,s.default.createElement("tr",null,s.default.createElement("td",null,s.default.createElement("pre",{className:A.default.noPreview},"\u65e0\u5185\u5bb9\u53d8\u5316")))))}},{key:"renderEmptyLineNumber",value:function(){return s.default.createElement("th",{className:(0,h.default)(A.default.diffLineNumber,A.default.empty)})}},{key:"renderEmptyLineCode",value:function(){return s.default.createElement("td",{className:(0,h.default)(A.default.diffLineCode,A.default.empty),type:"empty"})}},{key:"renderEmptyLine",value:function(e,t,a){var n=this,r=Math.abs(a);(0,m.default)(r,function(){e.push(n.renderEmptyLineNumber()),t.push(n.renderEmptyLineCode())})}},{key:"renderLineCode",value:function(e,t){var a=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e===A.default.blobExpand)return s.default.createElement("td",{className:(0,h.default)(A.default.diffLineCode,e),type:"blobExpand"},s.default.createElement("pre",null,t.text));var r=void 0,l=void 0,o=void 0;"+"===t.prefix?(r="add",l=1,o=t.rightNo):"-"===t.prefix?(r="del",l=2,o=t.leftNo):(r="no",l=3,o=t.leftNo);var u=this.state.commentForms;u[t.index]&&u[t.index].show||(u[t.index]={show:!1,showForm:!1,position:t.index,line:o,changeType:l,comments:[]});var i=s.default.createElement("span",{className:A.default.noNewline},s.default.createElement(y.default,null)),d=t.text;if(!d.substring(0,d.length-1).match(x)){if(d=d.replace(/\\ No newline at end of file$/g,"\x01\x01"),this.props.highlight)d=this.props.diff.language&&O.default.getLanguage(this.props.diff.language)?O.default.highlight(this.props.diff.language,d,!0).value:O.default.highlightAuto(d).value;else{var f=document.createElement("div");f.appendChild(document.createTextNode(d)),d=f.innerHTML}d=d.replace(/\u0001\u0003/g,'<span class="x">').replace(/\u0003\u0001/g,"</span>").replace(/\t/g,"<span class='t'>\t</span>").replace(/\u0001\u0001$/g,c.default.renderToString(i))}return s.default.createElement("td",{className:(0,h.default)(A.default.diffLineCode,e),"data-index":t.index,type:r},this.props.canComment&&n&&s.default.createElement(b.default,{className:A.default.icon,onClick:function(){u[t.index].show=!0,u[t.index].showForm=!0,a.setState({commentForms:u})}}),s.default.createElement("pre",{dangerouslySetInnerHTML:{__html:d}}))}},{key:"renderLineNumber",value:function(e,t){return e===A.default.blobExpand?s.default.createElement("th",{className:(0,h.default)(A.default.diffLineNumber,e),type:"blobExpand","data-line-data":t}):s.default.createElement("th",{className:(0,h.default)(A.default.diffLineNumber,e),"data-line-data":t})}},{key:"renderExpandLine",value:function(e,t){var a=this,n=this.state.expandLoading;return s.default.createElement("th",{className:(0,h.default)(A.default.diffLineNumber,A.default.gc,A.default.hunk,A.default.extend,n[t]?A.default.disabled:""),colSpan:e?"":"2",type:"hunk",onClick:function(){return a.blobExpand(t)}},n[t]&&s.default.createElement(g.default,null),!n[t]&&s.default.createElement(E.default,null))}},{key:"parseHunkHeader",value:function(e){var t=e;if(!t)return null;"\n"===t[t.length-1]&&(t=t.substring(0,t.length-1));var a=t.match(x),n=[];if(a)for(var r=0;r<4;r++)n.push(parseInt(a[r+1],10)||0);else for(var l=0;l<4;l++)n.push(0);return n}},{key:"generateHunkHeader",value:function(e,t){var a=this.parseHunkHeader(e);return a[0]-=t,a[1]+=t,a[2]-=t,a[3]+=t,"@@ -"+a[0]+","+a[1]+" +"+a[2]+","+a[3]+" @@\n"}},{key:"blobExpand",value:function(e){var t=this.props,a=t.ref2,n=t.diff,r=this.state,o=r.diffLines,u=r.expandLoading;if(!u[e]){var i=o[e-1],s=o[e+1],c=i&&i.rightNo||0,d=s&&s.rightNo||0,f=0,m=0,p=e;if(u[e]=!0,this.setState({expandLoading:u}),i&&s){f=s.leftNo-i.leftNo>20?s.leftNo-21:i.leftNo,m=s.rightNo-i.rightNo>20?s.rightNo-21:i.rightNo;var h=this.state.diffLines,E=this;p=e+1,this.props.fetchBlobExpand(a,n.path,d,c).then(function(t){var a=t.data;a.forEach(function(e){f++,m++,h.splice(p,0,{leftNo:f,rightNo:m,text:e,prefix:"*"}),p++}),h[e-1].rightNo+1===h[e+1].rightNo||h[e-1].rightNo===h[e+1].rightNo?h.splice(e,1):h[e]=l({},h[e],{text:E.generateHunkHeader(h[e].text,a.length)}),E.setState({diffLines:h,expandLoading:[]})})}else if(i){f=i.leftNo,m=i.rightNo;var g=this.state.diffLines,v=this;this.props.fetchBlobExpand(a,n.path,d,c).then(function(e){var t=e.data;t.forEach(function(e){f++,m++,g.splice(p,0,{leftNo:f,rightNo:m,text:e,prefix:"*"}),p++}),s?g[p-1].rightNo===g[p+1].rightNo||g[p-1].rightNo+1===g[p+1].rightNo?g.splice(p,1):g[p].text=v.generateHunkHeader(g[p].text,t.length):t.length<20&&(g[g.length-1].prefix="$"),v.setState({diffLines:g,expandLoading:[]})})}else{f=s.leftNo,m=s.rightNo;var b=this.state.diffLines,y=this;this.props.fetchBlobExpand(a,n.path,d,c).then(function(e){var t=e.data;t.reverse(),t.forEach(function(e){f--,m--,b.splice(1,0,{leftNo:f,rightNo:m,text:e,prefix:"*"})}),1===b[1].rightNo?b.splice(0,1):b[0].text=y.generateHunkHeader(b[0].text,t.length),y.setState({diffLines:b,expandLoading:[]})})}}}},{key:"renderLineCommentsContainer",value:function(e){var t=this,a=this.props.user,n=this.state.commentForms,r=n[e];return s.default.createElement("div",{className:A.default.lineCommentsContainer},r.comments&&r.comments.length>0&&this.renderComments(e),r.comments&&r.comments.length>0&&!r.showForm&&s.default.createElement("div",{className:(0,h.default)(A.default.comment,A.default.reply)},s.default.createElement("div",{className:A.default.replyAvatar},s.default.createElement("img",{className:A.default.avatar,width:"28",height:"28",src:a.avatar,alt:a.name})),s.default.createElement("div",{className:A.default.replyContent},s.default.createElement("button",{onClick:function(){n[e].showForm=!0,t.setState({commentForms:n})}},"\u56de\u590d..."))),r.showForm&&this.renderInlineCommentForm(e))}},{key:"renderComments",value:function(e){return this.state.commentForms[e].comments.map(this.renderComment,this)}},{key:"renderComment",value:function(e,t){var a,n,r=this,l=s.default.createElement(R.default,null,"\u5220\u9664\u8bc4\u8bba"),o=(0,h.default)((L(a={},A.default.comment,!0),L(a,A.default.currentComment,this.isCurrentComment(e.id)&&this.state.showBlueBorder),a));return s.default.createElement("div",{className:o,key:t},s.default.createElement("div",{className:A.default.commentAction},this.props.user.global_key===e.author.global_key&&s.default.createElement(C.default,{placement:"top",overlay:l},s.default.createElement(v.default,{onClick:function(){return r.deleteComment(e)}}))),s.default.createElement(N.Link,{to:e.author.path,className:A.default.avatarLink},s.default.createElement("img",{src:e.author.avatar,alt:e.author.name,height:"28",width:"28",className:A.default.avatar})),s.default.createElement("div",{className:A.default.commentContent},s.default.createElement("strong",null,s.default.createElement(N.Link,{className:A.default.author,to:e.author.path},e.author.name))," ",(n=e.created_at,s.default.createElement("time",{title:(0,w.default)(new Date(n)).format("llll")},(0,w.default)(new Date(n)).fromNow())),s.default.createElement("div",{className:A.default.commentContentBody},s.default.createElement(_.default,{html:e.content}))))}},{key:"renderInlineCommentForm",value:function(e){var t=this,a=this.props,n=a.ref2,r=a.anchor,l=a.path,o=a.noteableId,u=a.noteableType,i=this.state.commentForms,c=i[e];return s.default.createElement(p.default,{commitId:n,line:c.line,changeType:c.changeType,position:c.position,path:l,anchor:r,noteableType:u,noteableId:o,postComment:this.postComment,comments:c.comments,comment:c.comment,onCommentChange:function(a){i[e].comment=a,t.setState({commentForms:i})},cancel:function(){c.comments&&c.comments.length>0?i[e].show=!0:i[e].show=!1,i[e].showForm=!1,t.setState({commentForms:i})}})}},{key:"render",value:function(){var e=this,t=this.props,a=t.split,n=t.diff,r=t.showComments;if(t.tooLarge)return this.renderTooLarge();var l=this.state.commentForms,o=[];if("binary"===n.fileType)return this.renderNoPreview();if("LFS"===n.fileType)return this.renderLFSPreview();if("image"===n.fileType)return this.renderImageDiff(n);if(0===n.diffLines.length)return this.renderNoDiff();var u=this.state.diffLines;if(0===u.length)return this.renderNoDiff();var i=0,c=0,d=[],f=[],m=[],p=[],E="\0";if(u.forEach(function(t,n){if(0===t.leftNo&&0===t.rightNo){var r=e.parseHunkHeader(t.text);r&&(r[0]>1||r[2]>1)?a?(d.push(e.renderExpandLine(!0,n)),f.push(s.default.createElement("td",{className:(0,h.default)(A.default.diffLineCode,A.default.gc),colSpan:"3"},s.default.createElement("pre",null,t.text))),m.push(s.default.createElement("th",null)),p.push(s.default.createElement("td",null))):(d.push(e.renderExpandLine(!1,n)),m.push(s.default.createElement("th",null)),f.push(e.renderLineCode(A.default.gc,t,!1))):a?(d.push(s.default.createElement("th",{className:(0,h.default)(A.default.diffLineNumber,A.default.gc,A.default.hunk),type:"hunk"},"...")),f.push(s.default.createElement("td",{className:(0,h.default)(A.default.diffLineCode,A.default.gc),colSpan:"3"},s.default.createElement("pre",null,t.text))),m.push(s.default.createElement("th",null)),p.push(s.default.createElement("td",null))):(d.push(s.default.createElement("th",{className:(0,h.default)(A.default.diffLineNumber,A.default.gc,A.default.hunk),colSpan:"2",type:"hunk"},"...")),m.push(s.default.createElement("th",null)),f.push(e.renderLineCode(A.default.gc,t,!1)))}else{var l=void 0,o=void 0,u=void 0,g=void 0,v=d,b=f;if("+"===t.prefix)l=" ",u=a?A.default.empty:"",o=t.rightNo,g=A.default.gi,a&&(v=m,b=p,l=o,u=g),i++;else if("-"===t.prefix)l=t.leftNo,u=A.default.gd,o=" ",g=A.default.empty,c++;else{if(l=t.leftNo,o=t.rightNo,u=g="*"===t.prefix||"$"===t.prefix?A.default.blobExpand:A.default.ge,a){if("-"===E||"+"===E){var y=i-c;0!==y&&e.renderEmptyLine(y>0?d:m,y>0?f:p,y)}m.push(e.renderLineNumber(u,o)),p.push(e.renderLineCode(u,t,!0))}i=0,c=0}var _=""===u?g:u;v.push(e.renderLineNumber(_,l)),a||m.push(e.renderLineNumber(_,o)),b.push(e.renderLineCode(_,t,!0))}E=t.prefix}),a&&("-"===E||"+"===E)){var g=i-c;0!==g&&this.renderEmptyLine(g>0?d:m,g>0?f:p,g)}var v=0;return d.forEach(function(t,n){if(a){if(o.push(s.default.createElement("tr",{className:(0,h.default)(A.default.diffLine,"blobExpand"===t.props.type?A.default.blobExpandLine:""),key:v++},t,f[n],"hunk"!==t.props.type&&m[n],"hunk"!==t.props.type&&p[n])),"blobExpand"!==t.props.type&&"hunk"!==t.props.type){var u=void 0;if(u=f[n].props.children?f[n].props["data-index"]:p[n].props.children?p[n].props["data-index"]:0,"no"===f[n].props.type&&"no"===p[n].props.type)l[u].show&&r&&o.push(s.default.createElement("tr",{className:A.default.inlineComments,key:v++},s.default.createElement("td",{className:A.default.lineComments,colSpan:"4"},e.renderLineCommentsContainer(u))));else if("empty"===f[n].props.type&&"empty"!==p[n].props.type&&l[u].show&&r&&o.push(s.default.createElement("tr",{className:A.default.inlineComments,key:v++},s.default.createElement("td",{className:A.default.lineComments,colSpan:"2"},s.default.createElement("div",{className:A.default.lineCommentsContainer})),s.default.createElement("td",{className:A.default.lineComments,colSpan:"2"},e.renderLineCommentsContainer(u)))),"empty"!==f[n].props.type&&"empty"===p[n].props.type&&l[u].show&&r&&o.push(s.default.createElement("tr",{className:A.default.inlineComments,key:v++},s.default.createElement("td",{className:A.default.lineComments,colSpan:"2"},e.renderLineCommentsContainer(u)),s.default.createElement("td",{className:A.default.lineComments,colSpan:"2"},s.default.createElement("div",{className:A.default.lineCommentsContainer})))),"empty"!==f[n].props.type&&"empty"!==p[n].props.type){var i=f[n].props["data-index"],c=p[n].props["data-index"],d=l[i],E=l[c];(d.show||E.show)&&r&&o.push(s.default.createElement("tr",{className:A.default.inlineComments,key:v++},s.default.createElement("td",{className:A.default.lineComments,colSpan:"2"},e.renderLineCommentsContainer(i)),s.default.createElement("td",{className:A.default.lineComments,colSpan:"2"},e.renderLineCommentsContainer(c))))}}}else{if(e.props.noHunk&&("blobExpand"===t.props.type||"hunk"===t.props.type))return;if(o.push(s.default.createElement("tr",{className:(0,h.default)(A.default.diffLine,"blobExpand"===t.props.type?A.default.blobExpandLine:""),key:v++},t,"hunk"!==t.props.type&&m[n],f[n])),"blobExpand"!==t.props.type&&"hunk"!==t.props.type){var g=f[n].props["data-index"];l[g].show&&r&&o.push(s.default.createElement("tr",{className:A.default.inlineComments,key:v++},s.default.createElement("td",{className:A.default.lineComments,colSpan:"3"},e.renderLineCommentsContainer(g))))}}})," "!==E&&"*"!==E||o.push(s.default.createElement("tr",{className:A.default.diffLine,key:v},this.renderExpandLine(a,d.length),a&&s.default.createElement("td",{className:(0,h.default)(A.default.diffLineCode,A.default.gc),colSpan:"3"},s.default.createElement("pre",null)),!a&&s.default.createElement("th",{className:(0,h.default)(A.default.diffLineCode,A.default.gc)}))),s.default.createElement("table",{className:(0,h.default)(a?A.default.splitDiff:"",this.props.inline?A.default.inline:"",this.props.tab?A.default.tab:"",this.props.wrap?A.default.wrap:"")},a&&s.default.createElement("colgroup",null,s.default.createElement("col",{width:"44"}),s.default.createElement("col",null),s.default.createElement("col",{width:"44"}),s.default.createElement("col",null)),s.default.createElement("tbody",null,o))}}]),t}(),n.propTypes={diff:u.default.object,comments:u.default.array,showComments:u.default.bool,noHunk:u.default.bool,tooLarge:u.default.bool,split:u.default.bool,ref1:u.default.string,ref2:u.default.string,anchor:u.default.string,path:u.default.string,depotPath:u.default.string,noteableType:u.default.string,noteableId:u.default.number,canComment:u.default.bool,fetchBlobExpand:u.default.func,postLineNote:u.default.func,deleteLineNote:u.default.func,user:u.default.shape({avatar:u.default.string,name:u.default.string,global_key:u.default.string}),wrap:u.default.bool,tab:u.default.bool,inline:u.default.bool,highlight:u.default.bool,location:u.default.object},n.defaultProps={canComment:!0},r),D=t.DiffBody=(0,N.withRouter)(I);t.default=(0,d.default)(function(e){return{user:e.APP.user}},{fetchBlobExpand:f.fetchBlobExpand})(D)},3854:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l,o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=p(a(0)),i=a(2),s=p(i),c=p(a(544)),d=a(266),f=a(112),m=p(a(1713));function p(e){return e&&e.__esModule?e:{default:e}}var h=(0,d.withAsyncMarkEditor)()((l=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={editorState:e.defaultEditorState,submitting:!1},a.onSaveRef=a.onSaveRef.bind(a),a.onChange=a.onChange.bind(a),a.onPublishComment=a.onPublishComment.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"onSaveRef",value:function(e){this.editor=e}},{key:"onChange",value:function(e,t){this.setState({editorState:e},t)}},{key:"onPublishComment",value:function(){var e=this;if(!this.state.submitting){var t=this.props.getPlainText(this.state.editorState);t.trim()?(this.setState({submitting:!0}),this.props.doComment("",0,0,0,"","",t,"MergeRequestBean",this.props.mergeRequest.id,0).then(function(){e.editor.onSave(),e.setState({submitting:!1})})):(0,f.danger)("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a")}}},{key:"render",value:function(){var e=this.props,t=e.mergeRequest,a=e.project,n=e.MediumMarkEditor,r=e.isMac?"Command":"Ctrl";return s.default.createElement("div",{className:m.default.commentContainer},s.default.createElement(n,{className:m.default.comment,autoSaveAlertDisabled:!0,placeholder:"\u5728\u6b64\u8f93\u5165\u8bc4\u8bba\u5185\u5bb9\uff08"+r+" + Enter \u53d1\u9001\uff09",onChange:this.onChange,editorState:this.state.editorState,projectId:a.id||0,autoSize:!1,onCommandEnter:this.onPublishComment,ref:this.onSaveRef,autoSaveKey:"MERGE_REQUEST_COMMENT_"+t.iid,mentionParams:{context_type:"merge_request_comment",item_id:t.iid,extra_id:a.id},hashSearchParams:{owner:a.owner_user_name,project:a.name}}),s.default.createElement(c.default,{className:"mr-20",onClick:this.onPublishComment,loading:this.state.submitting},"\u53d1\u8868"))}}]),t}(),r.propTypes={user:u.default.object,project:u.default.object,mergeRequest:u.default.object,doComment:u.default.func,defaultEditorState:u.default.object,MediumMarkEditor:u.default.func,getPlainText:u.default.func,isMac:u.default.bool},n=l))||n;t.default=h},3855:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=E(a(0)),u=a(2),i=E(u),s=E(a(1961)),c=E(a(2288)),d=E(a(2289)),f=E(a(262)),m=E(a(8)),p=a(168),h=E(a(1797));function E(e){return e&&e.__esModule?e:{default:e}}var g=(r=n=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addReviewer=e.addReviewer.bind(e),e.delReviewer=e.delReviewer.bind(e),e.addLabel=e.addLabel.bind(e),e.delLabel=e.delLabel.bind(e),e.addWatcher=e.addWatcher.bind(e),e.delWatcher=e.delWatcher.bind(e),e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"addReviewer",value:function(e){var t=this;this.props.addReviewer(this.props.mergeRequest.iid,e).then(function(){t.props.updateActivities({action:"add_reviewer",created_at:Date.now(),author:t.props.user,comment:{reviewer:e}})})}},{key:"delReviewer",value:function(e){var t=this;this.props.delReviewer(this.props.mergeRequest.iid,e.id).then(function(){t.props.updateActivities({action:"del_reviewer",created_at:Date.now(),author:t.props.user,comment:{reviewer:e}})})}},{key:"addLabel",value:function(e){var t=this;this.props.addLabel(this.props.mergeRequest.iid,e).then(function(){t.props.updateActivities({action:"add_label",created_at:Date.now(),author:t.props.user,comment:{label:JSON.stringify(e)}})})}},{key:"delLabel",value:function(e){var t=this;this.props.delLabel(this.props.mergeRequest.iid,e.id).then(function(){t.props.updateActivities({action:"del_label",created_at:Date.now(),author:t.props.user,comment:{label:JSON.stringify(e)}})})}},{key:"addWatcher",value:function(e){var t=this;this.props.addWatcher(this.props.mergeRequest.iid,e).then(function(){t.props.updateActivities({action:"add_watcher",created_at:Date.now(),author:t.props.user,comment:{watcher:e}})})}},{key:"delWatcher",value:function(e){var t=this;this.props.delWatcher(this.props.mergeRequest.iid,e.id).then(function(){t.props.updateActivities({action:"del_watcher",created_at:Date.now(),author:t.props.user,comment:{watcher:e}})})}},{key:"render",value:function(){var e=this.props,t=e.mergeRequest,a=e.reviewers,n=e.watchers,r=e.labels,l=e.projectLabels,o=e.project,u="CANMERGE"===t.merge_status||"CANNOTMERGE"===t.merge_status,E=this.props.members.filter(function(e){return e.type>=80});return i.default.createElement("div",{className:h.default.sidebarContainer},i.default.createElement("div",{className:h.default.section},i.default.createElement("span",{className:h.default.title},"\u5f15\u7528 ID"),i.default.createElement("div",null,"#",t.iid)),i.default.createElement("div",{className:(0,m.default)(h.default.section,h.default.deadline)},i.default.createElement("span",{className:h.default.title},"\u53d1\u8d77\u8005"),i.default.createElement(p.Link,{className:h.default.author,to:t.author.path},i.default.createElement(f.default,{src:t.author.avatar,size:"tiny"}),i.default.createElement("span",{className:h.default.name},t.author.name))),!a.loading&&i.default.createElement(s.default,{reviewers:a.data.reviewers.map(function(e){return e.reviewer}),addReviewer:this.addReviewer,delReviewer:this.delReviewer,members:E,author:t.author,canEdit:u}),i.default.createElement(c.default,{projectLabels:l,labels:r,addLabel:this.addLabel,delLabel:this.delLabel,project:o,canEdit:u}),!n.loading&&i.default.createElement(d.default,{watchers:n.item,addWatcher:this.addWatcher,delWatcher:this.delWatcher,members:E,canEdit:u}))}}]),t}(),n.propTypes={mergeRequest:o.default.object,reviewers:o.default.object,watchers:o.default.object,labels:o.default.array,addReviewer:o.default.func,delReviewer:o.default.func,addLabel:o.default.func,delLabel:o.default.func,addWatcher:o.default.func,delWatcher:o.default.func,updateActivities:o.default.func,user:o.default.object,members:o.default.array,projectLabels:o.default.array,project:o.default.object},r);t.default=g},3856:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=g(a(0)),u=a(2),i=g(u),s=g(a(3857)),c=g(a(3859)),d=g(a(3861)),f=g(a(3869)),m=g(a(3870)),p=g(a(3871)),h=g(a(3872)),E=g(a(1614));function g(e){return e&&e.__esModule?e:{default:e}}var v=(r=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"render",value:function(){var e=this.props,t=e.mergeRequest,a=e.reviewers;return i.default.createElement("div",{className:E.default.container},i.default.createElement(s.default,{mergeRequest:this.props.mergeRequest.merge_request,references:this.props.references,resourceResults:this.props.resourceResults,members:this.props.members,onResourceSearch:this.props.onResourceSearch,onAddReference:this.props.onAddReference,onRemoveReference:this.props.onRemoveReference,onReferenceSelectorConfirm:this.props.onReferenceSelectorConfirm,onCreateReferencedTask:this.props.onCreateReferencedTask,onAddExternalLink:this.props.onAddExternalLink,project:this.props.project}),t.merge_request.marks&&t.merge_request.marks.length>0&&i.default.createElement(p.default,{marks:t.merge_request.marks}),("CANMERGE"===t.merge_request.merge_status||"CANNOTMERGE"===t.merge_request.merge_status)&&t.target_is_protected&&i.default.createElement(c.default,{hint:t.can_merge_hint}),("CANMERGE"===t.merge_request.merge_status||"CANNOTMERGE"===t.merge_request.merge_status)&&i.default.createElement(d.default,{mergeRequest:this.props.mergeRequest,user:this.props.user,getConflictContent:this.props.getConflictContent,resolvedConflicts:this.props.resolvedConflicts}),!a.loading&&(a.data.reviewers.filter(function(e){return 100===e.value}).length>0||a.data.volunteer_reviewers.length>0)&&i.default.createElement(f.default,{reviewers:a.data}),!a.loading&&("CANMERGE"===t.merge_request.merge_status||"CANNOTMERGE"===t.merge_request.merge_status)&&i.default.createElement(m.default,{mergeRequest:this.props.mergeRequest,user:this.props.user,reviewers:a.data,reviewGood:this.props.reviewGood,cancelReviewGood:this.props.cancelReviewGood,grant:this.props.grant,cancelGrant:this.props.cancelGrant,mergeMergeRequest:this.props.mergeMergeRequest,refuseMergeRequest:this.props.refuseMergeRequest,cancelMergeRequest:this.props.cancelMergeRequest,updateActivities:this.props.updateActivities,push:this.props.push,project:this.props.project,sayGood:this.props.sayGood,sayBad:this.props.sayBad}),"ACCEPTED"===t.merge_request.merge_status&&i.default.createElement(h.default,{mergeRequest:this.props.mergeRequest,revertMergeRequest:this.props.revertMergeRequest,deleteSourceBranch:this.props.deleteSourceBranch,restoreSourceBranch:this.props.restoreSourceBranch}))}}]),t}(),n.propTypes={mergeRequest:o.default.object,references:o.default.object,resourceResults:o.default.object,members:o.default.array,fetchMergeRequestReferences:o.default.func,onResourceSearch:o.default.func,onAddReference:o.default.func,onRemoveReference:o.default.func,onReferenceSelectorConfirm:o.default.func,onCreateReferencedTask:o.default.func,updateActivities:o.default.func,getConflictContent:o.default.func,resolvedConflicts:o.default.func,revertMergeRequest:o.default.func,deleteSourceBranch:o.default.func,restoreSourceBranch:o.default.func,user:o.default.object,push:o.default.func,project:o.default.object,reviewers:o.default.object,reviewGood:o.default.func,cancelReviewGood:o.default.func,grant:o.default.func,cancelGrant:o.default.func,sayGood:o.default.func,sayBad:o.default.func,mergeMergeRequest:o.default.func,refuseMergeRequest:o.default.func,cancelMergeRequest:o.default.func,onAddExternalLink:o.default.func.isRequired},r);t.default=v},3857:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l,o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=j(a(0)),i=a(2),s=j(i),c=a(168),d=j(a(8)),f=j(a(554)),m=j(a(1468)),p=j(a(1453)),h=j(a(547)),E=j(a(261)),g=a(106),v=a(718),b=j(a(710)),y=j(a(709)),_=a(112),R=a(266),C=j(a(1554)),w=a(2258),S=j(a(1803)),T=j(a(1804)),k=a(1809),N=j(a(1614));function j(e){return e&&e.__esModule?e:{default:e}}function P(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var O=p.default.Item,A=(0,R.withAsyncMarkEditor)()((l=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.getRefWithType=function(e){var t=a.props.project.id,n=(0,w.getReferenceArray)(a.props.references.item);return{self:n.filter(function(e){return e.target_type!==k.LINK_SYMBOL&&e.target_project_id===t}),other:n.filter(function(e){return e.target_type!==k.LINK_SYMBOL&&e.target_project_id!==t}),links:n.filter(function(e){return e.target_type===k.LINK_SYMBOL})}[e]},a.doResourceSearch=function(e){a.props.onResourceSearch(e)},a.onResourceToggle=function(e){e||a.doResourceSearch(a.state.searchKey)},a.onResourceSearch=(0,f.default)(function(e){(a.state.searchKey||e)&&a.doResourceSearch(e),a.setState({searchKey:e||""})},300),a.onAddReference=function(e){a.props.resourceResults.loading?(0,_.warning)("\u8bf7\u7b49\u5f85\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210\u518d\u6dfb\u52a0\u5f15\u7528"):a.props.onAddReference(a.props.mergeRequest.iid,e.code)},a.onRemoveReference=function(e){confirm("\u786e\u5b9a\u8981\u5220\u9664\u5173\u8054")&&a.props.onRemoveReference(a.props.mergeRequest.iid,e.code,e.target_project_id)},a.renderItemText=function(e){var t=e.target_project_id&&e.target_project_id===a.props.project.id,n="#"+e.code+" "+(e.title||"Release"===e.target_type&&e.link.split("/").pop()),r="#"+e.code+" "+e.title,l=g.IS_ENTERPRISE&&!t?(e.target_project_name||"")+" ":"";return e.target_type===k.LINK_SYMBOL?r:""+l+n},a.renderItem=function(e){return s.default.createElement(O,{className:N.default.item,key:e.code},s.default.createElement(c.Link,{to:(0,v.protocolPrefix)(e),className:N.default.link,target:"_blank"},s.default.createElement("span",{className:N.default.itemIcon},a.props.generateIconByType(e.target_type)),a.renderItemText(e)),("CANMERGE"===a.props.mergeRequest.merge_status||"CANNOTMERGE"===a.props.mergeRequest.merge_status)&&s.default.createElement("span",{className:N.default.close,onClick:function(){return a.onRemoveReference(e)}},s.default.createElement(h.default,null)))},a.onAddExternalLink=function(e){a.props.onAddExternalLink(e,a.props.mergeRequest.iid)},a.state={searchKey:"",createTaskItems:[],showSelector:!1},a.onAddCreateTaskItem=a.onAddCreateTaskItem.bind(a),a.onRemoveCreateTaskItem=a.onRemoveCreateTaskItem.bind(a),a.onOwnerChange=a.onOwnerChange.bind(a),a.onPriorityChange=a.onPriorityChange.bind(a),a.onDeadlineChange=a.onDeadlineChange.bind(a),a.onValueChange=a.onValueChange.bind(a),a.onShowSelector=a.onShowSelector.bind(a),a.onHideSelector=a.onHideSelector.bind(a),a.onAddCreateTaskItem=a.onAddCreateTaskItem.bind(a),a.renderItem=a.renderItem.bind(a),a.renderCreateTaskItem=a.renderCreateTaskItem.bind(a),a.onReferenceSelectorConfirm=a.onReferenceSelectorConfirm.bind(a),a.onCreateReferencedTask=a.onCreateReferencedTask.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"onAddCreateTaskItem",value:function(){var e=this;this.setState({createTaskItems:[{owner:this.props.mergeRequest.author.id,priority:1,deadline:"",value:""}].concat(P(this.state.createTaskItems))},function(){e.refs["input-0"].input.focus()})}},{key:"onRemoveCreateTaskItem",value:function(e){this.setState({createTaskItems:this.state.createTaskItems.filter(function(t,a){return a!==e})})}},{key:"onOwnerChange",value:function(e,t){var a=[].concat(P(this.state.createTaskItems));a[t].owner=e.value,this.setState({createTaskItems:a})}},{key:"onPriorityChange",value:function(e,t){var a=[].concat(P(this.state.createTaskItems));a[t].priority=e,this.setState({createTaskItems:a})}},{key:"onDeadlineChange",value:function(e,t){var a=[].concat(P(this.state.createTaskItems));a[t].deadline=e,this.setState({createTaskItems:a})}},{key:"onValueChange",value:function(e,t){var a=[].concat(P(this.state.createTaskItems));a[t].value=e,this.setState({createTaskItems:a})}},{key:"onShowSelector",value:function(){this.setState({showSelector:!0})}},{key:"onHideSelector",value:function(){this.setState({showSelector:!1})}},{key:"onReferenceSelectorConfirm",value:function(e){var t=[].concat(P(this.getRefWithType(k.REF_TYPE.SELF)),P(this.getRefWithType(k.REF_TYPE.OTHER)),P(this.getRefWithType(k.REF_TYPE.LINKS)));return this.props.onReferenceSelectorConfirm(this.props.mergeRequest.iid,t,e)}},{key:"onCreateReferencedTask",value:function(e){var t=this,a=this.state.createTaskItems[e].owner,n=this.state.createTaskItems[e],r=n.priority,l=n.deadline,o=n.value;this.props.onCreateReferencedTask(this.props.mergeRequest.iid,a,r,l,o).then(function(){t.onRemoveCreateTaskItem(e)})}},{key:"renderCreateTaskItem",value:function(e,t){var a=this;return s.default.createElement(O,{className:N.default.item,key:"create.task-"+t},s.default.createElement(C.default,{items:this.props.members,value:e.owner,className:N.default.avatar,onSelect:function(e){return a.onOwnerChange(e,t)}}),s.default.createElement(b.default,{className:"ml-10",priority:e.priority,onChange:function(e){return a.onPriorityChange(e,t)}}),s.default.createElement(y.default,{className:"ml-10",date:e.deadline,onChange:function(e){return a.onDeadlineChange(e,t)}}),s.default.createElement(E.default,{className:N.default.input,value:e.value,onChange:function(e,n){return a.onValueChange(n,t)},onPressEnter:function(){return a.onCreateReferencedTask(t)},placeholder:"\u6dfb\u52a0\u4e00\u4e2a\u5173\u8054\u4efb\u52a1\uff08\u56de\u8f66\u5b8c\u6210\u6dfb\u52a0\uff09",ref:"input-"+t}),s.default.createElement("span",{className:N.default.close,onClick:function(){return a.onRemoveCreateTaskItem(t)}},s.default.createElement(h.default,null)))}},{key:"render",value:function(){var e=(0,w.getReferenceArray)(this.props.references.item);return"CANMERGE"!==this.props.mergeRequest.merge_status&&"CANNOTMERGE"!==this.props.mergeRequest.merge_status&&0===e.length?s.default.createElement("div",{className:N.default.empty}):s.default.createElement("div",{className:(0,d.default)(N.default.element,N.default.referenceContainer)},s.default.createElement(T.default,{show:this.state.showSelector,onHide:this.onHideSelector,initialSelecteds:(0,w.getReferenceArray)(this.props.references.item),excludeds:[{code:this.props.mergeRequest.iid,id:this.props.project.id}],onConfirm:this.onReferenceSelectorConfirm,onAddLink:this.onAddExternalLink}),s.default.createElement("div",{className:N.default.headerTitle},s.default.createElement("div",{className:N.default.icon},s.default.createElement("img",{src:a(2290),className:N.default.img})),s.default.createElement("div",{className:"ml-10"},s.default.createElement("div",{className:N.default.title},"\u5173\u8054\u8d44\u6e90"),s.default.createElement("div",{className:N.default.desc},"\u70b9\u51fb\u53f3\u4e0a\u89d2\u201c+\u201d\u5173\u8054\u9879\u76ee\u8d44\u6e90\uff08\u91cc\u7a0b\u7891\u3001\u4efb\u52a1\u3001\u5408\u5e76\u8bf7\u6c42\u7b49\uff09",g.IS_ENTERPRISE&&"\u53ca\u6dfb\u52a0\u5916\u90e8\u94fe\u63a5")),("CANMERGE"===this.props.mergeRequest.merge_status||"CANNOTMERGE"===this.props.mergeRequest.merge_status)&&s.default.createElement("div",{className:N.default.actions},!g.IS_ENTERPRISE&&s.default.createElement("span",{className:N.default.action,onClick:this.onAddCreateTaskItem},s.default.createElement(m.default,null),s.default.createElement("span",{className:N.default.text},"\u521b\u5efa\u4efb\u52a1")),s.default.createElement(S.default,{detail:{number:this.props.mergeRequest.iid},items:this.props.resourceResults.list,references:e,onSearch:this.onResourceSearch,onSelect:this.onAddReference,onToggle:this.onResourceToggle,onShowSelector:this.onShowSelector,loading:this.props.resourceResults.loading}))),!this.props.references.loading&&s.default.createElement("div",null,s.default.createElement("div",{style:{borderBottom:this.getRefWithType(k.REF_TYPE.SELF).length>0&&(this.getRefWithType(k.REF_TYPE.OTHER).length>0||this.getRefWithType(k.REF_TYPE.LINKS).length>0)?"1px solid #d8dde4":"none"}},s.default.createElement(p.default,{className:N.default.list,type:"block",empty:s.default.createElement("div",null),hover:!0,bordered:!0},!g.IS_ENTERPRISE&&this.state.createTaskItems.map(this.renderCreateTaskItem),this.getRefWithType(k.REF_TYPE.SELF).map(this.renderItem))),s.default.createElement(p.default,{className:N.default.list,type:"block",empty:s.default.createElement("div",null),hover:!0,bordered:!0},this.getRefWithType(k.REF_TYPE.OTHER).map(this.renderItem),this.getRefWithType(k.REF_TYPE.LINKS).map(this.renderItem))))}}]),t}(),r.propTypes={mergeRequest:u.default.object,references:u.default.object,resourceResults:u.default.object,members:u.default.array,fetchMergeRequestReferences:u.default.func,onResourceSearch:u.default.func,onAddReference:u.default.func,onReferenceSelectorConfirm:u.default.func,onCreateReferencedTask:u.default.func,onRemoveReference:u.default.func,onAddExternalLink:u.default.func.isRequired,project:u.default.shape({id:u.default.number.isRequired}).isRequired,generateIconByType:u.default.func},n=l))||n;t.default=A},3859:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=c(a(0)),u=a(2),i=c(u),s=c(a(1614));function c(e){return e&&e.__esModule?e:{default:e}}var d=(r=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"render",value:function(){var e=this.props.hint;return i.default.createElement("div",{className:s.default.element},i.default.createElement("div",{className:s.default.icon},i.default.createElement("img",{src:a(3860),className:s.default.img})),i.default.createElement("div",{className:s.default.content},i.default.createElement("div",{className:s.default.title},"\u4fdd\u62a4\u5206\u652f\uff1a \u7b49\u5f85\u5176\u4ed6\u6210\u5458\u6388\u6743"),i.default.createElement("div",{className:s.default.desc},e)))}}]),t}(),n.propTypes={hint:o.default.string},r);t.default=d},3860:function(e,t,a){e.exports=a.p+"static/media/protect.4a452330.svg"},3861:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=d(a(0)),u=a(2),i=d(u),s=d(a(3862)),c=d(a(1810));function d(e){return e&&e.__esModule?e:{default:e}}var f=(r=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"render",value:function(){var e=this.props,t=e.mergeRequest,n=e.user,r=e.getConflictContent,l=e.resolvedConflicts;return"CANMERGE"===t.merge_request.merge_status?i.default.createElement("div",{className:c.default.element},i.default.createElement("div",{className:c.default.icon},i.default.createElement("img",{src:a(2291),className:c.default.img})),i.default.createElement("div",{className:c.default.content},i.default.createElement("div",{className:c.default.title},"\u5408\u5e76\u8bf7\u6c42\u5206\u652f\u4e0e\u76ee\u6807\u5206\u652f\u65e0\u51b2\u7a81"),i.default.createElement("div",{className:c.default.desc},"\u81ea\u52a8\u5408\u5e76\u53ef\u4ee5\u5de5\u4f5c"))):i.default.createElement(s.default,{mergeRequest:t,user:n,getConflictContent:r,resolvedConflicts:l})}}]),t}(),n.propTypes={mergeRequest:o.default.object,user:o.default.object,getConflictContent:o.default.func,resolvedConflicts:o.default.func},r);t.default=f},3862:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=_(a(0)),u=a(2),i=_(u),s=_(a(544)),c=_(a(1460)),d=_(a(1453)),f=_(a(550)),m=_(a(1784)),p=_(a(1805)),h=_(a(1582)),E=_(a(8)),g=_(a(3863)),v=_(a(3865)),b=_(a(698)),y=_(a(1810));function _(e){return e&&e.__esModule?e:{default:e}}var R=d.default.Item,C=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.toggleMergeTips=a.toggleMergeTips.bind(a),a.renderConflictFiles=a.renderConflictFiles.bind(a),a.renderConflictEditor=a.renderConflictEditor.bind(a),a.onSelectFileDropdown=a.onSelectFileDropdown.bind(a),a.submitResloveConflicts=a.submitResloveConflicts.bind(a),a.state={mergeTips:!1,resloving:!1,conflictEditor:!1,conflicts:e.mergeRequest.merge_request.conflicts.map(function(e){return{path:e,resloved:!1,value:e,text:e}}),currentConflict:{},resolveSubmitting:!1},a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"toggleMergeTips",value:function(){this.setState({mergeTips:!this.state.mergeTips})}},{key:"renderMergeTips",value:function(){var e=this.props.mergeRequest.merge_request,t="\n            <p><strong>\u53ef\u53c2\u7167\u5982\u4e0b\u6d41\u7a0b\u4f7f\u7528\u547d\u4ee4\u884c\u6765\u5b8c\u6210\u5408\u5e76\u3002</strong></p>\n\t\t\t<p>\u7b2c\u4e00\u6b65\uff1a\u4ece\u9879\u76ee\u4ed3\u5e93\u4e2d\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5206\u652f\uff0c\u5e76\u6d4b\u8bd5\u5408\u5e76\u8bf7\u6c42\u4e2d\u7684\u6539\u52a8\u3002</p>\n\t\t\t<pre><code>git fetch origin\ngit checkout -b "+e.srcBranch+" origin/"+e.srcBranch+"\ngit merge "+e.desBranch+"</code></pre>\n\t\t\t<p>\u7b2c\u4e8c\u6b65\uff1a\u5408\u5e76\u6539\u52a8\u5230\u76ee\u6807\u5206\u652f\uff0c\u5e76\u63a8\u9001\u5230 Coding</p>\n\t\t\t<pre><code>git checkout "+e.desBranch+"\ngit merge --no-ff "+e.srcBranch+"\ngit push origin "+e.desBranch+"</code></pre>";return i.default.createElement(c.default,{className:y.default.tips,html:t})}},{key:"submitResloveConflicts",value:function(){var e=this;if(!this.state.resolveSubmitting){this.setState({resolveSubmitting:!0});var t=this.state.conflicts;if(t.map(function(e){return e.resloved}).every(function(e){return!0===e})){var a=t.map(function(e){return{path:e.path,content:e.result}});this.props.resolvedConflicts(this.props.mergeRequest.merge_request.iid,a).then(function(){e.setState({resolveSubmitting:!1})})}}}},{key:"renderConflictFiles",value:function(){var e=this,t=this.state,a=t.resloving,n=t.conflicts,r=t.resolveSubmitting;return i.default.createElement("div",{className:y.default.conflictContainer},i.default.createElement("h3",null,a?"\u9009\u62e9\u51b2\u7a81\u6587\u4ef6\uff08"+n.length+"\uff09":"\u51b2\u7a81\u6587\u4ef6"),i.default.createElement(d.default,{className:y.default.conflicts,type:"block",empty:i.default.createElement("div",null)},n.map(this.renderConflict,this)),a&&i.default.createElement(s.default,{empty:!0,onClick:function(){e.setState({resloving:!1})}},"\u53d6\u6d88"),a&&i.default.createElement(s.default,{type:"confirm",onClick:this.submitResloveConflicts,style:{width:"100px"},disabled:!n.map(function(e){return e.resloved}).every(function(e){return!0===e}),loading:r},"\u63d0\u4ea4\u4fee\u6539"))}},{key:"renderConflict",value:function(e){var t=this;return this.state.resloving?i.default.createElement(R,{className:(0,E.default)(y.default.conflict,y.default.resloving,e.resloved?y.default.resloved:""),key:e.path},i.default.createElement(f.default,{className:y.default.check}),i.default.createElement("span",{onClick:function(){e.data||t.props.getConflictContent(t.props.mergeRequest.merge_request.iid,e.path).then(function(a){e.data=a.data,t.setState({conflictEditor:!0,currentConflict:e})}),t.setState({conflictEditor:!0,currentConflict:e})}},e.path)):i.default.createElement(R,{className:y.default.conflict,key:e.path},e.path)}},{key:"onSelectFileDropdown",value:function(e){var t=this;e&&(e.data||this.props.getConflictContent(this.props.mergeRequest.merge_request.iid,e.path).then(function(a){e.data=a.data,t.setState({currentConflict:e})}),this.setState({currentConflict:e}))}},{key:"renderConflictEditor",value:function(){var e=this,t=this.state,a=t.currentConflict,n=t.conflicts;if(!this.state.conflictEditor)return!1;var r=n.findIndex(function(e){return e.path===a.path});return i.default.createElement("div",{className:y.default.conflictEditor},i.default.createElement("div",{className:y.default.header},i.default.createElement("h4",null,"\u5408\u5e76\u6587\u4ef6"),i.default.createElement(m.default,{className:y.default.angleRight}),i.default.createElement(g.default,{items:this.state.conflicts,searchPlaceholder:"Search file path",value:this.state.currentConflict.value,searchable:!0,onSelect:this.onSelectFileDropdown,className:y.default.dropdown}),i.default.createElement("div",{className:y.default.right},i.default.createElement("span",{className:y.default.fileCount},"\u5171 "+this.state.conflicts.length+" \u4e2a\u6587\u4ef6"),r-1>=0&&i.default.createElement("span",{className:(0,E.default)(y.default.page,r+1<n.length?"mr-10":""),onClick:function(){r-1<0||e.onSelectFileDropdown(n[r-1])}},i.default.createElement(p.default,null)," \u4e0a\u4e00\u4e2a"),r+1<n.length&&i.default.createElement("span",{className:y.default.page,onClick:function(){r+1>=n.length||e.onSelectFileDropdown(n[r+1])}},i.default.createElement(h.default,null)," \u4e0b\u4e00\u4e2a"),i.default.createElement(s.default,{className:y.default.done,onClick:function(){n[r].resloved=!n[r].resloved,n[r].result=e.editorRef.edit.getValue(),e.setState({conflicts:n})}},a.resloved?"\u53d6\u6d88\u5df2\u89e3\u51b3\u6807\u8bb0":"\u6807\u8bb0\u4e3a\u5df2\u89e3\u51b3"),i.default.createElement(s.default,{className:y.default.close,empty:!0,onClick:function(){e.setState({conflictEditor:!1})}},"\u5173\u95ed"))),!a.data&&i.default.createElement(b.default,{show:!0}),a.data&&i.default.createElement("div",{className:y.default.mergeTitle},i.default.createElement("div",null,"HEAD ",this.props.mergeRequest.merge_request.source_sha.substring(0,9)),i.default.createElement("div",{className:y.default.gutterTitle}),i.default.createElement("div",null,"\u7ed3\u679c"),i.default.createElement("div",{className:y.default.gutterTitle}),i.default.createElement("div",null,this.props.mergeRequest.merge_request.desBranch," ",this.props.mergeRequest.merge_request.target_sha.substring(0,9))),a.data&&i.default.createElement(v.default,{data:a.data,editorRef:function(t){return e.editorRef=t}}))}},{key:"render",value:function(){var e=this.props,t=e.mergeRequest,n=e.user;return i.default.createElement("div",{className:y.default.element},this.state.resloving&&this.renderConflictEditor(),!this.state.resloving&&i.default.createElement("div",{className:y.default.icon},i.default.createElement("img",{src:a(3868),className:y.default.img})),i.default.createElement("div",{className:(0,E.default)(y.default.content,this.state.resloving?y.default.resloving:"")},!this.state.resloving&&i.default.createElement("div",{className:y.default.title},"\u5408\u5e76\u8bf7\u6c42\u5206\u652f\u4e0e\u76ee\u6807\u5206\u652f\u51b2\u7a81"),this.state.resloving&&i.default.createElement("div",{className:y.default.title},"\u89e3\u51b3\u51b2\u7a81"),!this.state.resloving&&t.merge_request.author.id===n.id&&i.default.createElement("div",{className:y.default.desc},"\u5206\u652f\u4e0d\u53ef\u81ea\u52a8\u5408\u5e76\uff0c","\u8bf7\u4f7f\u7528 ",i.default.createElement("a",{onClick:this.toggleMergeTips},"\u547d\u4ee4\u884c\u5de5\u5177")," ","\u89e3\u51b3\u51b2\u7a81\u3002"),!this.state.resloving&&t.merge_request.author.id!==n.id&&i.default.createElement("div",{className:y.default.desc},"\u5206\u652f\u4e0d\u53ef\u81ea\u52a8\u5408\u5e76\u3002"),this.state.resloving&&i.default.createElement("div",{className:y.default.desc},"\u6253\u5f00\u51b2\u7a81\u6587\u4ef6\u540e\u9009\u62e9\u8981\u4fdd\u7559\u7684\u7247\u6bb5\uff0c\u5408\u5e76\u5b8c\u6bd5\u540e\u53ef\u63d0\u4ea4\u4fee\u6539\u3002"),this.state.mergeTips&&this.renderMergeTips(),!this.state.mergeTips&&this.renderConflictFiles()))}}]),t}(),n.propTypes={mergeRequest:o.default.object,user:o.default.object,getConflictContent:o.default.func,resolvedConflicts:o.default.func},r);t.default=C},3863:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(a(2)),r=a(78),l=s(a(1582)),o=s(a(550)),u=s(a(8)),i=s(a(1810));function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}t.default=(0,r.hocDropdown)(function(e){var t=e.selectedItem;return n.default.createElement("div",{className:i.default.trigger},n.default.createElement(o.default,{className:(0,u.default)(i.default.checkIcon,c({},i.default.checked,t.resloved))}),t&&t.text,n.default.createElement(l.default,null))},function(e){var t=e.item;return n.default.createElement("div",{className:i.default.item},n.default.createElement(o.default,{className:(0,u.default)(i.default.dropdownCheckIcon,c({},i.default.checked,t.resloved))}),n.default.createElement("span",{className:i.default.name+" fs-12"},t.text))})},3865:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=d(a(0)),u=a(2),i=d(u);a(1567),a(3866),a(1576);var s=d(a(1448)),c=d(a(1810));function d(e){return e&&e.__esModule?e:{default:e}}a.e(190).then(function(){var e=[a(4031)];(function(e){Object.assign(window,e),a.e(189).then(function(){a(4197)}).catch(a.oe)}).apply(null,e)}).catch(a.oe);var f=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.initEditor=a.initEditor.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"componentDidMount",value:function(){this.initEditor()}},{key:"componentWillReceiveProps",value:function(e){if(this.props.data.path!==e.data.path){this.editorDOM.innerHTML="";var t=s.default.MergeView(this.editorDOM,{origLeft:e.data.origLeft,orig:e.data.orig,value:e.data.value,lineNumbers:!0,highlightDifferences:!0,collapseIdentical:!0,revertButtons:!0});e.editorRef(t)}}},{key:"initEditor",value:function(){var e=s.default.MergeView(this.editorDOM,{origLeft:this.props.data.origLeft,orig:this.props.data.orig,value:this.props.data.value,lineNumbers:!0,highlightDifferences:!0,collapseIdentical:!0,revertButtons:!0});this.props.editorRef(e)}},{key:"render",value:function(){var e=this;return i.default.createElement("div",{className:c.default.mergeEditor,ref:function(t){return e.editorDOM=t}})}}]),t}(),n.propTypes={data:o.default.object,editorRef:o.default.func},r);t.default=f},3868:function(e,t,a){e.exports=a.p+"static/media/iconWrong.1ccc4407.svg"},3869:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=d(a(0)),u=a(2),i=d(u),s=d(a(550)),c=d(a(1614));function d(e){return e&&e.__esModule?e:{default:e}}var f=(r=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"renderReviewer",value:function(e,t){var a=e.reviewer;return i.default.createElement("div",{key:t,title:a.name,className:c.default.reviewer},i.default.createElement("img",{src:a.avatar,alt:a.global_key,className:c.default.avatar}),i.default.createElement("span",{className:c.default.info},i.default.createElement(s.default,{className:c.default.icon}),"\u5141\u8bb8\u5408\u5e76"))}},{key:"render",value:function(){var e=this.props.reviewers;return i.default.createElement("div",{className:c.default.element},i.default.createElement("div",{className:c.default.reviewers},e.reviewers.filter(function(e){return 100===e.value}).map(this.renderReviewer,this),e.volunteer_reviewers.filter(function(e){return 100===e.value}).map(this.renderReviewer,this)))}}]),t}(),n.propTypes={reviewers:o.default.object},r);t.default=f},3870:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=b(a(0)),i=a(2),s=b(i),c=b(a(544)),d=b(a(261)),f=b(a(701)),m=b(a(78)),p=b(a(151)),h=b(a(550)),E=b(a(8)),g=a(112),v=b(a(1614));function b(e){return e&&e.__esModule?e:{default:e}}var y=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=e.reviewers.reviewers.findIndex(function(t){return t.reviewer.id===e.user.id}),r=!0;return r=n>=0?100===e.reviewers.reviewers[n].value:e.reviewers.volunteer_reviewers.findIndex(function(t){return t.reviewer.id===e.user.id})>=0,a.state={agreed:r,showForm:!1,form:{title:"",content:"",delSrcBranch:"true"===window.localStorage.mr_del_src_branch,fastForward:"true"===window.localStorage.mr_fast_forward,squash:!1},agreeing:!1,submitting:!1,canceling:!1,showMergeDropdown:!1},a.agree=a.agree.bind(a),a.cancelAgree=a.cancelAgree.bind(a),a.renderButtons=a.renderButtons.bind(a),a.renderForm=a.renderForm.bind(a),a.generateMsgTitle=a.generateMsgTitle.bind(a),a.generateMsgContent=a.generateMsgContent.bind(a),a.generateMsg=a.generateMsg.bind(a),a.submit=a.submit.bind(a),a.cancel=a.cancel.bind(a),a.changeMergeType=a.changeMergeType.bind(a),a.renderMergeSelector=a.renderMergeSelector.bind(a),a.renderSubmitBotton=a.renderSubmitBotton.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"componentDidMount",value:function(){this.generateMsg()}},{key:"agree",value:function(){var e=this;if(!this.state.agreeing&&("CANMERGE"===this.props.mergeRequest.merge_request.merge_status||"CANNOTMERGE"===this.props.mergeRequest.merge_request.merge_status)){this.setState({agreeing:!0});var t=0===this.props.mergeRequest.merge_request.granted;this.props.sayGood(this.props.mergeRequest.merge_request.iid,this.props.user,this.props.mergeRequest.can_grant).then(function(){var a="say_good";t&&e.props.mergeRequest.can_grant&&(a="say_good_and_grant"),e.props.updateActivities({action:a,created_at:Date.now(),author:e.props.user}),e.setState({agreed:!0}),e.generateMsg()}).finally(function(){return e.setState({agreeing:!1})})}}},{key:"cancelAgree",value:function(){var e=this;if(!this.state.agreeing&&("CANMERGE"===this.props.mergeRequest.merge_request.merge_status||"CANNOTMERGE"===this.props.mergeRequest.merge_request.merge_status)){var t=1===this.props.mergeRequest.merge_request.granted;this.props.sayBad(this.props.mergeRequest.merge_request.iid,this.props.user,this.props.mergeRequest.can_grant).then(function(){var a="say_bad";t&&e.props.mergeRequest.can_grant&&(a="say_bad_and_grant_revoke"),e.props.updateActivities({action:a,created_at:Date.now(),author:e.props.user}),e.setState({agreed:!1,agreeing:!1}),e.generateMsg()}).finally(function(){return e.setState({agreeing:!1})})}}},{key:"generateMsgTitle",value:function(){var e=this.props.mergeRequest.merge_request,t=[];return t.push("Accept Merge Request #"+e.iid+": "),t.push("("+e.srcBranch+" -> "+e.desBranch+")"),t.join("")}},{key:"generateMsgContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.props.mergeRequest.merge_request,a=this.props.reviewers,n=[];if(n.push("Merge Request: "+t.title+"\n"),n.push("Created By: @"+t.author.name+"\n"),a.reviewers.filter(function(e){return 100===e.value}).length>0||a.volunteer_reviewers.length>0){var r=[];r.push("Reviewed By: "),a.reviewers.filter(function(e){return 100===e.value}).forEach(function(e){r.push("@"+e.reviewer.name+" ")}),a.volunteer_reviewers.forEach(function(e){r.push("@"+e.reviewer.name+" ")}),r.push("\n"),n.push(r.join(""))}return 1===t.granted&&t.granted_by&&n.push("Approved By: @"+t.granted_by.name+"\n"),n.push("Accepted By: @"+this.props.user.name+"\n"),n.push("URL: "+window.location.href),e&&(n.push("\n\n"),n.push("Squash commits "+t.commits[0].commitId.substring(0,7)),n.push(" ... "),n.push(""+t.commits[t.commits.length-1].commitId.substring(0,7))),n.join("")}},{key:"generateMsg",value:function(){this.setState({form:l({},this.state.form,{title:this.generateMsgTitle(),content:this.generateMsgContent()})})}},{key:"submit",value:function(){var e=this;if(!this.state.submitting){var t=this.props,a=t.mergeRequest,n=t.mergeMergeRequest,r=t.user;if(a.can_merge)if("CANMERGE"===a.merge_request.merge_status){this.setState({submitting:!0});var l=this.state.form.title+"\n"+this.state.form.content;l.trim()?n(a.merge_request.iid,{message:l,del_source_branch:this.state.form.delSrcBranch,fastforward:this.state.form.fastForward,squash:this.state.form.squash},r).then(function(){e.props.updateActivities({action:"merge",created_at:Date.now(),author:r}),window.localStorage.mr_del_src_branch=e.state.form.delSrcBranch,window.localStorage.mr_fast_forward=e.state.form.fastForward}).finally(function(){return e.setState({submitting:!1})}):(0,g.danger)("\u63d0\u4ea4\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a")}else(0,g.danger)("\u65e0\u6cd5\u5408\u5e76");else(0,g.danger)("\u6ca1\u6709\u6743\u9650\u5408\u5e76")}}},{key:"cancel",value:function(){var e=this;if(!this.state.canceling){var t=this.props,a=t.mergeRequest,n=t.user,r=t.refuseMergeRequest,l=t.updateActivities;confirm("\u662f\u5426\u8981\u5173\u95ed\u8be5\u5408\u5e76\u8bf7\u6c42")&&("CANMERGE"===a.merge_request.merge_status||"CANNOTMERGE"===a.merge_request.merge_status?(this.setState({canceling:!0}),r(a.merge_request.iid).then(function(){l({action:"refuse",created_at:Date.now(),author:n}),e.props.push(e.props.project.depot_path+"/merges"),(0,g.success)("\u5173\u95ed\u6210\u529f!")}).finally(function(){return e.setState({canceling:!1})})):(0,g.danger)("\u6b64\u5408\u5e76\u8bf7\u6c42\u5df2\u7ecf\u5173\u95ed"))}}},{key:"changeMergeType",value:function(e){"squash"===e?this.setState({form:l({},this.state.form,{squash:!0,title:this.generateMsgTitle(),content:this.generateMsgContent(!0)})}):this.setState({form:l({},this.state.form,{squash:!1,title:this.generateMsgTitle(),content:this.generateMsgContent()})}),this.setState({showMergeDropdown:!1})}},{key:"renderForm",value:function(){var e=this;return s.default.createElement("div",{className:v.default.form},s.default.createElement("div",{className:v.default.title},"\u5408\u5e76\u6b64\u8bf7\u6c42"),s.default.createElement("div",{className:v.default.merge},s.default.createElement(d.default,{value:this.state.form.title,onChange:function(t,a){e.setState({form:l({},e.state.form,{title:a})})},block:!0}),s.default.createElement(d.default,{type:"textarea",autoSize:{minRows:6},block:!0,value:this.state.form.content,className:v.default.content,onChange:function(t,a){e.setState({form:l({},e.state.form,{content:a})})}}),s.default.createElement("div",{className:v.default.checks},s.default.createElement(f.default,{checked:this.state.form.delSrcBranch,onChange:function(){e.setState({form:l({},e.state.form,{delSrcBranch:!e.state.form.delSrcBranch})})}},"\u5220\u9664\u6e90\u5206\u652f"),s.default.createElement(f.default,{checked:this.state.form.fastForward,onChange:function(){e.setState({form:l({},e.state.form,{fastForward:!e.state.form.fastForward})})}},"Fast-Forward \u6a21\u5f0f\u5408\u5e76"))),s.default.createElement("div",{className:v.default.buttons},s.default.createElement(c.default,{onClick:this.submit,loading:this.state.submitting},this.renderSubmitBotton()),s.default.createElement(c.default,{empty:!0,onClick:function(){return e.setState({showForm:!1})}},"\u53d6\u6d88")))}},{key:"renderSubmitBotton",value:function(){return this.state.form.squash?"\u538b\u7f29\u63d0\u4ea4\u540e\u5408\u5e76":"\u5408\u5e76\u8bf7\u6c42"}},{key:"renderMergeSelector",value:function(){var e=this;return s.default.createElement("div",{className:v.default.mergeSelector},s.default.createElement("div",{className:v.default.mergeItem,onClick:function(){return e.changeMergeType("merge")}},!this.state.form.squash&&s.default.createElement(h.default,{className:v.default.check}),s.default.createElement("span",{className:v.default.header},"\u76f4\u63a5\u5408\u5e76"),s.default.createElement("span",{className:v.default.description},"\u6e90\u5206\u652f\u6240\u6709\u63d0\u4ea4\u8bb0\u5f55\u90fd\u4f1a\u88ab\u6dfb\u52a0\u5230\u76ee\u6807\u5206\u652f\uff0c \u5e76\u4e14\u521b\u5efa\u4e00\u6761\u5408\u5e76\u5206\u652f\u7684\u63d0\u4ea4\u8bb0\u5f55\u3002")),s.default.createElement("div",{className:v.default.mergeItem,onClick:function(){return e.changeMergeType("squash")}},this.state.form.squash&&s.default.createElement(h.default,{className:v.default.check}),s.default.createElement("span",{className:v.default.header},"\u5408\u5e76\u65f6\u538b\u7f29\u63d0\u4ea4\u8bb0\u5f55\uff08Squash\uff09"),s.default.createElement("span",{className:v.default.description},"\u5c06\u5408\u5e76\u8bf7\u6c42\u4e2d\u7684\u63d0\u4ea4\u8bb0\u5f55\u538b\u7f29\u6210\u4e00\u6761\uff0c \u7136\u540e\u6dfb\u52a0\u5230\u76ee\u6807\u5206\u652f\u3002")))}},{key:"renderButtons",value:function(){var e=this,t=this.props,a=t.mergeRequest,n=t.user,r=this.state,l=r.agreed,o=r.showMergeDropdown,u=r.form;return s.default.createElement("div",{className:v.default.buttons},a.merge_request.author.id!==n.id&&!l&&("CANMERGE"===a.merge_request.merge_status||"CANNOTMERGE"===a.merge_request.merge_status)&&s.default.createElement(c.default,{onClick:this.agree,loading:this.state.agreeing},"\u5141\u8bb8\u5408\u5e76"),a.merge_request.author.id!==n.id&&l&&("CANMERGE"===a.merge_request.merge_status||"CANNOTMERGE"===a.merge_request.merge_status)&&s.default.createElement(c.default,{onClick:this.cancelAgree,loading:this.state.agreeing},"\u64a4\u9500\u5141\u8bb8\u5408\u5e76"),s.default.createElement("div",{className:(0,E.default)(v.default.merges,u.squash?v.default.squash:"")},a.can_merge&&("CANMERGE"===a.merge_request.merge_status||"CANNOTMERGE"===a.merge_request.merge_status)&&s.default.createElement(c.default,{disabled:"CANNOTMERGE"===a.merge_request.merge_status,className:a.merge_request.commits.length>1?v.default.merge:"",onClick:function(){"CANMERGE"!==a.merge_request.merge_status||o||e.setState({showForm:!0})}},u.squash?"\u538b\u7f29\u63d0\u4ea4\u5e76\u5408\u5e76":"\u5408\u5e76\u5206\u652f"),a.can_merge&&("CANMERGE"===a.merge_request.merge_status||"CANNOTMERGE"===a.merge_request.merge_status)&&a.merge_request.commits.length>1&&s.default.createElement(m.default,{menu:this.renderMergeSelector(),open:o,onToggle:function(t){return e.setState({showMergeDropdown:!t})}},s.default.createElement(c.default,{className:v.default.dropdown,disabled:"CANNOTMERGE"===a.merge_request.merge_status},s.default.createElement(p.default,null)))),(a.can_merge||a.merge_request.author.id===n.id)&&s.default.createElement(c.default,{empty:!0,onClick:this.cancel,loading:this.state.canceling},"\u5173\u95ed"))}},{key:"render",value:function(){var e=this.state.showForm;return s.default.createElement("div",{className:(0,E.default)(v.default.element,e?"":v.default.elementBotton)},e&&this.renderForm(),!e&&this.renderButtons())}}]),t}(),n.propTypes={mergeRequest:u.default.object,user:u.default.object,reviewers:u.default.object,reviewGood:u.default.func,cancelReviewGood:u.default.func,sayGood:u.default.func,sayBad:u.default.func,grant:u.default.func,cancelGrant:u.default.func,mergeMergeRequest:u.default.func,refuseMergeRequest:u.default.func,updateActivities:u.default.func,push:u.default.func,project:u.default.object},r);t.default=y},3871:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=h(a(0)),u=a(2),i=h(u),s=a(1495),c=h(a(550)),d=h(a(547)),f=h(a(1740)),m=h(a(8)),p=h(a(1614));function h(e){return e&&e.__esModule?e:{default:e}}var E=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={showChecks:!1},a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"renderMark",value:function(e){var t=i.default.createElement(f.default,{className:(0,m.default)(p.default.checkIcon,p.default.normal)});return e.status===s.MARK_STATUS.SUCCESS?t=i.default.createElement(c.default,{className:(0,m.default)(p.default.checkIcon,p.default.good)}):e.status===s.MARK_STATUS.FAIL&&(t=i.default.createElement(d.default,{className:(0,m.default)(p.default.checkIcon,p.default.bad)})),i.default.createElement("li",{className:p.default.check},t,i.default.createElement("span",{className:p.default.name},e.name),i.default.createElement("span",{className:p.default.description},i.default.createElement("span",{className:p.default.line},"-"),e.description),i.default.createElement("a",{target:"_blank",className:p.default.info,href:e.url},"\u8be6\u60c5"))}},{key:"render",value:function(){var e=this,t=this.props.marks,n=t[t.length-1],r=i.default.createElement("img",{src:a(2292),className:p.default.img}),l="\u6301\u7eed\u96c6\u6210\u72b6\u6001\u68c0\u67e5\u672a\u901a\u8fc7";return n.status===s.MARK_STATUS.SUCCESS?(r=i.default.createElement("img",{src:a(2291),className:p.default.img}),l="\u6301\u7eed\u96c6\u6210\u72b6\u6001\u68c0\u67e5\u901a\u8fc7"):n.status===s.MARK_STATUS.FAIL&&(r=i.default.createElement("img",{src:a(2292),className:p.default.img}),l="\u6301\u7eed\u96c6\u6210\u72b6\u6001\u68c0\u67e5\u672a\u901a\u8fc7"),i.default.createElement("div",{className:p.default.element},i.default.createElement("div",{className:p.default.icon},r),i.default.createElement("div",{className:p.default.content},i.default.createElement("div",{className:p.default.title},l),i.default.createElement("div",{className:p.default.desc},"\u5171\u6709 ",t.length," \u9879\u68c0\u67e5"),this.state.showChecks&&i.default.createElement("ul",{className:p.default.checks},t.map(this.renderMark))),i.default.createElement("div",{className:p.default.actions},i.default.createElement("span",{className:p.default.action,onClick:function(){e.setState({showChecks:!e.state.showChecks})}},this.state.showChecks?"\u9690\u85cf\u6240\u6709\u68c0\u67e5":"\u663e\u793a\u6240\u6709\u68c0\u67e5")))}}]),t}(),n.propTypes={marks:o.default.array},r);t.default=E},3872:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=h(a(0)),u=a(2),i=h(u),s=h(a(263)),c=a(112),d=h(a(544)),f=a(168),m=h(a(699)),p=h(a(1614));function h(e){return e&&e.__esModule?e:{default:e}}var E=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={deleted:!e.mergeRequest.src_branch_exists,deleting:!1,reverting:!1},a.revert=a.revert.bind(a),a.delete=a.delete.bind(a),a.restore=a.restore.bind(a),a.deleteText=a.deleteText.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"revert",value:function(){var e=this,t=this.props,a=t.mergeRequest,n=t.revertMergeRequest;this.state.reverting||(this.setState({reverting:!0}),n(a.merge_request.iid).then(function(t){e.setState({reverting:!1}),t.data?location.href=t.data:(0,c.danger)("\u65e0\u6cd5\u81ea\u52a8\u81ea\u52a8\u521b\u5efa Revert, \u8bf7\u624b\u52a8\u521b\u5efa")}))}},{key:"delete",value:function(){var e=this,t=this.props,a=t.mergeRequest,n=t.deleteSourceBranch;this.state.deleting||(this.setState({deleting:!0}),n(a.merge_request.iid).then(function(){e.setState({deleting:!1,deleted:!0})}))}},{key:"restore",value:function(){var e=this,t=this.props,a=t.mergeRequest,n=t.restoreSourceBranch;this.state.deleting||(this.setState({deleting:!0}),n(a.merge_request.iid).then(function(){e.setState({deleting:!1,deleted:!1})}))}},{key:"deleteText",value:function(){return this.state.deleting?i.default.createElement(m.default,null):this.state.deleted?"\u6062\u590d\u5206\u652f":"\u5220\u9664\u5206\u652f"}},{key:"render",value:function(){var e,t=this,n=this.props.mergeRequest;return i.default.createElement("div",{className:p.default.element},i.default.createElement("div",{className:p.default.actions},n.can_edit_src_branch&&i.default.createElement(d.default,{empty:!0,onClick:function(){t.state.deleted?t.restore():t.delete()}},this.deleteText()),n.merge_request.merged_sha&&i.default.createElement(d.default,{empty:!0,onClick:this.revert,loading:this.state.reverting},"\u64a4\u9500\u5408\u5e76")),i.default.createElement("div",{className:p.default.icon},i.default.createElement("img",{src:a(3873),className:p.default.img})),i.default.createElement("div",{className:p.default.content},i.default.createElement("div",{className:p.default.title},"\u5206\u652f\u5df2\u7ecf\u5408\u5e76"),i.default.createElement("div",{className:p.default.desc,style:{width:"calc(100% - 230px)"}},i.default.createElement(f.Link,{className:p.default.author,to:n.merge_request.action_author.path},n.merge_request.action_author.name)," ","\u5408\u5e76\u4e8e ",(e=n.merge_request.action_at,i.default.createElement("time",{title:(0,s.default)(new Date(e)).format("llll")},(0,s.default)(new Date(e)).fromNow())),"\uff0c \u6e90\u5206\u652f"," ",i.default.createElement("span",{className:p.default.branch},n.merge_request.srcBranch)," ",this.state.deleted?"\u5df2\u88ab\u5220\u9664":"\u53ef\u88ab\u5b89\u5168\u5220\u9664","\u3002")))}}]),t}(),n.propTypes={mergeRequest:o.default.object,revertMergeRequest:o.default.func,deleteSourceBranch:o.default.func,restoreSourceBranch:o.default.func},r);t.default=E},3873:function(e,t,a){e.exports=a.p+"static/media/merge.eedb6832.svg"},3874:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=c(a(0)),u=a(2),i=c(u),s=c(a(1739));function c(e){return e&&e.__esModule?e:{default:e}}var d=(r=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"render",value:function(){var e=this.props,t=e.mergeRequest,a=e.currentDepot;return i.default.createElement(s.default,{commits:t.data.merge_request.commits,depot:a})}}]),t}(),n.propTypes={mergeRequest:o.default.object,currentDepot:o.default.object},r);t.default=d},3875:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=d(a(0)),u=a(2),i=d(u),s=d(a(698)),c=d(a(1741));function d(e){return e&&e.__esModule?e:{default:e}}function f(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var m=(r=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"render",value:function(){var e=this.props,t=e.activities,a=e.mergeRequest,n=e.currentDepot,r=e.postLineNote,l=e.deleteLineNote,o=e.readOnly;if(t.commentLoading)return i.default.createElement(s.default,{show:!0});var u=t.item.length>0?t.item.reduce(function(e,t){return[].concat(f(e),f(t))}).filter(function(e){return e.commitId}):[];return i.default.createElement(c.default,{readOnly:o,depot:n,comments:u,diffStat:a.data.merge_request.diffStat,ref1:a.data.merge_request.target_sha,ref2:a.data.merge_request.source_sha,type:"MergeRequestBean",noteableId:a.data.merge_request.id,postLineNote:r,deleteLineNote:l})}}]),t}(),n.propTypes={activities:o.default.object,mergeRequest:o.default.object,currentDepot:o.default.object,postLineNote:o.default.func,deleteLineNote:o.default.func,readOnly:o.default.bool},n.defaultProps={readOnly:!1},r);t.default=m},3876:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"merges**",documentTitle:(0,r.projectPage)(function(){return"\u5408\u5e76\u8bf7\u6c42"}),getComponent:function(e,t){a.e(172).then(function(){(0,n.injectAsyncReducer)("MERGE_REQUESTS",a(4032).default),t(null,a(4034).default)}.bind(null,a)).catch(a.oe)}}},3877:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"plot",documentTitle:(0,r.projectPage)(function(){return"\u9879\u76ee\u7f51\u7edc"}),getComponent:function(e,t){a.e(173).then(function(){(0,n.injectAsyncReducer)("PLOT",a(4055).default),t(null,a(4059).default)}.bind(null,a)).catch(a.oe)}}},3878:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"tags",documentTitle:(0,r.projectPage)(function(){return"\u6807\u7b7e\u7ba1\u7406"}),getComponent:function(e,t){a.e(174).then(function(){(0,n.injectAsyncReducer)("TAG",a(4065).default),t(null,a(4066).default)}.bind(null,a)).catch(a.oe)},indexRoute:{component:a(3879).default},childRoutes:[{path:"create",component:a(3881).default,documentTitle:{prefix:"\u521b\u5efa\u6807\u7b7e"}}]}},3879:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=P(a(0)),i=a(2),s=P(i),c=P(a(545)),d=P(a(698)),f=P(a(1455)),m=a(2293),p=a(1484),h=a(226),E=P(a(76)),g=P(a(1467)),v=a(168),b=P(a(544)),y=P(a(1550)),_=P(a(1472)),R=P(a(3880)),C=P(a(1558)),w=P(a(547)),S=P(a(1450)),T=P(a(702)),k=P(a(263)),N=P(a(1565)),j=P(a(1869));function P(e){return e&&e.__esModule?e:{default:e}}var O=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.fetchData=a.fetchData.bind(a),a.onPage=a.onPage.bind(a),a.renderTags=a.renderTags.bind(a),a.isRelease=a.isRelease.bind(a),a.state={showMessage:{},releases:[]},a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"componentDidMount",value:function(){var e=this;this.fetchData(this.props),this.props.fetchReleasesList().then(function(t){e.setState({releases:t.data})})}},{key:"componentWillReceiveProps",value:function(e){e.location.query.page!==this.props.location.query.page&&this.fetchData(e)}},{key:"fetchData",value:function(e){e.fetchTags(e.location.query.page||1)}},{key:"onPage",value:function(e){this.props.router.push(l({},this.props.location,{query:l({},this.props.location.query,{page:e})}))}},{key:"deleteTag",value:function(e){confirm("\u8bf7\u786e\u8ba4\u662f\u5426\u8981\u5220\u9664\u6807\u7b7e "+e+" ?")&&this.props.deleteTag(e)}},{key:"renderTags",value:function(){var e=this.props.tags.items;return(0,E.default)(e)?this.renderEmpty():s.default.createElement("table",{className:j.default.tagList},s.default.createElement("tbody",null,e.map(this.renderTag,this)))}},{key:"renderEmpty",value:function(){return s.default.createElement(T.default,{icon:T.default.ICONS.Tag},s.default.createElement("div",{className:j.default.initContainer},s.default.createElement("div",{className:j.default.title},"\u4f7f\u7528\u6807\u7b7e\u6807\u8bb0\u91cd\u8981\u7684\u63d0\u4ea4"),s.default.createElement("div",{className:j.default.intro},"\u53ef\u4ee5\u7ed9\u5386\u53f2\u4e2d\u7684\u67d0\u4e00\u4e2a\u63d0\u4ea4\u6253\u4e0a\u6807\u7b7e\uff0c\u4ee5\u793a\u91cd\u8981"),s.default.createElement(v.Link,{to:this.props.projectPath+"/git/tags/create"},s.default.createElement(b.default,{size:"large"},"\u65b0\u5efa\u6807\u7b7e"))))}},{key:"renderNewTag",value:function(){var e=this.props.tags.items;return(0,E.default)(e)?null:s.default.createElement(v.Link,{className:j.default.create,to:this.props.projectPath+"/git/tags/create"},s.default.createElement(b.default,null,"\u65b0\u5efa\u6807\u7b7e"))}},{key:"isRelease",value:function(e){return(0,N.default)(this.state.releases,function(t){return t===e.name})>-1}},{key:"renderTag",value:function(e,t){var a,n=this,r=this.props.projectPath,l=this.isRelease(e),o=r+"/git/archive/"+(0,S.default)(e.name);return s.default.createElement("tr",{key:t},s.default.createElement("td",{className:j.default.main},s.default.createElement("div",{className:j.default.tagInfo},s.default.createElement("h3",null,s.default.createElement(v.Link,{to:r+"/git/tree/"+(0,S.default)(e.name)},e.name),s.default.createElement("span",{className:j.default.hiddenTextExpander,onClick:function(){var t=n.state.showMessage;t[e.name]=!t[e.name],n.setState({showMessage:t})}},s.default.createElement("a",{className:j.default.ellipsisExpander},"\u2026"))),this.state.showMessage[e.name]&&s.default.createElement("div",{className:j.default.commitDesc},s.default.createElement("pre",{dangerouslySetInnerHTML:{__html:e.message}})),s.default.createElement("ul",{className:j.default.tagReferences},s.default.createElement("li",{className:j.default.commit},s.default.createElement(v.Link,{to:r+"/git/commit/"+(0,S.default)(e.name)},s.default.createElement(y.default,null)," ",e.last_commit.commitId&&e.last_commit.commitId.substring(0,7))),s.default.createElement("li",null,s.default.createElement(v.Link,null,s.default.createElement(_.default,null)," ",(a=e.created_at,s.default.createElement("time",{title:(0,k.default)(new Date(a)).format("llll")},(0,k.default)(new Date(a)).fromNow())))),s.default.createElement("li",null,s.default.createElement("a",{href:o+".zip"},s.default.createElement(R.default,null)," zip")),s.default.createElement("li",null,s.default.createElement("a",{href:o+".tar.gz"},s.default.createElement(R.default,null)," tar.gz")),l&&s.default.createElement("li",null,s.default.createElement(v.Link,{to:r+"/git/releases/"+(0,S.default)(e.name)},s.default.createElement(C.default,null)," \u7248\u672c\u53d1\u5e03\u63cf\u8ff0")),!l&&s.default.createElement("li",null,s.default.createElement("a",{className:j.default.remove,onClick:function(){return n.deleteTag(e.name)}},s.default.createElement(w.default,null)," \u5220\u9664"))))),s.default.createElement("td",{className:j.default.ancillary},s.default.createElement("h4",null,l&&s.default.createElement(v.Link,{to:r+"/git/releases/edit/"+(0,S.default)(e.name)},"\u7f16\u8f91\u7248\u672c\u53d1\u5e03\u63cf\u8ff0"),!l&&s.default.createElement(v.Link,{to:r+"/git/releases/create?name="+(0,S.default)(e.name)},"\u65b0\u5efa\u7248\u672c\u53d1\u5e03\u63cf\u8ff0"))))}},{key:"render",value:function(){var e=this.props.tags,t=e.pager,a=e.loading,n=this.props.location.query,r=[{key:"release",tab:s.default.createElement(v.Link,{to:this.props.projectPath+"/git/releases"},"\u7248\u672c\u53d1\u5e03")},{key:"tag",tab:s.default.createElement(v.Link,{to:this.props.projectPath+"/git/tags"},"\u6807\u7b7e")}];return s.default.createElement("div",{className:j.default.container},s.default.createElement("div",{className:j.default.header},s.default.createElement("div",{className:j.default.title},"\u6807\u7b7e\u7ba1\u7406")),this.renderNewTag(),s.default.createElement(g.default,{activeKey:"tag",tabs:r,link:!0}),s.default.createElement(d.default,{show:a,className:j.default.loading}),!a&&this.renderTags(),!a&&t.pageSize>1&&s.default.createElement(f.default,{pager:{page:parseInt(n.page,10)||t.page,pageSize:parseInt(n.pageSize,10)||t.pageSize,totalPage:t.totalPage,totalRow:t.totalRow},onChange:this.onPage}))}}]),t}(),n.propTypes={fetchReleasesList:u.default.func,fetchTags:u.default.func,deleteTag:u.default.func,location:u.default.object,push:u.default.func,tags:u.default.shape({loading:u.default.bool,items:u.default.array,pager:u.default.object}),projectPath:u.default.string,router:u.default.shape({push:u.default.func})},r);t.default=(0,c.default)(function(e){var t=e.APP.projectPath;return{tags:e.TAG.tags,projectPath:t}},{fetchTags:m.fetchTags,deleteTag:m.deleteTag,push:h.push,fetchReleasesList:p.fetchReleasesList})(O)},3881:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=C(a(0)),u=a(2),i=C(u),s=C(a(545)),c=a(226),d=a(168),f=C(a(544)),m=C(a(261)),p=C(a(1664)),h=C(a(547)),E=C(a(550)),g=C(a(1551)),v=a(2293),b=C(a(1565)),y=a(112),_=C(a(1869)),R=a(1484);function C(e){return e&&e.__esModule?e:{default:e}}var w=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.renderForm=a.renderForm.bind(a),a.submitForm=a.submitForm.bind(a),a.state={tagName:"",tagPoint:a.props.currentDepot.default_branch||"",tagSha:a.props.currentDepot.lastCommitSha||"",message:"",tags:[],submitting:!1,canSubmit:!1,tips:"\u8bf7\u8f93\u5165\u6807\u7b7e\u53f7\uff0c\u5e76\u9009\u62e9\u7248\u672c",tipClassName:_.default.normal},a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),l(t,[{key:"submitForm",value:function(){var e=this;this.state.canSubmit&&(this.state.submitting||(this.setState({submitting:!0}),this.props.createTag(this.state.tagName.trim(),this.state.tagSha,this.state.tagPoint,this.state.message).then(function(){(0,y.success)("\u65b0\u5efa\u6210\u529f"),e.props.fetchTagsList(),e.props.push(e.props.currentDepot.depot_path+"/tags")}).finally(function(){return e.setState({submitting:!1})})))}},{key:"renderForm",value:function(){var e=this;return i.default.createElement("form",null,i.default.createElement("dl",null,i.default.createElement("dd",null,i.default.createElement(m.default,{size:"large",className:_.default.name,value:this.state.tagName,placeholder:"\u6807\u7b7e\u7248\u672c",onChange:function(t){var a=t.target.value.trim();e.setState({tagName:a}),0!==a.length?(0,b.default)(e.props.refs.tags,function(e){return e===a})>-1?e.setState({canSubmit:!1,tips:"\u6807\u7b7e\u540d\u91cd\u590d",tipClassName:_.default.error}):(e.setState({canSubmit:!0}),e.setState({canSubmit:!0,tips:"\u6807\u7b7e\u540d\u53ef\u7528",tipClassName:_.default.success})):e.setState({canSubmit:!1,tips:"\u6807\u7b7e\u540d\u4e0d\u80fd\u4e3a\u7a7a",tipClassName:_.default.error})}}),i.default.createElement(p.default,{className:_.default.at}),i.default.createElement(g.default,{triggerClassName:_.default.dropdown,prefix:"\u57fa\u4e8e\uff1a",depot:this.props.currentDepot,items:this.props.refs,onChange:function(t){e.setState({tagPoint:t.value.trim(),tagSha:t.sha})},value:this.state.tagPoint}),i.default.createElement("p",{className:this.state.tipClassName},this.state.tipClassName===_.default.success&&i.default.createElement(E.default,null),this.state.tipClassName===_.default.error&&i.default.createElement(h.default,null)," "+this.state.tips))),i.default.createElement("dl",null,i.default.createElement("dd",null,i.default.createElement(m.default,{type:"textarea",name:"message",value:this.state.message,autoSize:{minRows:8},block:!0,placeholder:"\u6807\u7b7e\u8bf4\u660e\uff08\u4e0d\u652f\u6301 Markdown\uff09",onChange:function(t){e.setState({message:t.target.value.trim()})}}))),i.default.createElement("dl",null,i.default.createElement("dd",null,i.default.createElement(f.default,{className:_.default.btn,onClick:this.submitForm,disabled:!this.state.canSubmit,loading:this.state.submitting},"\u521b\u5efa\u6807\u7b7e"),i.default.createElement(d.Link,{to:this.props.currentDepot.depot_path+"/tags"},i.default.createElement(f.default,{empty:!0},"\u53d6\u6d88")))))}},{key:"render",value:function(){return i.default.createElement("div",{className:_.default.container},i.default.createElement("div",{className:_.default.header},i.default.createElement("div",{className:_.default.title},"\u65b0\u5efa\u6807\u7b7e")),i.default.createElement("div",{className:_.default.newTag},i.default.createElement("div",{className:_.default.form},this.renderForm()),i.default.createElement("div",{className:_.default.infos},i.default.createElement("h3",null,"\u8bed\u4e49\u5316\u7248\u672c"),i.default.createElement("p",null,"\u5982\u679c\u60a8\u662f\u65b0\u63a5\u89e6\u7248\u672c\u53d1\u5e03\u7684\u8bdd\uff0c \u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u9605\u8bfb"," ",i.default.createElement("a",{href:"http://semver.org/lang/zh-CN/"},"\u8bed\u4e49\u5316\u7248\u672c"),"\u3002"),i.default.createElement("h3",null,"\u6458\u8981"),i.default.createElement("p",null,"\u7248\u672c\u683c\u5f0f\uff1a\u4e3b\u7248\u672c\u53f7.\u6b21\u7248\u672c\u53f7.\u4fee\u8ba2\u53f7\uff0c\u7248\u672c\u53f7\u9012\u589e\u89c4\u5219\u5982\u4e0b\uff1a"),i.default.createElement("p",null,"1. \u4e3b\u7248\u672c\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u4e0d\u517c\u5bb9\u7684 API \u4fee\u6539\uff1b",i.default.createElement("br",null),"2. \u6b21\u7248\u672c\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u5411\u4e0b\u517c\u5bb9\u7684\u529f\u80fd\u6027\u65b0\u589e\uff1b",i.default.createElement("br",null),"3. \u4fee\u8ba2\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u5411\u4e0b\u517c\u5bb9\u7684\u95ee\u9898\u4fee\u6b63\u3002",i.default.createElement("br",null),"\u5148\u884c\u7248\u672c\u53f7\u53ca\u7248\u672c\u7f16\u8bd1\u4fe1\u606f\u53ef\u4ee5\u52a0\u5230\u201c\u4e3b\u7248\u672c\u53f7.\u6b21\u7248\u672c\u53f7.\u4fee\u8ba2\u53f7\u201d\u7684\u540e\u9762\uff0c\u4f5c\u4e3a\u5ef6\u4f38\u3002",i.default.createElement("br",null)))))}}]),t}(),n.propTypes={currentDepot:o.default.object,createTag:o.default.func,refs:o.default.object,push:o.default.func,fetchTagsList:o.default.func},r);t.default=(0,s.default)(function(e){return{currentDepot:e.APP.currentDepot,refs:e.DEPOT.refs}},{createTag:v.createTag,push:c.push,fetchTagsList:R.fetchTagsList})(w)},3882:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"tree/**",documentTitle:(0,r.projectPage)(function(e){var t=e.TREE.tree.data;return t.ref&&!t.path?t.ref+" - \u4ee3\u7801\u6d4f\u89c8":t.ref&&t.path?t.path+" - "+t.ref+" - \u4ee3\u7801\u6d4f\u89c8":"\u4ee3\u7801\u6d4f\u89c8"}),getComponent:function(e,t){Promise.all([a.e(20),a.e(68)]).then(function(){(0,n.injectAsyncReducer)("TREE",a(2283).default),t(null,a(2285).default)}.bind(null,a)).catch(a.oe)}}},3883:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449),l=a(51);t.default={path:"releases",documentTitle:(0,r.projectPage)(function(){return"\u53d1\u5e03\u7ba1\u7406"}),getComponent:function(e,t){a.e(175).then(function(){(0,n.injectAsyncReducer)("RELEASES",a(4067).default),(0,n.injectAsyncReducer)("TASK_DETAIL",a(1699).default),(0,n.injectAsyncReducer)("REFERENCE_SELECTOR",a(1608).default),(0,l.injectAsyncI18n)("TASK_DETAIL",a(1802)),(0,l.injectAsyncI18n)("REFERENCE_SELECTOR",a(1609)),t(null,a(4068).default)}.bind(null,a)).catch(a.oe)},indexRoute:{component:a(3884).default},childRoutes:[{path:"create",component:a(3887).default,documentTitle:{prefix:"\u521b\u5efa Release"}},{path:"edit/**",component:a(3888).default,documentTitle:(0,r.projectPage)(function(e){var t=e.RELEASES.release.data;return t.title?t.title+" - \u7f16\u8f91 Release":"\u7f16\u8f91 Release"})},{path:"**",component:a(3889).default,documentTitle:(0,r.projectPage)(function(e){var t=e.RELEASES.release.data;return t.title?t.title+" - Release":"Release"})}]}},3884:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=w(a(0)),i=a(2),s=w(i),c=a(168),d=a(226),f=w(a(76)),m=w(a(1455)),p=w(a(1467)),h=w(a(544)),E=w(a(545)),g=w(a(698)),v=w(a(1450)),b=a(112),y=w(a(702)),_=w(a(2295)),R=a(1811),C=w(a(1648));function w(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var T=(r=n=function(e){function t(){var e,a,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];return a=n=S(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),n.onPage=function(e){n.props.router.push(l({},n.props.location,{query:l({},n.props.location.query,{page:e})}))},n.renderReleases=function(){var e=n.props.releases.items;return(0,f.default)(e)?n.renderEmpty():s.default.createElement("div",{className:C.default.releases},e.map(function(e,t){return s.default.createElement(_.default,{key:t,item:e,project:n.props.currentProject,user:n.props.user,delete:n.deleteRelease})}))},n.deleteRelease=function(e,t){confirm("\u8bf7\u786e\u8ba4\u662f\u5426\u5220\u9664\u7248\u672c "+e.tag_name+" ?")?n.props.deleteRelease((0,v.default)(e.tag_name)).then(function(){return(0,b.success)(e.tag_name+" \u7248\u672c\u5220\u9664\u6210\u529f")}).then(function(){return n.props.fetchReleases(n.props.location.query.page||1)}).finally(function(){return t()}):t()},S(n,a)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"componentDidMount",value:function(){this.fetchData(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.location.query.page!==this.props.location.query.page&&this.fetchData(e)}},{key:"fetchData",value:function(e){return e.fetchReleases(e.location.query.page||1)}},{key:"renderEmpty",value:function(){return s.default.createElement(y.default,{icon:y.default.ICONS.Release},s.default.createElement("div",{className:C.default.initContainer},s.default.createElement("div",{className:C.default.title},"\u53d1\u5e03\u4f60\u7684\u7b2c\u4e00\u4e2a\u7248\u672c"),s.default.createElement("div",{className:C.default.intro},"\u7528\u4e00\u7ec4\u7b80\u5355\u7684\u89c4\u5219\u53ca\u6761\u4ef6\u6765\u7ea6\u675f\u6bcf\u4e00\u4e2a\u7248\u672c\u53f7"),s.default.createElement(c.Link,{to:this.props.projectPath+"/git/releases/create"},s.default.createElement(h.default,{size:"large"},"\u65b0\u5efa\u7248\u672c\u53d1\u5e03"))))}},{key:"renderNewRelease",value:function(){var e=this.props.releases.items;return(0,f.default)(e)?null:s.default.createElement(c.Link,{className:C.default.create,to:this.props.projectPath+"/git/releases/create"},s.default.createElement(h.default,null,"\u65b0\u5efa\u7248\u672c\u53d1\u5e03"))}},{key:"render",value:function(){var e=this.props,t=e.releases,a=t.pager,n=t.loading,r=e.location.query,l=[{key:"release",tab:s.default.createElement(c.Link,{to:this.props.projectPath+"/git/releases"},"\u7248\u672c\u53d1\u5e03")},{key:"tag",tab:s.default.createElement(c.Link,{to:this.props.projectPath+"/git/tags"},"\u6807\u7b7e")}];return s.default.createElement("div",{className:C.default.container},s.default.createElement("div",{className:C.default.header},s.default.createElement("div",{className:C.default.title},"\u53d1\u5e03\u7ba1\u7406")),this.renderNewRelease(),s.default.createElement(p.default,{activeKey:"release",tabs:l,link:!0}),s.default.createElement(g.default,{show:n,className:C.default.loading}),!n&&this.renderReleases(),!n&&a.pageSize>1&&s.default.createElement(m.default,{pager:{page:parseInt(r.page,10)||a.page,pageSize:parseInt(r.pageSize,10)||a.pageSize,totalPage:a.totalPage,totalRow:a.totalRow},onChange:this.onPage}))}}]),t}(),n.propTypes={fetchReleases:u.default.func,location:u.default.object,push:u.default.func,releases:u.default.shape({loading:u.default.bool,items:u.default.array,pager:u.default.object}),currentProject:u.default.object,projectPath:u.default.string,router:u.default.shape({push:u.default.func}),user:u.default.object,deleteRelease:u.default.func},r);t.default=(0,E.default)(function(e){var t=e.APP;return{projectPath:t.projectPath,currentProject:t.currentProject,user:t.user,releases:e.RELEASES.releases}},{fetchReleases:R.fetchReleases,deleteRelease:R.deleteRelease,push:d.push})(T)},3887:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l,o,u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),s=x(a(0)),c=a(2),d=x(c),f=x(a(545)),m=a(226),p=a(168),h=x(a(544)),E=x(a(261)),g=x(a(1664)),v=x(a(547)),b=x(a(550)),y=x(a(699)),_=x(a(701)),R=x(a(1551)),C=x(a(1578)),w=x(a(1615)),S=a(106),T=a(1484),k=x(a(1565)),N=x(a(1637)),j=x(a(1738)),P=a(112),O=a(266),A=x(a(2296)),M=a(1811),L=x(a(1648));function x(e){return e&&e.__esModule?e:{default:e}}function I(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var D=(0,O.withAsyncMarkEditor)()((l=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));o.call(a),a.renderForm=a.renderForm.bind(a),a.submitForm=a.submitForm.bind(a),a.onBodyEditorChange=a.onBodyEditorChange.bind(a),a.addReference=a.addReference.bind(a),a.delReference=a.delReference.bind(a),a.onCreateReferencedTask=a.onCreateReferencedTask.bind(a),a.onReferenceSelectorConfirm=a.onReferenceSelectorConfirm.bind(a),a.resetPoint=a.resetPoint.bind(a),a.onFileDrop=a.onFileDrop.bind(a),a.onFileRemove=a.onFileRemove.bind(a),a.handleTagNameChange=a.handleTagNameChange.bind(a);var n=a.props.refs.branches.find(function(e){return a.props.currentDepot.default_branch===e.text});return a.state={releases:[],submitting:!1,drafting:!1,canSubmit:!1,tips:"\u8bf7\u8f93\u5165\u6807\u7b7e\u53f7\uff0c\u5e76\u9009\u62e9\u7248\u672c",tipClassName:L.default.normal,tagName:a.props.location.query.name||"",commitSha:n?n.sha:a.props.currentDepot.lastCommitSha||"",targetCommitish:a.props.currentDepot.default_branch||"",title:"",pre:!1,references:[],editorState:e.defaultEditorState,showDropdown:!0,files:[],uploadingFiles:[]},a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),i(t,[{key:"componentWillMount",value:function(){this.updateInfo(this.props)}},{key:"componentWillReceiveProps",value:function(e,t){e&&e.refs&&e.refs.tags&&t&&t.refs&&t.refs.tags&&e.refs.tags!==t.refs.tags&&this.updateInfo(t)}},{key:"componentDidMount",value:function(){var e=this;if(this.props.fetchReleasesList().then(function(t){e.setState({releases:t.data})}),this.props.resourceSearch(),this.props.location.query.milestone_ref_code){var t=this.props.location.query.milestone_ref_code;this.props.fetchReleasesDescription(t).then(function(t){e.setState({editorState:e.props.createWithContent(t.data.body)})}),this.props.fetchResource(t).then(function(t){var a=u({},t.data);e.addReference(a)})}}},{key:"handleTagNameChange",value:function(e){if(0===e.length)return this.state.showDropdown||this.resetPoint(),void this.setState({canSubmit:!1,tips:"\u6807\u7b7e\u540d\u4e0d\u80fd\u4e3a\u7a7a",tipClassName:L.default.error,showDropdown:!0});if((0,k.default)(this.state.releases,function(t){return t===e})>-1)this.state.showDropdown||this.resetPoint(),this.setState({canSubmit:!1,tips:"\u53d1\u5e03\u7248\u672c\u6807\u7b7e\u540d\u5df2\u5b58\u5728",tipClassName:L.default.error,showDropdown:!0});else{var t=(0,j.default)(this.props.refs.tags,function(t){return t.text===e});t?this.setState({canSubmit:!0,tips:"\u6807\u7b7e\u540d\u53ef\u7528",tipClassName:L.default.success,targetCommitish:t.text,commitSha:t.sha,showDropdown:!1}):(this.state.showDropdown||this.resetPoint(),this.setState({canSubmit:!0,tips:"\u6807\u7b7e\u540d\u53ef\u7528",tipClassName:L.default.success,showDropdown:!0}))}}},{key:"onFileDrop",value:function(e){var t=this,a=this.state.files;e.forEach(function(e){if(!a.find(function(t){return t.name===e.name})){var n=t.state.uploadingFiles;n.push(e.name),t.setState({uploadingFiles:n}),t.props.uploadReleaseFile(e).then(function(e){a.push(e.data),t.setState({files:a})}).finally(function(){var a=(0,N.default)(n,e.name);t.setState({uploadingFiles:a})})}})}},{key:"onFileRemove",value:function(e){var t=this.state.files;t.splice(e,1),this.setState({files:t})}},{key:"onBodyEditorChange",value:function(e,t){this.setState({editorState:e},t)}},{key:"addReference",value:function(e){var t=[].concat(I(this.state.references));(0,j.default)(t,e)||(t.push(e),this.setState({references:t}))}},{key:"delReference",value:function(e){var t=[].concat(I(this.state.references));(0,N.default)(t,e),this.setState({references:t})}},{key:"onReferenceSelectorConfirm",value:function(e,t){return Promise.resolve(this.setState({references:[].concat(I(t))}))}},{key:"onCreateReferencedTask",value:function(e,t,a,n){var r=this;return this.props.createReferencedTask(e,t,a,n).then(function(e){var t={code:e.data.number,title:e.data.content,status:1,target_id:e.data.id,target_type:"Task",link:r.props.currentProject.project_path+"/task/"+e.data.id};r.addReference(t)})}},{key:"submitForm",value:function(e){var t=this;if(this.state.canSubmit&&!this.state.submitting&&!this.state.drafting)if(this.state.uploadingFiles.length>0)(0,P.danger)("\u6587\u4ef6\u4e0a\u4f20\u4e2d");else{"draft"===e?this.setState({drafting:!0}):this.setState({submitting:!0});var a={};S.IS_ENTERPRISE?this.state.references.forEach(function(e,t){a["resource_references["+t+"].target_project_id"]=e.target_project_id,a["resource_references["+t+"].target_iid"]=e.code}):a.resource_references=this.state.references.map(function(e){return e.code});var n=u({tag_name:this.state.tagName,commit_sha:this.state.commitSha,target_commitish:this.state.targetCommitish,title:this.state.title,body:this.props.getPlainText(this.state.editorState),draft:"draft"===e,pre:this.state.pre},a,{attachments:this.state.files.map(function(e){var t={};return!e.failed&&e.id>0&&(t[e.id]=e.name),t})});this.props.createRelease(n).then(function(){(0,P.success)("\u65b0\u5efa\u6210\u529f"),t.props.push(t.props.currentDepot.depot_path+"/releases")}).finally(function(){return t.setState({submitting:!1,drafting:!1})})}}},{key:"resetPoint",value:function(){this.setState({targetCommitish:this.props.currentDepot.default_branch,commitSha:this.props.currentDepot.lastCommitSha})}},{key:"renderForm",value:function(){var e=this,t=this.props,a=t.currentDepot,n=t.currentProject,r=t.MediumMarkEditor;return d.default.createElement("form",null,d.default.createElement("dl",null,d.default.createElement("dd",null,d.default.createElement(E.default,{size:"large",className:L.default.name,value:this.state.tagName,placeholder:"\u6807\u7b7e\u7248\u672c",onChange:function(t){var a=t.target.value.trim();e.setState({tagName:a}),e.handleTagNameChange(a)}}),this.state.showDropdown&&d.default.createElement(g.default,{className:L.default.at}),this.state.showDropdown&&d.default.createElement(R.default,{triggerClassName:L.default.dropdown,prefix:"\u57fa\u4e8e\uff1a",depot:a,items:this.props.refs,onChange:function(t){e.setState({targetCommitish:t.value,commitSha:t.sha})},value:this.state.targetCommitish,hideTags:!0}),d.default.createElement("p",{className:this.state.tipClassName},this.state.tipClassName===L.default.success&&d.default.createElement(b.default,null),this.state.tipClassName===L.default.error&&d.default.createElement(v.default,null)," "+this.state.tips))),d.default.createElement("dl",null,d.default.createElement("dd",null,d.default.createElement(E.default,{value:this.state.title,block:!0,size:"large",placeholder:"\u7248\u672c\u53d1\u5e03\u6807\u9898",onChange:function(t){e.setState({title:t.target.value})}}))),d.default.createElement("dl",null,d.default.createElement("dd",null,d.default.createElement(r,{placeholder:"\u8bf7\u5728\u6b64\u8f93\u5165\u7248\u672c\u53d1\u5e03\u63cf\u8ff0\u5185\u5bb9\uff08\u652f\u6301 Markdown\uff09",className:L.default.bodyEditor,onChange:this.onBodyEditorChange,editorState:this.state.editorState,projectId:n.id||0,autoSize:!1,mentionParams:{context_type:"task_description",item_id:n.id},hashSearchParams:{owner:n.owner_user_name,project:n.name}}))),d.default.createElement("dl",null,d.default.createElement("dd",null,d.default.createElement("div",{className:L.default.fileUploader},d.default.createElement(C.default,{accept:"any",maxSize:104857600,onDrop:this.onFileDrop}),this.state.uploadingFiles.length>0&&d.default.createElement("div",{className:L.default.fileList},this.state.uploadingFiles.map(function(e,t){return d.default.createElement("div",{className:L.default.fileItem,key:t},d.default.createElement("div",{className:L.default.name},e),d.default.createElement(y.default,{className:L.default.loadingIcon}))})),this.state.files.length>0&&d.default.createElement("div",{className:L.default.fileList},this.state.files.map(function(t,a){return d.default.createElement("div",{className:L.default.fileItem,key:a},d.default.createElement("div",{className:L.default.name},t.name),(0,w.default)(t.size,{symbols:{B:"Bytes"}}),d.default.createElement(v.default,{className:L.default.icon,onClick:function(){return e.onFileRemove(a)}}))}))))),d.default.createElement("dl",null,d.default.createElement("dd",null,d.default.createElement(A.default,{user:this.props.user,currentProject:n,references:this.state.references,resourceResults:this.props.resourceResults,members:this.props.memberItems,onResourceSearch:this.props.resourceSearch,onAddReference:this.addReference,onRemoveReference:this.delReference,onReferenceSelectorConfirm:this.onReferenceSelectorConfirm,onCreateReferencedTask:this.onCreateReferencedTask,onAddExternalLink:this.onAddExternalLink}))),d.default.createElement("dl",null,d.default.createElement("dd",null,d.default.createElement(_.default,{checked:this.state.pre,onChange:function(){e.setState({pre:!e.state.pre})},className:L.default.pre},d.default.createElement("strong",null,"\u8fd9\u662f\u4e00\u4e2a\u9884\u53d1\u5e03"),d.default.createElement("span",null,"\u6211\u4eec\u4f1a\u4e3a\u6b64\u7248\u672c\u53d1\u5e03\u663e\u793a\u9884\u53d1\u5e03\u6807\u8bc6\u3002")))),d.default.createElement("dl",null,d.default.createElement("dd",null,d.default.createElement(h.default,{className:L.default.btn,onClick:function(){return e.submitForm("create")},disabled:!this.state.canSubmit,loading:this.state.submitting},"\u521b\u5efa\u7248\u672c\u53d1\u5e03"),d.default.createElement(h.default,{className:L.default.btn,onClick:function(){return e.submitForm("draft")},disabled:!this.state.canSubmit,empty:!0,loading:this.state.drafting},"\u4fdd\u5b58\u8349\u7a3f"),d.default.createElement(p.Link,{to:this.props.currentDepot.depot_path+"/releases"},d.default.createElement(h.default,{empty:!0},"\u53d6\u6d88")))))}},{key:"render",value:function(){return d.default.createElement("div",{className:L.default.container},d.default.createElement("div",{className:L.default.header},d.default.createElement("div",{className:L.default.title},"\u65b0\u5efa\u7248\u672c\u53d1\u5e03")),d.default.createElement("div",{className:L.default.newRelease},d.default.createElement("div",{className:L.default.form},this.renderForm()),d.default.createElement("div",{className:L.default.infos},d.default.createElement("h3",null,"\u8bed\u4e49\u5316\u7248\u672c"),d.default.createElement("p",null,"\u5982\u679c\u60a8\u662f\u65b0\u63a5\u89e6\u7248\u672c\u53d1\u5e03\u7684\u8bdd\uff0c \u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u9605\u8bfb"," ",d.default.createElement("a",{href:"http://semver.org/lang/zh-CN/"},"\u8bed\u4e49\u5316\u7248\u672c"),"\u3002"),d.default.createElement("h3",null,"\u6458\u8981"),d.default.createElement("p",null,"\u7248\u672c\u683c\u5f0f\uff1a\u4e3b\u7248\u672c\u53f7.\u6b21\u7248\u672c\u53f7.\u4fee\u8ba2\u53f7\uff0c\u7248\u672c\u53f7\u9012\u589e\u89c4\u5219\u5982\u4e0b\uff1a"),d.default.createElement("p",null,"1. \u4e3b\u7248\u672c\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u4e0d\u517c\u5bb9\u7684 API \u4fee\u6539\uff1b",d.default.createElement("br",null),"2. \u6b21\u7248\u672c\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u5411\u4e0b\u517c\u5bb9\u7684\u529f\u80fd\u6027\u65b0\u589e\uff1b",d.default.createElement("br",null),"3. \u4fee\u8ba2\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u5411\u4e0b\u517c\u5bb9\u7684\u95ee\u9898\u4fee\u6b63\u3002",d.default.createElement("br",null),"\u5148\u884c\u7248\u672c\u53f7\u53ca\u7248\u672c\u7f16\u8bd1\u4fe1\u606f\u53ef\u4ee5\u52a0\u5230\u201c\u4e3b\u7248\u672c\u53f7.\u6b21\u7248\u672c\u53f7.\u4fee\u8ba2\u53f7\u201d\u7684\u540e\u9762\uff0c\u4f5c\u4e3a\u5ef6\u4f38\u3002",d.default.createElement("br",null)))))}}]),t}(),r.propTypes={currentDepot:s.default.object,currentProject:s.default.object,createRelease:s.default.func,uploadReleaseFile:s.default.func,push:s.default.func,user:s.default.object,memberItems:s.default.array,refs:s.default.object,resourceSearch:s.default.func,referenceSelectorConfirm:s.default.func,createReferencedTask:s.default.func,resourceResults:s.default.array,fetchReleasesList:s.default.func,location:s.default.object,fetchReleasesDescription:s.default.func,fetchResource:s.default.func,onAddExternalLink:s.default.func.isRequired,defaultEditorState:s.default.object,MediumMarkEditor:s.default.func,getPlainText:s.default.func,createWithContent:s.default.func},o=function(){var e=this;this.updateInfo=function(t){if(t.location.query.name){var a=t.refs.tags.findIndex(function(e){return e.text===t.location.query.name});a>=0&&e.setState({tagName:t.location.query.name||"",commitSha:t.refs.tags[a].sha,targetCommitish:t.refs.tags[a].text,showDropdown:!1,canSubmit:!0,tips:"\u6807\u7b7e\u540d\u53ef\u7528",tipClassName:L.default.success})}},this.onAddExternalLink=function(t){e.props.onAddExternalLink(t).then(function(t){var a=t.data;e.setState({references:[].concat(I(e.state.references),[a])})})}},n=l))||n;t.default=(0,f.default)(function(e){var t=e.APP,a=t.currentProject,n=t.user,r=t.currentDepot;return{currentProject:a,user:n,memberItems:e.PROJECT.common.memberItems,currentDepot:r,refs:e.DEPOT.refs,resourceResults:e.RELEASES.resourceResults}},{createRelease:M.createRelease,push:m.push,resourceSearch:M.resourceSearch,referenceSelectorConfirm:M.referenceSelectorConfirm,createReferencedTask:M.createReferencedTask,fetchReleasesList:T.fetchReleasesList,uploadReleaseFile:M.uploadReleaseFile,fetchReleasesDescription:M.fetchReleasesDescription,fetchResource:M.fetchResource,onAddExternalLink:M.onAddExternalLink})(D)},3888:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},u=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=a(2),s=M(i),c=M(a(0)),d=M(a(545)),f=a(226),m=a(168),p=M(a(544)),h=M(a(261)),E=M(a(1664)),g=M(a(547)),v=M(a(550)),b=M(a(699)),y=M(a(701)),_=M(a(1578)),R=M(a(1615)),C=M(a(1637)),w=M(a(1738)),S=M(a(1450)),T=a(112),k=a(106),N=a(266),j=M(a(2296)),P=a(1811),O=M(a(8)),A=M(a(1648));function M(e){return e&&e.__esModule?e:{default:e}}function L(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var x=(0,N.withAsyncMarkEditor)()((l=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.onAddExternalLink=function(e){a.props.onAddExternalLink(e).then(function(e){var t=e.data;a.setState({references:[].concat(L(a.state.references),[t])})})},a.renderForm=a.renderForm.bind(a),a.submitForm=a.submitForm.bind(a),a.onBodyEditorChange=a.onBodyEditorChange.bind(a),a.addReference=a.addReference.bind(a),a.delReference=a.delReference.bind(a),a.onCreateReferencedTask=a.onCreateReferencedTask.bind(a),a.onReferenceSelectorConfirm=a.onReferenceSelectorConfirm.bind(a),a.onSaveRef=a.onSaveRef.bind(a),a.resetPoint=a.resetPoint.bind(a),a.onFileDrop=a.onFileDrop.bind(a),a.onFileRemove=a.onFileRemove.bind(a),a.state={submitting:!1,drafting:!1,canSubmit:!1,tips:"\u8bf7\u8f93\u5165\u6807\u7b7e\u53f7\uff0c\u5e76\u9009\u62e9\u7248\u672c",tipClassName:A.default.normal,tagName:"",commitSha:"",targetCommitish:"",title:"",pre:!1,references:[],editorState:e.defaultEditorState,code:0,showDropdown:!0,files:[],uploadingFiles:[],originalCommitSha:"",originalTargetCommitish:"",originalTagName:""},a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),u(t,[{key:"componentDidMount",value:function(){var e=this;this.props.resourceSearch(),this.props.fetchRelease((0,S.default)(this.props.params.splat)).then(function(){var t=e.props.release.data;e.setState({tagName:t.tag_name,commitSha:t.commit_sha,targetCommitish:t.target_commitish,title:t.title,pre:t.pre,references:t.resource_references,canSubmit:!0,code:t.iid,originalCommitSha:t.commit_sha,originalTargetCommitish:t.target_commitish,originalTagName:t.tag_name,files:t.attachments.map(function(e){return{id:e.id,size:e.size,name:e.name}})}),e.editor.onFetch(t.body)}).catch(function(t){3900===t.code&&e.props.push(e.props.projectPath+"/git/releases")})}},{key:"onFileDrop",value:function(e){var t=this,a=this.state.files;e.forEach(function(e){if(!a.find(function(t){return t.name===e.name})){var n=t.state.uploadingFiles;n.push(e.name),t.setState({uploadingFiles:n}),t.props.uploadReleaseFile(e).then(function(e){a.push(e.data),t.setState({files:a})}).finally(function(){var a=(0,C.default)(n,e.name);t.setState({uploadingFiles:a})})}})}},{key:"onFileRemove",value:function(e){var t=this.state.files;t.splice(e,1),this.setState({files:t})}},{key:"onSaveRef",value:function(e){this.editor=e}},{key:"onBodyEditorChange",value:function(e,t){this.setState({editorState:e},t)}},{key:"addReference",value:function(e){var t=[].concat(L(this.state.references));(0,w.default)(t,e)||(t.push(e),this.setState({references:t}))}},{key:"delReference",value:function(e){var t=[].concat(L(this.state.references));(0,C.default)(t,e),this.setState({references:t})}},{key:"onReferenceSelectorConfirm",value:function(e,t){return Promise.resolve(this.setState({references:[].concat(L(t))}))}},{key:"onCreateReferencedTask",value:function(e,t,a,n){var r=this;return this.props.createReferencedTask(e,t,a,n).then(function(e){var t={code:e.data.number,title:e.data.content,status:1,target_id:e.data.id,target_type:"Task",link:r.props.currentProject.project_path+"/task/"+e.data.id};r.addReference(t)})}},{key:"submitForm",value:function(e){var t=this;if(this.state.canSubmit&&!this.state.submitting&&!this.state.drafting)if(this.state.uploadingFiles.length>0)(0,T.danger)("\u6587\u4ef6\u4e0a\u4f20\u4e2d");else{"draft"===e?this.setState({drafting:!0}):this.setState({submitting:!0});var a={};k.IS_ENTERPRISE?this.state.references.forEach(function(e,t){a["resource_references["+t+"].target_project_id"]=e.target_project_id,a["resource_references["+t+"].target_iid"]=e.code}):a.resource_references=this.state.references.map(function(e){return e.code});var n=o({tag_name:this.state.tagName,commit_sha:this.state.commitSha||this.props.currentDepot.lastCommitSha,target_commitish:this.state.targetCommitish,title:this.state.title,body:this.props.getPlainText(this.state.editorState),draft:"draft"===e,pre:this.state.pre},a,{attachments:this.state.files.map(function(e){var t={};return!e.failed&&e.id>0&&(t[e.id]=e.name),t})});this.props.updateRelease(n,(0,S.default)(this.props.params.splat)).then(function(e){(0,T.success)("\u66f4\u65b0\u6210\u529f"),t.props.push(t.props.currentDepot.depot_path+"/releases/"+(0,S.default)(e.tag_name))}).finally(function(){return t.setState({submitting:!1,drafting:!1})})}}},{key:"resetPoint",value:function(){this.setState({targetCommitish:this.state.originalTargetCommitish,commitSha:this.state.originalCommitSha})}},{key:"renderForm",value:function(){var e=this,t=this.props,a=t.currentProject,n=t.MediumMarkEditor;return s.default.createElement("form",null,s.default.createElement("dl",null,s.default.createElement("dd",{className:A.default.edit},s.default.createElement(h.default,{size:"large",className:A.default.name,value:this.state.tagName,disabled:!0}),s.default.createElement(E.default,{className:A.default.at}),s.default.createElement("div",{className:(0,O.default)(A.default.commitish,"ellipsis")},"\u57fa\u4e8e\uff1a",this.state.targetCommitish),s.default.createElement("p",{className:this.state.tipClassName},this.state.tipClassName===A.default.success&&s.default.createElement(v.default,null),this.state.tipClassName===A.default.error&&s.default.createElement(g.default,null)))),s.default.createElement("dl",null,s.default.createElement("dd",null,s.default.createElement(h.default,{value:this.state.title,block:!0,size:"large",placeholder:"\u7248\u672c\u53d1\u5e03\u6807\u9898",onChange:function(t){e.setState({title:t.target.value})}}))),s.default.createElement("dl",null,s.default.createElement("dd",null,s.default.createElement(n,{placeholder:"\u8bf7\u5728\u6b64\u8f93\u5165\u7248\u672c\u53d1\u5e03\u63cf\u8ff0\u5185\u5bb9\uff08\u652f\u6301 Markdown\uff09",className:A.default.bodyEditor,onChange:this.onBodyEditorChange,editorState:this.state.editorState,projectId:a.id||0,autoSize:!1,ref:this.onSaveRef,mentionParams:{context_type:"task_description",item_id:a.id},hashSearchParams:{owner:a.owner_user_name,project:a.name}}))),s.default.createElement("dl",null,s.default.createElement("dd",null,s.default.createElement("div",{className:A.default.fileUploader},s.default.createElement(_.default,{accept:"any",maxSize:104857600,onDrop:this.onFileDrop}),this.state.uploadingFiles.length>0&&s.default.createElement("div",{className:A.default.fileList},this.state.uploadingFiles.map(function(e,t){return s.default.createElement("div",{className:A.default.fileItem,key:t},s.default.createElement("div",{className:A.default.name},e),s.default.createElement(b.default,{className:A.default.loadingIcon}))})),this.state.files.length>0&&s.default.createElement("div",{className:A.default.fileList},this.state.files.map(function(t,a){return s.default.createElement("div",{className:A.default.fileItem,key:a},s.default.createElement("div",{className:A.default.name},t.name),(0,R.default)(t.size,{symbols:{B:"Bytes"}}),s.default.createElement(g.default,{className:A.default.icon,onClick:function(){return e.onFileRemove(a)}}))}))))),s.default.createElement("dl",null,s.default.createElement("dd",null,s.default.createElement(j.default,{user:this.props.user,references:this.state.references,currentProject:this.props.currentProject,resourceResults:this.props.resourceResults,members:this.props.memberItems,onResourceSearch:this.props.resourceSearch,onAddReference:this.addReference,onRemoveReference:this.delReference,onReferenceSelectorConfirm:this.onReferenceSelectorConfirm,onCreateReferencedTask:this.onCreateReferencedTask,excludeds:this.state.code,onAddExternalLink:this.onAddExternalLink}))),s.default.createElement("dl",null,s.default.createElement("dd",null,s.default.createElement(y.default,{checked:this.state.pre,onChange:function(){e.setState({pre:!e.state.pre})},className:A.default.pre},s.default.createElement("strong",null,"\u8fd9\u662f\u4e00\u4e2a\u9884\u53d1\u5e03"),s.default.createElement("span",null,"\u6211\u4eec\u4f1a\u4e3a\u6b64\u7248\u672c\u53d1\u5e03\u663e\u793a\u9884\u53d1\u5e03\u6807\u8bc6\u3002")))),s.default.createElement("dl",null,s.default.createElement("dd",null,s.default.createElement(p.default,{className:A.default.btn,onClick:function(){return e.submitForm("update")},disabled:!this.state.canSubmit,loading:this.state.submitting},"\u66f4\u65b0\u7248\u672c\u53d1\u5e03"),s.default.createElement(p.default,{className:A.default.btn,onClick:function(){return e.submitForm("draft")},disabled:!this.state.canSubmit,empty:!0,loading:this.state.drafting},"\u4fdd\u5b58\u8349\u7a3f"),s.default.createElement(m.Link,{to:this.props.currentDepot.depot_path+"/releases"},s.default.createElement(p.default,{empty:!0},"\u53d6\u6d88")))))}},{key:"render",value:function(){return s.default.createElement("div",{className:A.default.container},s.default.createElement("div",{className:A.default.header},s.default.createElement("div",{className:A.default.title},"\u7f16\u8f91\u7248\u672c\u53d1\u5e03")),s.default.createElement("div",{className:A.default.newRelease},s.default.createElement("div",{className:A.default.form},this.renderForm()),s.default.createElement("div",{className:A.default.infos},s.default.createElement("h3",null,"\u8bed\u4e49\u5316\u7248\u672c"),s.default.createElement("p",null,"\u5982\u679c\u60a8\u662f\u65b0\u63a5\u89e6\u7248\u672c\u53d1\u5e03\u7684\u8bdd\uff0c \u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u9605\u8bfb"," ",s.default.createElement("a",{href:"http://semver.org/lang/zh-CN/"},"\u8bed\u4e49\u5316\u7248\u672c"),"\u3002"),s.default.createElement("h3",null,"\u6458\u8981"),s.default.createElement("p",null,"\u7248\u672c\u683c\u5f0f\uff1a\u4e3b\u7248\u672c\u53f7.\u6b21\u7248\u672c\u53f7.\u4fee\u8ba2\u53f7\uff0c\u7248\u672c\u53f7\u9012\u589e\u89c4\u5219\u5982\u4e0b\uff1a"),s.default.createElement("p",null,"1. \u4e3b\u7248\u672c\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u4e0d\u517c\u5bb9\u7684 API \u4fee\u6539\uff1b",s.default.createElement("br",null),"2. \u6b21\u7248\u672c\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u5411\u4e0b\u517c\u5bb9\u7684\u529f\u80fd\u6027\u65b0\u589e\uff1b",s.default.createElement("br",null),"3. \u4fee\u8ba2\u53f7\uff1a\u5f53\u4f60\u505a\u4e86\u5411\u4e0b\u517c\u5bb9\u7684\u95ee\u9898\u4fee\u6b63\u3002",s.default.createElement("br",null),"\u5148\u884c\u7248\u672c\u53f7\u53ca\u7248\u672c\u7f16\u8bd1\u4fe1\u606f\u53ef\u4ee5\u52a0\u5230\u201c\u4e3b\u7248\u672c\u53f7.\u6b21\u7248\u672c\u53f7.\u4fee\u8ba2\u53f7\u201d\u7684\u540e\u9762\uff0c\u4f5c\u4e3a\u5ef6\u4f38\u3002",s.default.createElement("br",null)))))}}]),t}(),r.propTypes={currentDepot:c.default.object,currentProject:c.default.object,updateRelease:c.default.func,push:c.default.func,user:c.default.object,projectPath:c.default.string,release:c.default.object,memberItems:c.default.array,resourceSearch:c.default.func,referenceSelectorConfirm:c.default.func,createReferencedTask:c.default.func,resourceResults:c.default.array,fetchRelease:c.default.func,uploadReleaseFile:c.default.func,params:c.default.shape({splat:c.default.string}),onAddExternalLink:c.default.func.isRequired,defaultEditorState:c.default.object,MediumMarkEditor:c.default.func,getPlainText:c.default.func,createWithContent:c.default.func},n=l))||n;t.default=(0,d.default)(function(e){var t=e.APP,a=t.currentProject,n=t.user,r=t.projectPath,l=t.currentDepot,o=e.PROJECT.common.memberItems,u=e.RELEASES;return{currentProject:a,user:n,projectPath:r,currentDepot:l,memberItems:o,resourceResults:u.resourceResults,release:u.release}},{updateRelease:P.updateRelease,push:f.push,resourceSearch:P.resourceSearch,referenceSelectorConfirm:P.referenceSelectorConfirm,createReferencedTask:P.createReferencedTask,fetchRelease:P.fetchRelease,uploadReleaseFile:P.uploadReleaseFile,onAddExternalLink:P.onAddExternalLink})(x)},3889:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a(2),u=y(o),i=y(a(0)),s=y(a(545)),c=y(a(698)),d=a(1811),f=a(226),m=y(a(1467)),p=a(168),h=y(a(544)),E=y(a(2295)),g=y(a(1450)),v=a(112),b=y(a(1648));function y(e){return e&&e.__esModule?e:{default:e}}var _=(r=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.fetchData=a.fetchData.bind(a),a.renderReleases=a.renderReleases.bind(a),a.deleteRelease=a.deleteRelease.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),l(t,[{key:"componentDidMount",value:function(){this.fetchData(this.props)}},{key:"fetchData",value:function(e){var t=this;e.fetchRelease((0,g.default)(e.params.splat)).catch(function(e){3900===e.code&&t.props.push(t.props.projectPath+"/git/releases")})}},{key:"renderReleases",value:function(){return u.default.createElement("div",{className:b.default.releases},u.default.createElement(E.default,{item:this.props.release.data,project:this.props.currentProject,user:this.props.user,delete:this.deleteRelease}))}},{key:"deleteRelease",value:function(e,t){var a=this;confirm("\u8bf7\u786e\u8ba4\u662f\u5426\u5220\u9664\u7248\u672c "+e.tag_name+" ?")?this.props.deleteRelease((0,g.default)(e.tag_name)).then(function(){(0,v.success)(e.tag_name+" \u7248\u672c\u5220\u9664\u6210\u529f"),a.props.push(a.props.projectPath+"/git/releases")}).finally(function(){return t()}):t()}},{key:"render",value:function(){var e=[{key:"release",tab:u.default.createElement(p.Link,{to:this.props.projectPath+"/git/releases"},"\u7248\u672c\u53d1\u5e03")},{key:"tag",tab:u.default.createElement(p.Link,{to:this.props.projectPath+"/git/tags"},"\u6807\u7b7e")}];return u.default.createElement("div",{className:b.default.container},u.default.createElement("div",{className:b.default.header},u.default.createElement("div",{className:b.default.title},"\u53d1\u5e03\u7ba1\u7406")),u.default.createElement(p.Link,{className:b.default.create,to:this.props.projectPath+"/git/releases/create"},u.default.createElement(h.default,null,"\u65b0\u5efa\u7248\u672c\u53d1\u5e03")),u.default.createElement(m.default,{activeKey:"release",tabs:e,link:!0}),u.default.createElement(c.default,{show:this.props.release.loading,className:b.default.loading}),!this.props.release.loading&&this.renderReleases())}}]),t}(),n.propTypes={fetchRelease:i.default.func,location:i.default.object,push:i.default.func,projectPath:i.default.string,currentProject:i.default.object,release:i.default.object,router:i.default.shape({push:i.default.func}),params:i.default.shape({name:i.default.string}),user:i.default.object,deleteRelease:i.default.func},r);t.default=(0,s.default)(function(e){var t=e.APP;return{projectPath:t.projectPath,currentProject:t.currentProject,user:t.user,release:e.RELEASES.release}},{fetchRelease:d.fetchRelease,deleteRelease:d.deleteRelease,push:f.push})(_)},3890:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"delete/**",documentTitle:(0,r.projectPage)(function(e){var t=e.DELETE.delFile;return t.data&&t.data.ref&&!t.data.path?t.data.ref+" - \u5220\u9664\u6587\u4ef6":t.data&&t.data.ref&&t.data.file.path?t.data.file.path+" - "+t.data.ref+" - \u5220\u9664\u6587\u4ef6":"\u5220\u9664\u6587\u4ef6"}),getComponent:function(e,t){Promise.all([a.e(21),a.e(176)]).then(function(){(0,n.injectAsyncReducer)("COMPARE",a(1577).default),(0,n.injectAsyncReducer)("DELETE",a(4069).default),t(null,a(4070).default)}.bind(null,a)).catch(a.oe)}}},3891:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"new/**",documentTitle:(0,r.projectPage)(function(e){var t=e.NEWFILE.newFile;return t.data&&t.data.ref&&!t.data.path?t.data.ref+" - \u65b0\u5efa\u6587\u4ef6":t.data&&t.data.ref&&t.data.path?t.data.path+" - "+t.data.ref+" - \u65b0\u5efa\u6587\u4ef6":"\u65b0\u5efa\u6587\u4ef6"}),getComponent:function(e,t){Promise.all([a.e(21),a.e(177)]).then(function(){(0,n.injectAsyncReducer)("COMPARE",a(1577).default),(0,n.injectAsyncReducer)("NEWFILE",a(4072).default),t(null,a(4073).default)}.bind(null,a)).catch(a.oe)}}},3892:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(546),r=a(1449);t.default={path:"upload/**",documentTitle:(0,r.projectPage)(function(e){var t=e.UPLOADFILE.file;return t.data&&t.data.ref&&!t.data.path?t.data.ref+" - \u4e0a\u4f20\u6587\u4ef6":t.data&&t.data.ref&&t.data.path?t.data.path+" - "+t.data.ref+" - \u4e0a\u4f20\u6587\u4ef6":"\u4e0a\u4f20\u6587\u4ef6"}),getComponent:function(e,t){Promise.all([a.e(21),a.e(178)]).then(function(){(0,n.injectAsyncReducer)("COMPARE",a(1577).default),(0,n.injectAsyncReducer)("UPLOADFILE",a(4079).default),t(null,a(4080).default)}.bind(null,a)).catch(a.oe)}}}}]);
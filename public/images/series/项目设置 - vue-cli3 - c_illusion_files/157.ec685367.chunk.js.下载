(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{1591:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=s(r(0)),o=s(r(2)),l=s(r(550)),i=s(r(8)),u=r(1592);function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f=function(e){var t,r,a=e.children,s=e.show,f=e.isSelected,d=e.small,m=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["children","show","isSelected","small"]),p=(0,i.default)(u.corner,(c(t={},u.selected,f),c(t,u.small,d),t)),b=(0,i.default)(u.check,(c(r={},u.selected,f),c(r,u.small,d),r));return o.default.createElement("div",n({className:u.sticky},m),a,s?o.default.createElement("div",null,o.default.createElement("div",{className:p}),o.default.createElement(l.default,{className:b})):null)};f.propTypes={children:a.default.any,show:a.default.bool,small:a.default.bool,isSelected:a.default.bool},f.defaultProps={children:null,show:!1,small:!1,isSelected:!1},t.default=f},1592:function(e,t,r){e.exports={corner:"corner-2RH",selected:"selected-1bO",small:"small-3j0",check:"check-2S8",sticky:"sticky-2Vk"}},1675:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reset=function(e,t){return function(r){r({type:a.ACTION.RESET,totalCount:e,excludedCount:t})}},t.updateMembers=o,t.onSearch=function(e,t){if(e===a.SEARCH_TYPE.WATCHED)return function(e){return(0,n.get)("/api/user/friends?page=1&pageSize=1000").then(function(t){return e(o(t.data.list))})};if(e===a.SEARCH_TYPE.FAN)return function(e){return(0,n.get)("/api/user/followers?page=1&pageSize=1000").then(function(t){return e(o(t.data.list))})};if(e===a.SEARCH_TYPE.PROJECT)return function(e){return(0,n.get)("/api/project/"+t+"/members?page=1&pageSize=1000").then(function(t){return e(o(t.data.list.map(function(e){return e.user})))})};return function(e){return(0,n.get)("/api/user/search?key="+t).then(function(t){return e(o(t.data))})}},t.onSelect=function(e){return{type:a.ACTION.SELECT,member:e}},t.onUnselect=function(e){return{type:a.ACTION.UNSELECT,member:e}};var n=r(84),a=r(1654);function o(e){return{type:a.ACTION.UPDATE_MEMBERS,payload:e}}},1676:function(e,t,r){e.exports={container:"container-13C",box:"box-1tp",dropdown:"dropdown-2Vj",input:"input-3Uj","dropdown-list":"dropdown-list-f1m",dropdownList:"dropdown-list-f1m","dropdown-title":"dropdown-title-JNh",dropdownTitle:"dropdown-title-JNh","dropdown-special":"dropdown-special-1Lc",dropdownSpecial:"dropdown-special-1Lc",active:"active-Iyp","project-avatar":"project-avatar-1JY",projectAvatar:"project-avatar-1JY",members:"members-3wd","member-item":"member-item-32f",memberItem:"member-item-32f","member-avatar":"member-avatar-RC-",memberAvatar:"member-avatar-RC-","excluded-item":"excluded-item-24r",excludedItem:"excluded-item-24r","fake-member-item":"fake-member-item-XuB",fakeMemberItem:"fake-member-item-XuB","member-name":"member-name-3dB",memberName:"member-name-3dB",selecteds:"selecteds-fqU",label:"label-uuW","modal-container":"modal-container-16x",modalContainer:"modal-container-16x","modal-title":"modal-title-3bW",modalTitle:"modal-title-3bW",buttons:"buttons-_I9",red:"red-wo3"}},1697:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ACTION={GET_PROJECT_MEMBERS:"MEMBER.GET.PROJECT.MEMBERS",UPDATE_MEMBER_ALIAS:"MEMBER.UPDATE.MEMBER.ALIAS",UPDATE_MEMBER_ROLE:"MEMBER.UPDATE.MEMBER.ROLE",REMOVE_MEMBER:"MEMBER.REMOVE.MEMBER",FILTER_MEMBER_BY_ROLE_AND_KEYWORD:"MEMBER.FILTER.MEMBER.BY.ROLE.AND.KEYWORD",ADD_MEMBERS_BY_GLOBAL_KEY:"MEMBER.ADD.MEMBERS.BY.GLOBAL.KEY",GET_MEMBER_SELECTOR_REMAINING_COUNT:"MEMBER.GET.MEMBER.SELECTOR.REMAINING.COUNT",INITIAL_MEMBER_ROLE:"MEMBER.INITIAL.MEMBER.ROLE"},t.OWNER_AUTH_ITEMS=[{text:"\u7ba1\u7406\u5458",value:90},{text:"\u666e\u901a\u6210\u5458",value:80},{text:"\u53d7\u9650\u6210\u5458",value:75}],t.ADMIN_AUTH_ITEMS=[{text:"\u666e\u901a\u6210\u5458",value:80},{text:"\u53d7\u9650\u6210\u5458",value:75}],t.PERSONAL_PROJECT_ROLE_FILTER=[{text:"\u6240\u6709\u6210\u5458",value:0},{text:"\u6240\u6709\u8005",value:100},{text:"\u7ba1\u7406\u5458",value:90},{text:"\u666e\u901a\u6210\u5458",value:80},{text:"\u53d7\u9650\u6210\u5458",value:75}],t.TEAM_PROJECT_ROLE_FILTER=[{text:"\u6240\u6709\u6210\u5458",value:0},{text:"\u7ba1\u7406\u5458",value:90},{text:"\u666e\u901a\u6210\u5458",value:80},{text:"\u53d7\u9650\u6210\u5458",value:75}],t.MEMBER_ROLE_AUTH={100:"\u6240\u6709\u8005",90:"\u7ba1\u7406\u5458",80:"\u666e\u901a\u6210\u5458",75:"\u53d7\u9650\u6210\u5458"},t.ALIAS_REGEX=/^([a-zA-Z0-9-_\u4e00-\u9fa5]{3,32}|[\u4e00-\u9fa5]{2,32})$/},1812:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateMemberAlias=function(e,t){return(0,a.dispatchWithProjectIdApiPrefix)(function(r,l){return(0,a.autoDispatch)((0,n.post)(r+"/members/update_alias/"+e,{alias:t}),l,o.ACTION.UPDATE_MEMBER_ALIAS,function(){return{memberID:e,alias:t}})})},t.updateMemberRole=function(e,t){return(0,a.dispatchWithProjectIdApiPrefix)(function(r,l){return(0,a.autoDispatch)((0,n.post)(r+"/member/"+e+"/"+t),l,o.ACTION.UPDATE_MEMBER_ROLE,function(){return{memberGlobalKey:e,memberRole:t}})})},t.removeMember=function(e){return(0,a.dispatchWithProjectIdApiPrefix)(function(t,r){return(0,a.autoDispatch)((0,n.post)(t+"/kickout/"+e),r,o.ACTION.REMOVE_MEMBER,function(){return{memberID:e}})})},t.filterMemberByRoleAndKeyword=function(e,t){return{type:o.ACTION.FILTER_MEMBER_BY_ROLE_AND_KEYWORD,memberRole:e,keyword:t}},t.addMembersByGlobalKeys=function(e){var t=e.join(",");return(0,a.dispatchWithProjectIdApiPrefix)(function(e,r){return(0,a.autoDispatch)((0,n.post)(e+"/members/gk/add?users="+t),r,o.ACTION.ADD_MEMBERS_BY_GLOBAL_KEY)})},t.getProjectMembers=function(){return(0,a.dispatchWithProjectIdApiPrefix)(function(e,t){return(0,a.autoDispatch)((0,n.get)(e+"/members?page=1&pageSize=200"),t,o.ACTION.GET_PROJECT_MEMBERS,function(e){var t=e.data;return[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}((0,n.toCamelCase)(t).list))})})},t.initialMemberRole=function(e){return{type:o.ACTION.INITIAL_MEMBER_ROLE,initialMemberRole:e}};var n=r(84),a=r(548),o=r(1697)},1813:function(e,t,r){e.exports={"member-top-menu":"member-top-menu-2nz",memberTopMenu:"member-top-menu-2nz","add-member":"add-member-2Al",addMember:"add-member-2Al","member-tips":"member-tips-1HJ",memberTips:"member-tips-1HJ","member-header":"member-header-hQP",memberHeader:"member-header-hQP",count:"count-ATK",filter:"filter-2cr",title:"title-2fJ",hr:"hr-2vf","alias-text":"alias-text-1Kv",aliasText:"alias-text-1Kv","alias-input":"alias-input-BlU",aliasInput:"alias-input-BlU","edit-icon":"edit-icon-2n7",editIcon:"edit-icon-2n7","role-filter":"role-filter-3bX",roleFilter:"role-filter-3bX","member-remove":"member-remove-zoy",memberRemove:"member-remove-zoy","member-remove-disable":"member-remove-disable-MXX",memberRemoveDisable:"member-remove-disable-MXX",table:"table-1pv",avatar:"avatar-2gk",tdName:"tdName-3ZO",tdAlias:"tdAlias-1su",tdRole:"tdRole-3jh","blank-tips":"blank-tips-2Xw",blankTips:"blank-tips-2Xw"}},1814:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNotLowerThanRoleAuth=function(e,t){if(!e||!e[n.USER_ROLE.CURRENT_USER_ROLE_ID]||!t)return!1;if(isNaN(t))return e[n.USER_ROLE.CURRENT_USER_ROLE]===t;return e[n.USER_ROLE.CURRENT_USER_ROLE_ID]>=t},t.isNotHigherThanRoleAuth=function(e,t){if(!e||!e[n.USER_ROLE.CURRENT_USER_ROLE_ID]||!t)return!1;if(isNaN(t))return e[n.USER_ROLE.CURRENT_USER_ROLE]===t;return e[n.USER_ROLE.CURRENT_USER_ROLE_ID]<=t};var n=r(106)},1887:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=d(r(0)),i=r(2),u=d(i),s=d(r(549)),c=d(r(1888)),f=r(1676);function d(e){return e&&e.__esModule?e:{default:e}}var m=(a=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.onConfirm=r.onConfirm.bind(r),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"onConfirm",value:function(){this.props.onConfirm&&this.props.onConfirm(),this.props.onHide()}},{key:"render",value:function(){return u.default.createElement(s.default,{show:this.props.show,onHide:this.props.onHide,className:f.modalContainer},u.default.createElement("div",{className:f.modalTitle},this.props.title),u.default.createElement(c.default,{excludedMembers:this.props.excludedMembers,fixedMembers:this.props.fixedMembers,onConfirm:this.onConfirm,onCancel:this.props.onHide}))}}]),t}(),n.propTypes={show:l.default.bool,onConfirm:l.default.func,onHide:l.default.func,title:l.default.string,excludedMembers:l.default.array,fixedMembers:l.default.array},a);t.default=m},1888:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),u=p(i),s=r(113),c=r(114),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(1675)),d=r(707),m=p(r(1889));function p(e){return e&&e.__esModule?e:{default:e}}var b=(a=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),l(t,[{key:"componentDidMount",value:function(){this.props.getProjects()}},{key:"render",value:function(){return u.default.createElement(m.default,this.props)}}]),t}(),n.propTypes=o({},m.default.propTypes),a);t.default=(0,s.connect)(function(e){return o({},e.MEMBER_SELECTOR,{projects:e.APP.projects,user:e.APP.user})},function(e){return o({},(0,c.bindActionCreators)(f,e),{getProjects:function(){return e((0,d.getProjects)())}})})(b)},1889:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=O(r(0)),i=r(2),u=O(i),s=O(r(8)),c=O(r(261)),f=O(r(552)),d=O(r(262)),m=O(r(1474)),p=O(r(1563)),b=O(r(1846)),E=r(51),h=O(r(1591)),y=O(r(554)),M=O(r(544)),R=O(r(1526)),_=r(1676),v=r(1654);function O(e){return e&&e.__esModule?e:{default:e}}function T(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var A=(a=n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,E.injectAsyncI18n)("MEMBER_SELECTOR",r(1891)),n.state={activeKey:"",members:[]},n.onSearch=(0,y.default)(n.onSearch.bind(n),200,{leading:!0}),n.onWatchedSearch=n.onWatchedSearch.bind(n),n.onFanSearch=n.onFanSearch.bind(n),n.onProjectSearch=n.onProjectSearch.bind(n),n.onKeywordSearch=n.onKeywordSearch.bind(n),n.getMemberName=n.getMemberName.bind(n),n.buildProject=n.buildProject.bind(n),n.buildMember=n.buildMember.bind(n),n.buildFixedLabel=n.buildFixedLabel.bind(n),n.buildLabel=n.buildLabel.bind(n),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"onSearch",value:function(e,t){this.props.onSearch(e,t)}},{key:"onWatchedSearch",value:function(){this.setState({activeKey:v.SEARCH_TYPE.WATCHED}),this.onSearch(v.SEARCH_TYPE.WATCHED)}},{key:"onFanSearch",value:function(){this.setState({activeKey:v.SEARCH_TYPE.FAN}),this.onSearch(v.SEARCH_TYPE.FAN)}},{key:"onProjectSearch",value:function(e){this.setState({activeKey:e}),this.onSearch(v.SEARCH_TYPE.PROJECT,e)}},{key:"onKeywordSearch",value:function(e,t){this.setState({activeKey:v.SEARCH_TYPE.KEYWORD}),this.onSearch(v.SEARCH_TYPE.KEYWORD,t)}},{key:"getMemberName",value:function(e){return e.id===this.props.user.id?E.I18n.get("MEMBER_SELECTOR","myself"):e.name}},{key:"buildProject",value:function(e){var t=this;return u.default.createElement("li",{key:e.id,onClick:function(){return t.onProjectSearch(e.id)},className:this.state.activeKey===e.id?_.active:""},u.default.createElement(d.default,{src:e.icon,size:"tiny",shape:"square",className:_.projectAvatar}),u.default.createElement("span",null,e.name))}},{key:"buildMember",value:function(e){var t=this,r=e.id;if(this.props.excludedMembers.find(function(e){return e.id===r}))return u.default.createElement("div",{className:_.memberItem+" "+_.excludedItem,key:r},u.default.createElement(d.default,{src:e.avatar,size:"xsmall",className:_.memberAvatar}),u.default.createElement("span",{className:_.memberName},this.getMemberName(e)));var n=!!this.props.selectedMembers.find(function(e){return e.id===r});return u.default.createElement(h.default,{key:r,className:_.memberItem,show:!0,small:!0,isSelected:n,onClick:function(){n?t.props.onUnselect(e):t.props.onSelect(e)}},u.default.createElement(d.default,{src:e.avatar,size:"xsmall",className:_.memberAvatar}),u.default.createElement("span",{className:_.memberName},this.getMemberName(e)))}},{key:"buildFixedLabel",value:function(e){return u.default.createElement(f.default,{key:e.id,className:_.label,bgColor:"#76808E"},this.getMemberName(e))}},{key:"buildLabel",value:function(e){var t=this;return u.default.createElement(f.default,{onDismiss:function(){return t.props.onUnselect(e)},key:e.id,className:_.label,bgColor:"#76808E"},this.getMemberName(e))}},{key:"render",value:function(){return u.default.createElement("div",{className:_.container},u.default.createElement("div",{className:_.box},u.default.createElement("div",{className:_.dropdown},u.default.createElement(c.default,{placeholder:E.I18n.get("MEMBER_SELECTOR","placeholder"),icon:u.default.createElement(m.default,null),className:_.input,onChange:this.onKeywordSearch,onPressEnter:this.onKeywordSearch}),u.default.createElement("ul",{className:_.dropdownList},u.default.createElement("li",{className:_.dropdownTitle},u.default.createElement(E.I18n,{region:"MEMBER_SELECTOR",i18n:"dropdown.title"})),u.default.createElement("li",{key:v.SEARCH_TYPE.WATCHED,onClick:this.onWatchedSearch,className:(0,s.default)(_.dropdownSpecial,T({},_.active,this.state.activeKey===v.SEARCH_TYPE.WATCHED))},u.default.createElement(p.default,null),u.default.createElement(E.I18n,{region:"MEMBER_SELECTOR",i18n:"watched.person"})),u.default.createElement("li",{key:v.SEARCH_TYPE.FAN,onClick:this.onFanSearch,className:(0,s.default)(_.dropdownSpecial,T({},_.active,this.state.activeKey===v.SEARCH_TYPE.FAN))},u.default.createElement(b.default,null),u.default.createElement(E.I18n,{region:"MEMBER_SELECTOR",i18n:"fans"})),this.props.projects.map(this.buildProject))),u.default.createElement("div",{className:_.members},this.props.members.map(this.buildMember),this.props.members.length%3===2&&u.default.createElement("div",{className:_.fakeMemberItem}))),u.default.createElement("div",{className:_.selecteds},u.default.createElement(E.I18n,{className:"mr-5",region:"MEMBER_SELECTOR",i18n:"selected.members",params:{count:this.props.fixedMembers.length+this.props.selectedMembers.length}}),this.props.fixedMembers.map(this.buildFixedLabel),this.props.selectedMembers.map(this.buildLabel)),u.default.createElement("div",{className:_.buttons},u.default.createElement(M.default,{className:"mr-10",onClick:this.props.onConfirm,disabled:0===this.props.selectedMembers.length},u.default.createElement(E.I18n,{region:"MEMBER_SELECTOR",i18n:"confirm"})),u.default.createElement(M.default,{empty:!0,onClick:this.props.onCancel},u.default.createElement(E.I18n,{region:"MEMBER_SELECTOR",i18n:"cancel"})),this.props.remainingCount<=0&&u.default.createElement("span",{className:_.red},u.default.createElement(R.default,{className:"fs-16"}),u.default.createElement(E.I18n,{region:"MEMBER_SELECTOR",i18n:"reach.limit",className:"ml-5"}))))}}]),t}(),n.propTypes={user:l.default.object,projects:l.default.array,members:l.default.array,excludedMembers:l.default.array,selectedMembers:l.default.array,fixedMembers:l.default.array,remainingCount:l.default.number,onSearch:l.default.func,onSelect:l.default.func,onUnselect:l.default.func,className:l.default.string,onConfirm:l.default.func,onCancel:l.default.func},n.defaultProps={fixedMembers:[]},a);t.default=A},1891:function(e,t){e.exports={"zh-CN":{"selected.members":"\u5df2\u9009\u6210\u5458 (${count})\uff1a","member.count.to.add":"\u4f60\u8fd8\u53ef\u4ee5\u6dfb\u52a0 ",member:" \u4e2a\u6210\u5458",placeholder:"Email\u3001GK\u6216\u6635\u79f0",confirm:"\u786e\u5b9a",cancel:"\u53d6\u6d88","watched.person":"\u6211\u5173\u6ce8\u7684\u4eba",fans:"\u7c89\u4e1d","all.member":"\u6240\u6709\u6210\u5458","reach.limit":"\u5df2\u7ecf\u8fbe\u5230\u9879\u76ee\u53ef\u6dfb\u52a0\u6210\u5458\u7684\u6700\u5927\u6570\u91cf",myself:"\u6211\u81ea\u5df1","dropdown.title":"\u4ece\u9879\u76ee\u4e2d\u9009\u53d6\u6210\u5458"},"en-US":{"selected.members":"Selected Members (${count}): ","member.count.to.add":"You can still add ",member:" members",placeholder:"Email\u3001GK or Username",confirm:"Confirm",cancel:"Cancel","watched.person":"Watched Person",fans:"Fans","all.member":"All Member","reach.limit":"Reach the number limit of project members",myself:"Myself","dropdown.title":"Select members from projects"}}},3922:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(2),o=s(a),l=s(r(3923)),i=s(r(3925)),u=s(r(3927));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),n(t,[{key:"render",value:function(){return o.default.createElement("div",null,o.default.createElement(u.default,null),o.default.createElement(l.default,null),o.default.createElement(i.default,null))}}]),t}();t.default=c},3923:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=d(r(0)),o=r(2),l=d(o),i=r(78),u=d(r(545)),s=r(1812),c=r(1697),f=d(r(1813));function d(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),n(t,[{key:"componentDidMount",value:function(){this.props.initialMemberRole(0)}},{key:"renderRoleFilter",value:function(){var e=this,t=this.props,r=t.currentProject,n=t.keyword,a=r.isTeam?c.TEAM_PROJECT_ROLE_FILTER:c.PERSONAL_PROJECT_ROLE_FILTER;return l.default.createElement(i.TextDropdown,{className:f.default.filter,placeholder:"\u6240\u6709\u89d2\u8272",initialSelectedItem:a[0],items:a,onSelect:function(t){return e.props.filterMemberByRoleAndKeyword(t.value,n)}})}},{key:"render",value:function(){return l.default.createElement("div",{className:f.default.memberHeader+" mt-15"},l.default.createElement("div",null,l.default.createElement("h2",{className:f.default.title},"\u6240\u6709\u6210\u5458"),l.default.createElement("span",{className:f.default.count},"\uff08",this.props.count,"\uff09")),this.renderRoleFilter())}}]),t}();m.propTypes={count:a.default.number.isRequired,currentProject:a.default.object,filterMemberByRoleAndKeyword:a.default.func,keyword:a.default.string,initialMemberRole:a.default.func},t.default=(0,u.default)(function(e){var t=e.APP.currentProject,r=e.PROJECT.setting.member,n=r.keyword;return{count:r.members.length,currentProject:t,keyword:n}},{filterMemberByRoleAndKeyword:s.filterMemberByRoleAndKeyword,initialMemberRole:s.initialMemberRole})(m)},3925:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=O(r(0)),o=r(2),l=O(o),i=r(168),u=O(r(1565)),s=O(r(262)),c=r(78),f=O(r(547)),d=O(r(699)),m=O(r(552)),p=r(112),b=r(106),E=O(r(545)),h=r(1814),y=r(1812),M=O(r(3926)),R=r(1697),_=O(r(1813)),v=r(559);function O(e){return e&&e.__esModule?e:{default:e}}function T(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var A=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={loading:!0,ROLE_COLORS:(r={},T(r,b.ROLE_AUTH.OWNER,"#FFAE0D"),T(r,b.ROLE_AUTH.ADMIN,"#53BF1D"),T(r,b.ROLE_AUTH.MEMBER,"#76808E"),T(r,b.ROLE_AUTH.MEMBER_NO_CODE,"#d8dde4"),r)},n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),n(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"fetchData",value:function(){var e=this;this.setState({loading:!0}),this.props.getProjectMembers().finally(function(){e.unmounted||e.setState({loading:!1})})}},{key:"renderMemberListItem",value:function(e){var t=this,r=this.props.currentProject;return l.default.createElement("tr",{key:e.id},l.default.createElement("td",{className:_.default.tdName},l.default.createElement(i.Link,{className:_.default.avatar,to:e.user.path},l.default.createElement(s.default,{src:e.user.avatar,size:"small",className:"mr-10"})),l.default.createElement("span",{className:"ml-10"},e.user.name)),l.default.createElement("td",{className:_.default.tdAlias},(0,h.isNotLowerThanRoleAuth)(r,b.ROLE_AUTH.ADMIN)?l.default.createElement(M.default,{alias:e.alias,memberID:e.user.id}):e.alias),l.default.createElement("td",{className:_.default.tdRole},this.checkRoleAuthBetweenUserAndMember(r,e.type)?this.renderMemberRoleDropdown(r,e.type,e.user.globalKey):this.renderMemberRoleLabel(e.type)),l.default.createElement("td",null,this.checkRoleAuthBetweenUserAndMember(r,e.type)&&l.default.createElement("span",{className:_.default.memberRemove,onClick:function(){return t.onRemove(e.userId)}},l.default.createElement(f.default,{className:"mr-2"}),"\u79fb\u9664\u6210\u5458")))}},{key:"onRemove",value:function(e){var t=this;confirm("\u786e\u8ba4\u79fb\u9664\u8be5\u6210\u5458\uff1f")&&this.props.removeMember(e).then(function(){(0,p.success)("\u79fb\u9664\u6210\u5458\u6210\u529f"),t.props.getMembers(t.props.currentProject.id)})}},{key:"checkRoleAuthBetweenUserAndMember",value:function(e,t){return(0,h.isNotLowerThanRoleAuth)(e,b.ROLE_AUTH.ADMIN)&&t<=b.ROLE_AUTH.ADMIN&&!(0,h.isNotHigherThanRoleAuth)(e,t)}},{key:"renderMemberRoleLabel",value:function(e){return l.default.createElement(m.default,{bgColor:this.state.ROLE_COLORS[e]},R.MEMBER_ROLE_AUTH[e])}},{key:"renderMemberRoleDropdown",value:function(e,t,r){var n=this,a=e[b.USER_ROLE.CURRENT_USER_ROLE_ID],o=[];a===b.ROLE_AUTH.OWNER?o=R.OWNER_AUTH_ITEMS:a===b.ROLE_AUTH.ADMIN&&(o=R.ADMIN_AUTH_ITEMS);var i=(0,u.default)(o,{text:R.MEMBER_ROLE_AUTH[t],value:t});return l.default.createElement(c.TextDropdown,{className:_.default.roleFilter,initialSelectedItem:o[i],items:o,onSelect:function(e){return n.onUpdateMemberRole(r,e.value)}})}},{key:"onUpdateMemberRole",value:function(e,t){this.props.updateMemberRole(e,t).then(function(){return(0,p.success)("\u8bbe\u7f6e\u6210\u5458\u6743\u9650\u6210\u529f")})}},{key:"renderMemberList",value:function(){var e=this;return 0===this.props.members.length?l.default.createElement("p",{className:_.default.blankTips},"\u641c\u7d22\u7ed3\u679c\u4e3a\u7a7a"):l.default.createElement("table",{className:_.default.table},l.default.createElement("tbody",null,this.props.members.map(function(t){return e.renderMemberListItem(t)})))}},{key:"render",value:function(){return this.state.loading?l.default.createElement("div",null,l.default.createElement(d.default,null)," \u6b63\u5728\u52a0\u8f7d\u9879\u76ee\u6210\u5458..."):l.default.createElement("div",null,l.default.createElement("hr",{className:_.default.hr+" mt-10"}),this.renderMemberList())}}]),t}();A.propTypes={currentProject:a.default.object,members:a.default.array,getProjectMembers:a.default.func.isRequired,removeMember:a.default.func,updateMemberRole:a.default.func,getMembers:a.default.func},t.default=(0,E.default)(function(e){var t=e.PROJECT.setting.member.members;return{currentProject:e.APP.currentProject,members:t}},{getProjectMembers:y.getProjectMembers,removeMember:y.removeMember,updateMemberRole:y.updateMemberRole,getMembers:v.getMembers})(A)},3926:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=m(r(0)),o=r(2),l=m(o),i=m(r(1481)),u=m(r(261)),s=r(112),c=m(r(545)),f=r(1812),d=r(1813);function m(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.onBlur=function(){r.setState({alias:r.props.alias},function(){r.unedit()})},r.state={alias:r.props.alias,isEditable:!1},r.edit=r.edit.bind(r),r.unedit=r.unedit.bind(r),r.onAliasChange=r.onAliasChange.bind(r),r.onEnter=r.onEnter.bind(r),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),n(t,[{key:"edit",value:function(){var e=this;this.setState({alias:this.props.alias,isEditable:!0},function(){if(e.refs.input){var t=e.refs.input.input;t.focus(),t.selectionStart=t.selectionEnd=e.state.alias.length}})}},{key:"unedit",value:function(){this.setState({isEditable:!1})}},{key:"onAliasChange",value:function(e,t){this.setState({alias:t})}},{key:"onEnter",value:function(e,t){0===t.length||t.length>32?(0,s.danger)("\u8bf7\u8f93\u5165 1-32 \u4f4d\u7684\u5907\u6ce8"):(this.props.updateMemberAlias(this.props.memberID,t).then(function(){return(0,s.success)("\u4fee\u6539\u6210\u5458\u5907\u6ce8\u540d\u6210\u529f")}),this.unedit())}},{key:"renderEditable",value:function(){return l.default.createElement(u.default,{className:d.aliasInput,onBlur:this.onBlur,onChange:this.onAliasChange,onPressEnter:this.onEnter,placeholder:"\u6dfb\u52a0\u5907\u6ce8\uff08\u56de\u8f66\u4fdd\u5b58\u5907\u6ce8\uff09",ref:"input",size:"small",value:this.state.alias})}},{key:"renderAlias",value:function(){var e=l.default.createElement("span",null,l.default.createElement(i.default,{className:d.editIcon}),"\u6dfb\u52a0\u5907\u6ce8"),t=l.default.createElement("span",null,l.default.createElement(i.default,{className:d.editIcon}),this.state.alias);return l.default.createElement("span",{className:d.aliasText},this.state.alias?t:e)}},{key:"render",value:function(){return l.default.createElement("span",{onClick:this.edit},this.state.isEditable?this.renderEditable():this.renderAlias())}}]),t}();p.propTypes={alias:a.default.string,memberID:a.default.number,updateMemberAlias:a.default.func},t.default=(0,c.default)(null,{updateMemberAlias:f.updateMemberAlias})(p)},3927:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=M(r(0)),o=r(2),l=M(o),i=M(r(544)),u=r(112),s=r(1675),c=M(r(1887)),f=r(106),d=M(r(545)),m=r(1814),p=r(1598),b=r(1812),E=r(1813),h=r(740),y=r(559);function M(e){return e&&e.__esModule?e:{default:e}}var R=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={showModal:!1},r.onShowModal=r.onShowModal.bind(r),r.onHideModal=r.onHideModal.bind(r),r.onModalConfirm=r.onModalConfirm.bind(r),r.onFilterKeyChange=r.onFilterKeyChange.bind(r),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),n(t,[{key:"updateRemainingMemberCount",value:function(e){var t=this.props.currentProject.max_member,r=void 0;r=t===h.MAX_MEMBER.NO_LIMIT?100:t-e||0,this.props.resetMemberSelector(r)}},{key:"componentWillReceiveProps",value:function(e){var t=e.memberCount;t!==this.props.memberCount&&this.updateRemainingMemberCount(t)}},{key:"componentDidMount",value:function(){this.updateRemainingMemberCount(this.props.memberCount)}},{key:"onShowModal",value:function(){this.setState({showModal:!0})}},{key:"onHideModal",value:function(){this.setState({showModal:!1})}},{key:"onFilterKeyChange",value:function(e){var t=this.props.memberRole;this.props.filterMemberByRoleAndKeyword(t,e)}},{key:"onModalConfirm",value:function(){var e=this,t=this.props.selectedMembers.map(function(e){return e.global_key});this.props.addMembersByGlobalKeys(t).then(function(){e.props.getProjectMembers(),e.props.getMembers(e.props.currentProject.id)}).finally(function(){return(0,u.success)("\u6dfb\u52a0\u6210\u5458\u6210\u529f")}),this.updateRemainingMemberCount(this.props.memberCount),this.onHideModal()}},{key:"renderAddMemberButton",value:function(){return(0,m.isNotLowerThanRoleAuth)(this.props.currentProject,f.ROLE_AUTH.ADMIN)?l.default.createElement(i.default,{className:E.addMember,onClick:this.onShowModal},"\u6dfb\u52a0\u6210\u5458"):null}},{key:"render",value:function(){return l.default.createElement("div",{className:E.memberTopMenu},l.default.createElement(c.default,{show:this.state.showModal,onHide:this.onHideModal,onConfirm:this.onModalConfirm,title:"\u6dfb\u52a0\u6210\u5458",excludedMembers:this.props.originalMembers.map(function(e){return e.user})}),l.default.createElement("ul",null,l.default.createElement("li",{className:"search"},l.default.createElement(p.FilterInput,{placeholder:"\u7b5b\u9009\u6210\u5458",onChange:this.onFilterKeyChange})),l.default.createElement("li",null,this.renderAddMemberButton())))}}]),t}();R.propTypes={addMembersByGlobalKeys:a.default.func,filterMemberByRoleAndKeyword:a.default.func,getProjectMembers:a.default.func,resetMemberSelector:a.default.func,currentProject:a.default.object,user:a.default.object,members:a.default.array,selectedMembers:a.default.array,memberCount:a.default.number.isRequired,memberRole:a.default.number,keyword:a.default.string,getMembers:a.default.func,originalMembers:a.default.array},t.default=(0,d.default)(function(e){var t=e.APP,r=t.currentProject,n=t.user,a=e.MEMBER_SELECTOR.selectedMembers,o=e.PROJECT.setting.member,l=o.keyword,i=o.memberRole,u=o.members,s=o.originalMembers;return{currentProject:r,keyword:l,memberCount:s.length,memberRole:i,members:u,selectedMembers:a,user:n,originalMembers:s}},{addMembersByGlobalKeys:b.addMembersByGlobalKeys,filterMemberByRoleAndKeyword:b.filterMemberByRoleAndKeyword,getProjectMembers:b.getProjectMembers,resetMemberSelector:s.reset,getMembers:y.getMembers})(R)}}]);